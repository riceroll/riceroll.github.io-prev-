{"version":3,"sources":["model.js","logo.svg","viewer.js","gui.js","main.js","reportWebVitals.js","index.js"],"names":["Vertex","pos","fixed","pos0","vel","force","this","vs","es","fs","id","all","length","push","Edge","lMax","maxContraction","edgeChannel","edgeActive","l","iv","Model","viewer","controls","sharedData","reset","loadData","resetSelection","recordV","v","e","v0","fixedVs","script","f","vStatus","eStatus","fStatus","iAction","numSteps","timeStart","Date","editing","simulate","gravity","directional","euler","thre","numChannels","defaultNumChannels","numActions","defaultNumActions","inflateChannel","Array","fill","contractionPercent","data","from","p","i","Math","sqrt","precompute","initCheck","x","y","z","zOffset","bbox","vv","clone","copy","copyArrays","oldValue","newValue","min","distanceTo","maxMaxContraction","defaultMaxLength","map","_","iChannel","minlMax","console","log","divideScalar","multiplyScalar","vec","sub","l0","lMin","k","normalize","add","negate","gravityFactor","numStepsAction","floor","n","scripting","iStep","runScript","update","contractionPercentRate","movingJoint","h","frictionFactor","dampingRatio","iJoint","defaultMinLength","iJoints","j","notExist","includes","updateDataStructure","ees","ee","filter","reindexObjects","updateFromDataStructure","forceUpdate","iEdge","center","cent0","centroid","cent","t","getTime","xMax","yMax","zMax","xMin","yMin","zMin","Infinity","ids","alert","resetV","eulerInverse","setFromVector3","toVector3","applyEuler","contractionInterval","contractionSteps","round","cls","extend","OrbitControls","cWhite","THREE","cChannels","cBlack","cSelected","cHovered","cFixed","cPassive","dTube","Ball","d","c","model","handleClick","handlePointerOver","handlePointerOut","setOControls","translating","mesh","useRef","material","transControls","useState","dragging","setDragging","prevPos","useFrame","state","current","position","color","worldPosition","useEffect","callbackDraggingChanged","value","target","object","addEventListener","removeEventListener","TransformControls","ref","enabled","showX","showY","showZ","mode","space","castShadow","scale","onClick","onPointerOver","onPointerOut","args","Joint","setTranslating","sate","selected","hovered","removingJoint","removeJoint","addingJoint","addJoint","updateGUI","stopPropagation","Cylinder","v1","axis","quaternion","setFromUnitVectors","setFromQuaternion","rotation","Beam","ie","vecPiston","vecTube","vecConstraint","vOut0","vOut1","vIn0","vIn1","vTube00","vTube01","vTube11","vTube10","vConstraint0","vConstraint1","cOut","cIn","cJoint","cBeam","changeColor","showChannel","showInfo","infoPanel","style","display","left","String","clientX","top","clientY","firstChild","removeChild","appendChild","ownerDocument","createTextNode","createElement","cylinders","PneuMesh","React","clock","timeUntilNextFrame","getDelta","setTimeout","ready","invalidate","max","step","joints","beams","entries","DLight","light","set","shadow","mapSize","width","height","camera","right","bottom","near","far","window","fps","Controls","oControls","useThree","domElement","gl","Viewer","useReducer","shadowMap","concurrent","onCreated","intensity","setClearColor","setPixelRatio","devicePixelRatio","type","fov","up","antialias","receiveShadow","visible","opacity","rotation-x","PI","position-z","s","Stats","cBackground","paddingBlocks","marginSlider","useStyles","makeStyles","theme","mainGUI","background","minHeight","editingGUI","scriptGUI","editingScriptGUI","SettingActive","icons","keys","every","Grid","item","textAlign","IconButton","size","WbSunny","FiberManualRecord","ListItem","ListItemText","container","SettingChannel","checked","RadioButtonChecked","RadioButtonUnchecked","styles","ControlChannel","switches","Switch","alignItems","Scripts","classes","widthBlocks","Block","setHovered","isOn","className","scriptBlock","padding","margin","border","Row","blocks","spacing","rows","GUI","options","GUIHovered","List","button","input","document","body","getElementById","click","onchange","reader","FileReader","onload","event","inputFileString","result","JSON","parse","loadDict","readAsText","files","ListItemIcon","Publish","saveData","json","stringify","download","href","encodeURIComponent","GetApp","Divider","ChevronLeft","Typography","Slider","disabled","defaultValue","aria-labelledby","valueLabelDisplay","onChange","val","onPointerUp","Lock","LockOpen","editingScript","FilterCenterFocus","addEdges","SettingsEthernet","arial-labelledby","rotate","paddingTop","paddingBottom","widthSliders","fontSize","Main","unSelect","b","code","metaKey","ctrlKey","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","root","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.6fc01205.chunk.js","sourcesContent":["import * as thre from 'three';\nimport React, {useRef, useState, useMemo} from 'react'\n\nclass Vertex {\n  static all = [];\n\n  constructor(pos, fixed, pos0, vel, force) {\n    this.pos = pos;     // thre.Vector3\n    this.fixed = fixed;\n    this.pos0 = pos0;\n    this.vel = vel;\n    this.force =force;\n    this.vs =[];  // neighbor vertices\n    this.es = [];   // neighbor edges\n    this.fs = [];   // incident faces\n\n    this.id = Vertex.all.length;\n    Vertex.all.push(this);\n  }\n\n  facesOnTheOtherSide() {\n    // const fs = [];\n    // for (const f of Face.all) {\n    //   let onTheOtherSide = true;\n    //   for (const v of f.vs) {\n    //     if (!v.vs.includes(v)) {\n    //       onTheOtherSide = false;\n    //       break;\n    //     }\n    //   }\n    //   if (onTheOtherSide) fs.push(f);\n    // }\n    // return fs;\n  }\n}\n\nclass Edge {\n  static all = [];\n\n  constructor(vs, lMax, maxContraction, edgeChannel, edgeActive, l) {\n    this.vs = [];\n    this.lMax = lMax;\n    this.maxContraction = maxContraction;\n    this.edgeChannel = edgeChannel;\n    this.edgeActive = edgeActive;\n    this.l = l;\n\n    for (let iv of vs) {\n      this.vs.push(Vertex.all[iv]);\n    }\n    Vertex.all[vs[0]].vs.push(Vertex.all[vs[1]]);\n    Vertex.all[vs[1]].vs.push(Vertex.all[vs[0]]);\n    Vertex.all[vs[0]].es.push(this);\n    Vertex.all[vs[1]].es.push(this);\n\n    this.id = Edge.all.length;\n    Edge.all.push(this);\n  }\n\n}\n\nclass Model {\n  static k = 200000;\n  static h = 0.001;\n  static dampingRatio = 0.992;\n  static contractionInterval = 0.075;\n  static contractionSteps = 4;\n  static maxMaxContraction = Math.round(Model.contractionInterval * Model.contractionSteps * 100) /100;\n  static contractionPercentRate = 5e-4 ;  // contraction percentage change ratio, per time step\n  static gravityFactor = 9.8;\n  static gravity = 1;     // if gravity is on\n  static defaultMinLength = 1.2;\n  static defaultMaxLength = Model.defaultMinLength / (1 - Model.maxMaxContraction);\n  static frictionFactor = 0.8;\n  static numStepsAction = 2 / Model.h;\n  static defaultNumActions = 1;\n  static defaultNumChannels = 4;\n\n  constructor() {\n    this.viewer = null;\n\n    this.Vertex = Vertex;\n    this.Edge = Edge;\n    this.Model = Model;\n    this.controls = null;\n    this.sharedData = null;\n\n    this.reset();\n\n    this.loadData();\n    this.resetSelection();\n    this.recordV();\n  }\n\n  reset() {\n    // input data\n    this.v = [];  // vertex positions: nV x 3\n    this.e = [];  // edge positions: nE x 2\n    this.v0 = [];\n    this.fixedVs = [];  // id of vertices that are fixed\n    this.lMax = []; // maximum length\n    this.edgeActive = [];  // if beam is active: nE\n    this.edgeChannel = [];  // id of beam edgeChannel: nE\n    this.script = [];    // nTimeSteps x nChannels\n\n    // update at every step\n    this.maxContraction = [];  // percentage of maxMaxContraction: nE\n    this.vel = [];  // vertex velocities: nV x 3\n    this.f = [];  // vertex forces: nV x 3\n    this.l = [];    // current length of beams: nE\n\n    // interface\n    this.vStatus = [];    // 0: none, 1: hovered; 2: selected\n    this.eStatus = [];    // 0: none, 1: hovered; 2: selected\n    this.fStatus = [];    // 0: none, 1: hovered; 2: selected\n\n    // statistics\n    this.iAction = 0;\n    this.numSteps = 0;\n    this.timeStart = new Date();\n\n    // status\n    this.editing = false;\n    this.simulate = true;\n    this.gravity = true;\n    this.directional = false;\n    this.euler = new thre.Euler(0, 0, 0);\n\n    // channel status\n    this.numChannels = Model.defaultNumChannels;\n    this.numActions = Model.defaultNumActions;\n    this.inflateChannel = new Array(this.numChannels).fill(false);\n    this.contractionPercent = new Array(this.numChannels).fill(1);  // contraction percentage of each channel, 0-1\n\n  }\n\n  loadDict(data) {\n    // load a dictionary\n    let v = [];\n    let e = Array.from(data.e);\n    let f = [];\n    let p = [];\n    // f = Array.from(data.f);\n    // p = Array.from(data.p);\n    for (let i=0; i<data.v.length; i++) {\n      v.push(new thre.Vector3(data.v[i][0], data.v[i][1], data.v[i][2]));\n    }\n    this.reset();\n    let lMax, maxContraction, fixedVs, edgeChannel, edgeActive\n    if (data.lMax) { lMax = data.lMax;}\n    if (data.maxContraction) {maxContraction = data.maxContraction;}\n    if (data.fixedVs)  {fixedVs = data.fixedVs;}\n    if (data.edgeChannel)  edgeChannel = data.edgeChannel;\n    if (data.edgeActive)  edgeActive = data.edgeActive;\n    this.loadData(v, e, f, p, lMax, maxContraction, fixedVs, edgeChannel, edgeActive);\n\n    if (!(data.lMax || data.maxContraction || data.fixedVs)) {\n      this.loadData(v, e, f, p);\n    }\n  }\n\n  loadData(v, e, f, p, lMax=null, maxContraction=null, fixedVs=null, edgeChannel=null, edgeActive=null, script=[]){\n    if (v && e) {\n      this.v = v;\n      this.e = e;\n    }\n    else{\n      this.v.push(new thre.Vector3(1, -1/Math.sqrt(3), 0.2));\n      this.v.push(new thre.Vector3(0, 2/Math.sqrt(3), 0.2));\n      this.v.push(new thre.Vector3(-1, -1/Math.sqrt(3), 0.2));\n      this.v.push(new thre.Vector3(0, 0, 4/Math.sqrt(6) + 0.2));\n\n      this.e.push([0, 1]);\n      this.e.push([1, 2]);\n      this.e.push([2, 0]);\n      this.e.push([0, 3]);\n      this.e.push([1, 3]);\n      this.e.push([2, 3]);\n    }\n\n    if (fixedVs) this.fixedVs = fixedVs;\n    if (lMax) this.lMax = lMax;\n    if (maxContraction) this.maxContraction = maxContraction;\n    if (edgeActive) this.edgeActive = edgeActive;\n    if (edgeChannel) this.edgeChannel = edgeChannel;\n    if (script) this.script = script;\n\n    this.precompute();\n\n    this.initCheck();\n    this.resetSelection();\n    this.recordV();\n  }\n\n  saveData() {\n    let data = {};\n    data.v = [];\n    for (let v of this.v) {\n      data.v.push([v.x, v.y, v.z]);\n    }\n    data.e = this.e;\n    data.lMax = this.lMax;\n    data.maxContraction = this.maxContraction;\n    data.fixedVs =this.fixedVs;\n    data.edgeChannel = this.edgeChannel;\n    data.edgeActive = this.edgeActive;\n    return data;\n  }\n\n  resetSelection() {\n\n    this.vStatus = new Array(this.v.length).fill(0);\n    this.eStatus = new Array(this.e.length).fill(0);\n    this.fStatus = new Array(this.f.length).fill(0);\n  }\n\n  recordV() {\n    this.v0 = [];\n    let bbox = this.bbox();\n    let zOffset = -bbox[5];\n\n    for (let v of this.v) {\n      let vv = v.clone();\n      vv.z += zOffset;\n      this.v0.push(vv);\n    }\n  }\n\n  resetV() {\n    this.iAction = 0;\n    this.numSteps = 0;\n\n    for (let i=0; i<this.v.length; i++) {\n      this.v[i].copy(this.v0[i]);\n    }\n\n    this.numSteps = 0;\n  }\n\n  precompute() {\n    const copyArrays = (oldValue, newValue)=>{\n      for (let i=0; i<Math.min(oldValue.length, newValue.length); i++) {\n        newValue[i] = oldValue[i];\n      }\n      return newValue;\n    }\n\n    this.l = [];\n    for (let i=0; i<this.e.length; i++) {\n      let e = this.e[i];\n      this.l.push(this.v[e[0]].distanceTo(this.v[e[1]]));\n    }\n\n    if (this.vel.length !== this.v.length) {\n      this.vel = [];\n      for (let i=0; i<this.v.length; i++) {\n        this.vel.push(new thre.Vector3());\n      }\n    }\n    if (this.maxContraction.length !== this.e.length) {\n      const newValue = new Array(this.e.length).fill(Model.maxMaxContraction);\n      this.maxContraction = copyArrays(this.maxContraction, newValue);\n    }\n    if (this.fixedVs.length !== this.v.length) {\n      const newValue = new Array(this.v.length).fill(false);\n      this.fixedVs = copyArrays(this.fixedVs, newValue);\n    }\n    if (this.lMax.length !== this.e.length) {\n      const newValue = new Array(this.e.length).fill(Model.defaultMaxLength);\n      this.lMax = copyArrays(this.lMax, newValue);\n    }\n    if (this.edgeActive.length !== this.e.length) {\n      const newValue = new Array(this.e.length).fill(true);\n      this.edgeActive = copyArrays(this.edgeActive, newValue);\n    }\n    if (this.edgeChannel.length !== this.e.length) {\n      const newValue = new Array(this.e.length).fill(0);\n      this.edgeChannel = copyArrays(this.edgeChannel, newValue);\n    }\n    if ((this.script.length !== this.numChannels)\n      || (this.script.length && this.script[0].length !== this.numActions))\n    {\n      const newValue = Array(this.numChannels).fill(false).map(_=>Array(this.numActions).fill(false));\n      if (this.script.length === 0) this.script = newValue;\n\n      for (let iChannel=0; iChannel<Math.min(this.script.length, newValue.length); iChannel++) {\n        for (let iAction=0; iAction<Math.min(this.script[0].length, newValue[0].length); iAction++) {\n          newValue[iChannel][iAction] = this.script[iChannel][iAction];\n        }\n      }\n      this.script = newValue;\n    }\n\n  }\n\n  initCheck() {\n\n    // rescale\n    let minlMax = 1e5;\n    for (let i=0; i<this.e.length; i++) {\n      if (this.edgeActive[i]) {\n        if (this.l[i] < minlMax) {\n          minlMax = this.l[i];\n        }\n      }\n    }\n    console.log(`Minimum max length among active beams is ${minlMax}.`)\n    for (let i=0; i<this.v.length; i++) {\n      this.v[i].divideScalar(minlMax);\n      this.v[i].multiplyScalar(Model.defaultMaxLength);\n    }\n\n    // lMax check\n    for (let i=0; i<this.e.length; i++) {\n      if (this.edgeActive[i] || true) {\n        if (this.lMax[i] !== this.Model.defaultMaxLength) {\n          console.log(`An active beam is having wrong max length ${this.lMax[i]}.`)\n          this.lMax[i] = this.Model.defaultMaxLength;\n        }\n      }\n    }\n\n  }\n\n  update() {\n    // initialize forces\n    this.f = [];\n    for (let i=0; i<this.v.length; i++) {\n      this.f.push(new thre.Vector3());\n    }\n\n    // length maxContraction\n    for (let i=0; i<this.e.length; i++) {\n      let e = this.e[i];\n      let v0 = this.v[e[0]];\n      let v1 = this.v[e[1]];\n\n      let vec = v1.clone().sub(v0); // from 0 to 1\n\n      let l0 = this.lMax[i];\n      if (this.edgeActive[i]) {\n        let iChannel = this.edgeChannel[i];\n        let lMax = l0;\n        let lMin = lMax * (1 - this.maxContraction[i]);\n        l0 = lMax - this.contractionPercent[iChannel] * (lMax - lMin);\n      }\n\n      let d = vec.length() - l0;\n      let f = (d) * Model.k;\n      f = vec.normalize().multiplyScalar(f);  // from 0 to 1\n      this.f[e[0]].add(f);\n      this.f[e[1]].add(f.negate());\n    }\n\n    // gravity\n    for (let i=0; i<this.v.length; i++) {\n      if (this.gravity) {\n        this.f[i].add(new thre.Vector3(0, 0, -Model.gravityFactor * Model.gravity));\n      }\n    }\n\n    // friction\n  }\n\n  runScript() {\n    if (this.script.length === 0) return 0;\n\n    if (this.numSteps > ((this.iAction + 1) % this.numActions) * Model.numStepsAction ) {\n      this.iAction = Math.floor(this.numSteps / Model.numStepsAction) % this.numActions;\n\n      for (let iChannel=0; iChannel<this.numChannels; iChannel++) {\n        this.inflateChannel[iChannel] = this.script[iChannel][this.iAction];\n      }\n    }\n  }\n\n  step(n=1, scripting = true) {\n\n    for (let iStep=0; iStep<n; iStep++) {\n      this.precompute();\n      if (!this.simulate) {return}\n\n      if (scripting) {\n        this.runScript();\n      }\n      this.update();\n\n      if (this.editing) {\n        // this.center();\n      }\n\n      // update contraction percentage\n      for (let i=0; i<this.inflateChannel.length; i++) {\n        if (this.inflateChannel[i]) {\n          this.contractionPercent[i] -= Model.contractionPercentRate;\n          if (this.contractionPercent[i] < 0) {\n            this.contractionPercent[i] = 0;\n          }\n        }\n        else {\n          this.contractionPercent[i] += Model.contractionPercentRate;\n          if (this.contractionPercent[i] > 1) {\n            this.contractionPercent[i] = 1;\n          }\n        }\n      }\n\n      for (let i=0; i<this.v.length; i++) {\n        if (this.fixedVs[i]) continue;\n\n        if (this.sharedData.movingJoint && this.vStatus[i] !== 2) continue;\n\n        this.vel[i].add(this.f[i].clone().multiplyScalar(Model.h));\n        if (this.v[i].z <= 0) {\n          // friction\n          if (this.directional) {\n            if (this.vel[i].x < 0) this.vel[i].x *= (1 - Model.frictionFactor);\n            if (this.vel[i].y < 0) this.vel[i].y *= (1 - Model.frictionFactor);\n          }\n          else {\n            this.vel[i].x *= (1 - Model.frictionFactor);\n            this.vel[i].y *= (1 - Model.frictionFactor);\n          }\n        }\n\n        this.vel[i].multiplyScalar(Model.dampingRatio);   // damping\n        while (this.vel[i].length() > 5) {\n          this.vel[i].multiplyScalar(0.9);\n        }\n\n        this.v[i].add(this.vel[i].clone().multiplyScalar(Model.h));\n\n      }\n\n      for (let i=0; i<this.v.length; i++) {\n        if (this.v[i].z < 0)\n        {\n          this.v[i].z = 0;\n          this.vel[i].z = -this.vel[i].z;\n        }\n      }\n\n      this.numSteps += 1;\n    }\n\n    return this.v;\n  }\n\n  // addPolytope(iFace) {\n  //   let face = this.faces[iFace];\n  //   let v0 = this.v[face[0]];\n  //   let v1 = this.v[face[1]];\n  //   let v2 = this.v[face[2]];\n  //   let centroid = v0.clone().add(v1).add(v2).divideScalar(3);\n  //   let vec01 = v1.clone().sub(v0);\n  //   let vec12 = v2.clone().sub(v1);\n  //   let height = Math.sqrt(3) / 2 * Model.defaultMinLength;\n  //   let v4 = centroid.add(vec01.cross(vec12).normalize().multiplyScalar(height));\n  //   this.v.push(v4);\n  //   this.f.push(new thre.Vector3());\n  //   this.vel.push(new thre.Vector3());\n  //\n  //   let iv4 = this.v.length - 1;\n  //\n  //   let e0 = [face[0], iv4];\n  //   let e1 = [face[1], iv4];\n  //   let e2 = [face[2], iv4];\n  //   this.e.push(e0, e1, e2);\n  //\n  //   let face0 = [face[2], face[1], face[0]];\n  //   let face1 = [face[0], face[1], iv4];\n  //   let face2 = [face[1], face[2], iv4];\n  //   let face3 = [face[2], face[0], iv4];\n  //   this.faces.push(face0, face1, face2, face3);\n  //\n  //   this.precompute();\n  //   this.recordV();\n  //\n  //   this.updateDataStructure();\n  // }\n\n  addJoint(iJoint) {\n    let v = new thre.Vector3();\n    v.copy(this.v[iJoint]);\n    let vec = new thre.Vector3(Model.defaultMinLength, 0, 0);\n    v = v.add(vec);\n    this.v.push(v);\n\n    let e = [iJoint, this.v.length - 1];\n    this.e.push(e);\n  }\n\n  addEdges(iJoints) {\n    for (let i=0; i<iJoints.length; i++) {\n      for (let j=i+1; j<iJoints.length; j++) {\n        let notExist = true;\n        for (let e of this.e) {\n          if (e.includes(iJoints[i]) && e.includes(iJoints[j])) {\n            notExist = false;\n            break;\n          }\n        }\n        if (notExist) this.e.push([iJoints[i], iJoints[j]]);\n      }\n    }\n  }\n\n  removeJoint(iJoint) {\n    if ([0,1,2,3].includes(iJoint)) return;\n\n    this.updateDataStructure();\n\n    const ees = [];   // edges to remove\n\n    const v = Vertex.all[iJoint];\n    for (let ee of v.es) {\n      ees.push(ee);\n    }\n\n    Vertex.all = Vertex.all.filter(vv=>vv !== v);\n    Edge.all = Edge.all.filter(ee=>!ees.includes(ee));\n\n    Model.reindexObjects(Vertex)\n    Model.reindexObjects(Edge)\n\n    this.updateFromDataStructure();\n    this.forceUpdate()\n  }\n\n  removeEdge(iEdge) {\n\n  }\n\n  // update the model variables to data structures\n  updateDataStructure() {\n    Vertex.all = [];\n    for (let i = 0; i < this.v.length; i++) {\n      new Vertex(this.v[i], this.fixedVs[i], this.v0[i], this.vel[i], this.f[i]);\n    }\n    Edge.all = [];\n    for (let i = 0; i < this.e.length; i++) {\n      new Edge(this.e[i], this.lMax[i], this.maxContraction[i], this.edgeChannel[i], this.edgeActive[i], this.l[i]);\n    }\n  }\n\n  // convert data structures to model variables\n  updateFromDataStructure() {\n    this.v = [];\n    this.fixedVs = [];\n    this.v0 = [];\n    this.vel = [];\n    this.f = [];\n    for (let v of Vertex.all) {\n      this.v.push(v.pos);\n      this.fixedVs.push(v.fixed);\n      this.v0.push(v.pos0);\n      this.vel.push(v.vel);\n      this.f.push(v.f);\n    }\n\n    this.e = [];\n    this.lMax = [];\n    this.maxContraction = [];\n    this.edgeChannel = [];\n    this.edgeActive = [];\n    this.l = [];\n    for (let e of Edge.all) {\n      let vs = [e.vs[0].id, e.vs[1].id];\n      this.e.push(vs);\n      this.lMax.push(e.lMax);\n      this.maxContraction.push(e.maxContraction);\n      this.edgeChannel.push(e.edgeChannel);\n      this.edgeActive.push(e.edgeActive);\n      this.l.push(e.l);\n    }\n\n    this.vStatus = new Array(this.v.length).fill(0);\n    this.eStatus = new Array(this.e.length).fill(0);\n  }\n\n  static reindexObjects = (cls) => {\n    let i = 0;\n    for (let o of cls.all) {\n      o.id = i;\n      i += 1;\n    }\n  };\n\n  centroid(v0=false) {\n    let center = new thre.Vector3(0, 0, 0);\n    const vs = v0 ? this.v0 : this.v;\n    for (let v of vs) {\n      center.add(v);\n    }\n    center.divideScalar(this.v.length);\n    return center;\n  }\n\n  center() {\n    const cent0 = this.centroid(true);\n    const cent = this.centroid(false);\n    for (let i=0; i<this.v.length; i++) {\n      this.v[i].sub(cent);\n      this.v[i].add(cent0);\n    }\n  }\n\n  stepsPerSecond() {\n    let t = new Date();\n    return this.numSteps / ((t.getTime() - this.timeStart.getTime()) / 1000);\n  }\n\n  bbox() {\n    let xMax, yMax, zMax, xMin, yMin, zMin;\n    xMax = yMax = zMax = -Infinity;\n    xMin = yMin = zMin = Infinity;\n    for (let v of this.v) {\n      if (v.x > xMax) xMax = v.x;\n      if (v.y > yMax) yMax = v.y;\n      if (v.z > zMax) zMax = v.z;\n      if (v.x < xMin) xMin = v.x;\n      if (v.y < yMin) yMin = v.y;\n      if (v.z < zMin) zMin = v.z;\n    }\n    return [xMax, yMax, zMax, xMin, yMin, zMin];\n  }\n\n  infoJoints() {\n    return 'joints: '+ this.v.length;\n  }\n\n  infoBeams() {\n    return 'actuators: ' + this.e.length;\n  }\n\n  fixJoints(ids) {\n    for (let i=0; i<ids.length; i++) {\n      let id = ids[i];\n      alert('not implemented');\n      // if (viewer.typeSelected[i] === \"joint\") {\n      //   this.fixedVs[id] = true;\n      // }\n    }\n  }\n\n  unfixAll() {\n    this.fixedVs = [];\n    this.fixedVs = new Array(this.v.length).fill(false);\n  }\n\n  rotate(x, y, z) {\n    this.resetV();\n\n    let center = this.centroid();\n    let eulerInverse = new thre.Euler();\n    eulerInverse.setFromVector3(this.euler.toVector3().negate(), 'ZYX');\n    this.euler =new thre.Euler(x, y, z);\n\n    for (let i=0; i<this.v.length; i++) {\n      this.v[i].sub(center);\n      this.v[i].applyEuler(eulerInverse);\n      this.v[i].applyEuler(this.euler);\n      this.v[i].add(center);\n    }\n\n    this.recordV();\n  }\n\n}\n\nexport {Model};\n","export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","import logo from './logo.svg';\nimport './style.css';\nimport React, {useRef, useState, useMemo, useEffect, useReducer} from 'react'\nimport * as THREE from 'three'\nimport { extend, Canvas, useFrame, useThree, useResource, useUpdate } from 'react-three-fiber'\n\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport {TransformControls, Stats} from \"drei\";\n// import { EffectComposer, Outline } from 'react-postprocessing'\nextend({OrbitControls})\n\nconst cWhite = new THREE.Color(0.6, 0.6, 0.6);\nconst cChannels = [\n  new THREE.Color(0.3, 0.3, 0.6),\n  new THREE.Color(0.6, 0.6, 0.3),\n  new THREE.Color(0.3, 0.6, 0.3),\n  new THREE.Color(0.3, 0.6, 0.6),\n  new THREE.Color(0.6, 0.3, 0.6),\n];\nconst cPureWhite = new THREE.Color(1, 1, 1);\nconst cBlack = new THREE.Color(0.05, 0.05, 0.05);\nconst cSelected = new THREE.Color(0.3, 0.1, 0.1);\nconst cHovered = new THREE.Color(0.5, 0.2, 0.2);\nconst cFixed = new THREE.Color(0.2, 0.8, 0.8);\nconst cPassive = new THREE.Color(0.15, 0.15, 0.15);\nconst dIn = 0.04;     // diameter of the inner piston\nconst dOut = 0.05;    // diameter of the outer piston\nconst dConstraint = 0.05;    // diameter of the constraint\nconst lConstraint = 0.02;    // length of the constraint\nconst lPiston = 0.527;       // length of each half piston\nconst lTube = 0.330;         // length of tube of each joint\nconst dTube = 0.02;  // diameter of joint tubes\nconst dJoint = 0.04;    // diameter of the joint ball\nconst fps = 30;\nwindow.fps = fps;\n\nfunction Ball({v, d, c, model, handleClick, handlePointerOver, handlePointerOut, setOControls, translating}) {\n\n  const mesh=useRef();\n  const material = useRef();\n  const transControls = useRef();\n  const [dragging, setDragging] = useState(false);\n  const prevPos = new THREE.Vector3();\n\n  useFrame((state)=>{\n\n    if (mesh.current === null)  return;\n\n    mesh.current.position.copy(v);\n    material.current.color.copy(c);\n\n\n    if (translating) {\n      const controls = transControls.current;\n      if (dragging)  {\n        v.copy(controls.worldPosition.clone().add(controls.position));\n        mesh.current.position.copy(v);\n      }\n      else {\n        transControls.current.position.copy(v);\n      }\n    }\n  });\n\n  useEffect(()=>{\n    const callbackDraggingChanged = (e) => {\n      setOControls(!e.value);\n      setDragging(e.value);\n\n      const controls = e.target;\n      if (e.value ===false) {\n        controls.object.position.multiplyScalar(0);\n        model.simulate=true;\n      }\n      else {\n        model.simulate=false;\n        prevPos.copy(controls.worldPosition);\n      }\n    }\n\n    const controls = transControls.current;\n    controls.position.copy(v);\n    if (controls) {\n      controls.addEventListener('dragging-changed', callbackDraggingChanged);\n      return () => {\n        controls.removeEventListener('dragging-changed', callbackDraggingChanged);\n      }\n    }\n  })\n\n  return(\n    <TransformControls\n      ref={transControls}\n      enabled={translating}\n      showX={translating}\n      showY={translating}\n      showZ={translating}\n      mode={\"translate\"}\n      space={\"local\"}\n    >\n      <mesh\n        ref={mesh}\n        position={v}\n        castShadow={true}\n        scale={[d, d, d]}\n        onClick={handleClick}\n        onPointerOver={handlePointerOver}\n        onPointerOut={handlePointerOut}\n      >\n        <sphereBufferGeometry args={[1, 20, 20]}/>\n        <meshStandardMaterial\n          ref={material}\n          color={c}\n        />\n      </mesh>\n    </TransformControls>\n  )\n}\n\nfunction Joint({v, iv, model, setOControls, sharedData}) {\n  const selected = (model.vStatus[iv] === 2);\n  const hovered = (model.vStatus[iv] === 1);\n  const fixed = false;\n  const [translating, setTranslating] = useState(false);\n  const color = new THREE.Color();\n\n  useFrame((sate)=>{\n    const selected = (model.vStatus[iv] === 2);\n    const hovered = (model.vStatus[iv] === 1);\n    const fixed = model.fixedVs[iv];\n    color.copy(selected?cSelected:hovered?cHovered:fixed?cFixed:cWhite);\n    if (sharedData.movingJoint && model.vStatus[iv] === 2 && !translating) {\n      setTranslating(true);\n    }\n    if ((!sharedData.movingJoint || model.vStatus[iv] !== 2) && translating) {\n      setTranslating(false);\n    }\n  });\n\n  const handleClick = (e)=>{\n    if (sharedData.removingJoint) {\n      model.removeJoint(iv);\n      model.precompute();\n      model.recordV();\n      model.forceUpdate();\n    }\n    else if(sharedData.addingJoint){\n      model.addJoint(iv);\n      model.precompute();\n      model.recordV();\n      model.forceUpdate();\n    }\n    else if (sharedData.movingJoint) {\n      model.vStatus.fill(0);\n      model.vStatus[iv] = 2;\n    }\n    else {\n      model.vStatus[iv] = 2;\n    }\n    sharedData.updateGUI();\n    e.stopPropagation();\n  }\n\n  const handlePointerOver = (e)=>{\n    if (model.vStatus[iv] !== 2) model.vStatus[iv] = 1;\n    e.stopPropagation();\n  }\n  const handlePointerOut = (e)=>{\n    if (model.vStatus[iv] !== 2) model.vStatus[iv] = 0;\n    e.stopPropagation();\n  }\n\n  return(\n    <Ball key={\"ball\"} v={v} d={dJoint}\n          model={model}\n          handleClick={handleClick}\n          handlePointerOver={handlePointerOver}\n          handlePointerOut={handlePointerOut}\n          setOControls={setOControls}\n          translating={translating}\n          c={color}/>\n  )\n}\n\nfunction Cylinder({v0, v1, d, c, handleClick, handlePointerOver, handlePointerOut }) {\n  const mesh = useRef();\n  const material = useRef();\n\n  const update = (v0, v1)=>{\n    const pos = v0.clone().add(v1).divideScalar(2);\n    const vec = v1.clone().sub(v0);\n    const axis = new THREE.Vector3(0, 1, 0);\n\n    const l = vec.length();\n    vec.normalize();\n\n    const quaternion = new THREE.Quaternion().setFromUnitVectors(axis, vec);\n    const euler = new THREE.Euler().setFromQuaternion(quaternion);\n    return [pos, l, euler]\n  }\n\n  const [pos, l, euler] = update(v0, v1);\n\n  useFrame((state)=>{\n    if (mesh.current === null)  return;   // TODO: why?\n\n    const [pos, l, euler] = update(v0, v1);\n    mesh.current.position.copy(pos);\n    mesh.current.rotation.copy(euler);\n    mesh.current.scale[1] = l;\n    material.current.color.copy(c);\n  })\n\n  return (\n    <mesh\n      ref={mesh}\n      position={[pos.x, pos.y, pos.z]}\n      rotation={euler}\n      castShadow={true}\n      scale={[d, l, d]}\n      onClick={handleClick}\n      onPointerOver={handlePointerOver}\n      onPointerOut={handlePointerOut}\n    >\n      <cylinderBufferGeometry args={[1, 1, 1, 20]} />\n      <meshLambertMaterial\n        ref={material}\n        color={c}\n      />\n    </mesh>\n  )\n}\n\nfunction Beam({v0, v1, ie, model, sharedData\n              }) {\n  let vec = v1.clone().sub(v0);\n  let l = vec.length();\n  vec.normalize();\n  const vecPiston = vec.clone().multiplyScalar(lPiston);\n  const vecTube = vec.clone().multiplyScalar(lTube);\n  const vecConstraint = vec.clone().multiplyScalar(lConstraint);\n\n  const vOut0 = vecTube.clone().add(v0);\n  const vOut1 = vOut0.clone().add(vecPiston);\n  const vIn0 = v1.clone().sub(vecTube);\n  const vIn1 = vIn0.clone().sub(vecPiston);\n  const vTube00 = v0.clone();\n  const vTube01 = v0.clone().add(vecTube);\n  const vTube11 = v1.clone();\n  const vTube10 = v1.clone().sub(vecTube);\n  const vConstraint0 = vIn0.clone().sub(vec.clone().multiplyScalar(\n    model.lMax[ie] * (model.Model.maxMaxContraction - model.maxContraction[ie])));\n  const vConstraint1 = vConstraint0.clone().add(vecConstraint);\n\n  const cOut = new THREE.Color();\n  const cIn = new THREE.Color();\n  const cJoint = new THREE.Color();\n  const cBeam = new THREE.Color();\n\n  const changeColor =()=>{\n    if (sharedData.showChannel) {\n      const selected = (model.eStatus[ie] === 2);\n      const hovered = (model.eStatus[ie] === 1);\n      const c = cChannels[model.edgeChannel[ie]];\n      cOut.copy(selected ? cSelected : hovered ? cHovered : c);\n      cIn.copy(selected ? cSelected : hovered ? cHovered : c);\n      cJoint.copy(selected ? cSelected : hovered ? cHovered : c);\n      cBeam.copy(selected ? cSelected : hovered ? cHovered : c);\n    }\n    else {\n      const selected = (model.eStatus[ie] === 2);\n      const hovered = (model.eStatus[ie] === 1);\n      cOut.copy(selected ? cSelected : hovered ? cHovered : cBlack);\n      cIn.copy(selected ? cSelected : hovered ? cHovered : cWhite);\n      cJoint.copy(selected ? cSelected : hovered ? cHovered : cWhite);\n      cBeam.copy(selected ? cSelected : hovered ? cHovered : cPassive);\n    }\n  }\n  changeColor();\n\n  useFrame((state)=>{\n    let vec = v1.clone().sub(v0);\n    let l = vec.length();\n    vec.normalize();\n    const vecPiston = vec.clone().multiplyScalar(lPiston);\n    const vecTube = vec.clone().multiplyScalar(lTube);\n    const vecConstraint = vec.clone().multiplyScalar(lConstraint);\n    vOut0.copy(vecTube.clone().add(v0));\n    vOut1.copy(vOut0.clone().add(vecPiston));\n    vIn0.copy(v1.clone().sub(vecTube));\n    vIn1.copy(vIn0.clone().sub(vecPiston));\n    vTube00.copy(v0.clone());\n    vTube01.copy(v0.clone().add(vecTube));\n    vTube11.copy(v1.clone());\n    vTube10.copy(v1.clone().sub(vecTube));\n    vConstraint0.copy(vIn0.clone().sub(vec.clone().multiplyScalar(\n      model.lMax[ie] * (model.Model.maxMaxContraction - model.maxContraction[ie]) )));\n    vConstraint1.copy(vConstraint0.clone().add(vecConstraint));\n\n    changeColor();\n  });\n\n  const handleClick = (e)=>{\n    model.eStatus[ie] = 2;\n    e.stopPropagation();\n  }\n  const handlePointerOver = (e)=>{\n    if (model.eStatus[ie] !== 2) {model.eStatus[ie] = 1;}\n    e.stopPropagation();\n\n    if (sharedData.showInfo) sharedData.infoPanel.style.display = 'block';\n    sharedData.infoPanel.style.left = String(e.clientX) + 'px';\n    sharedData.infoPanel.style.top = String(e.clientY) + 'px';\n    while (sharedData.infoPanel.firstChild) sharedData.infoPanel.removeChild(sharedData.infoPanel.firstChild);\n    sharedData.infoPanel.appendChild(sharedData.infoPanel.ownerDocument.createTextNode(\n      \"L: \" + String(Math.round(model.l[ie] * 1000) / 1000 / 1.2 * 93 ) + \"mm\",\n    ));\n    sharedData.infoPanel.appendChild(sharedData.infoPanel.ownerDocument.createElement(\"br\"));\n    sharedData.infoPanel.appendChild(sharedData.infoPanel.ownerDocument.createTextNode(\n      \"S: \" + String(Math.round(model.l[ie] * 1000) / 1000 / 1.2 * 62 ) + \"mm\",\n    ));\n  }\n  const handlePointerOut = (e)=>{\n    if (model.eStatus[ie] !== 2) {model.eStatus[ie] = 0;}\n    e.stopPropagation();\n    sharedData.infoPanel.style.display = \"none\";\n  }\n\n  const cylinders = [\n    <Cylinder key=\"out\" v0={vOut0} v1={vOut1} d={dOut} c={cOut}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}/>,\n    <Cylinder key=\"in\" v0={vIn0} v1={vIn1} d={dIn} c={cIn}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}/>,\n    <Cylinder key=\"joint0\" v0={vTube00} v1={vTube01} d={dTube} c={cJoint}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}/>,\n    <Cylinder key=\"joint1\" v0={vTube10} v1={vTube11} d={dTube} c={cJoint}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}/>\n    ];\n  if (model.maxContraction[ie] !== model.Model.maxMaxContraction) {\n    cylinders.push(<Cylinder key=\"constraint\" v0={vConstraint0} v1={vConstraint1} d={dConstraint} c={cBlack}/>);\n  }\n\n  if (model.edgeActive[ie]) {\n    return (cylinders)\n  }\n  else {\n    return (\n      [<Cylinder key=\"beam\" v0={v0} v1={v1} d={dTube} c={cBeam}\n                handleClick={handleClick} handlePointerOver={handlePointerOver}\n                 handlePointerOut={handlePointerOut}/>]\n    )\n  }\n\n}\n\nfunction Triangle({vertices, c, opacity, handleClick, handlePointerOver, handlePointerOut}) {\n  const mesh = useRef();\n  const [,forceUpdate] = useReducer(x=>x+1, 0);\n  let vs = [];\n  for (let v of vertices) {\n    vs.push(v.x, v.y, v.z);\n  }\n  const f32array = Float32Array.from(vs);\n\n  return (\n    <mesh\n      ref={mesh}\n      onClick={handleClick}\n      onPointerOver={handlePointerOver}\n      onPointerOut={handlePointerOut}\n    >\n      <bufferGeometry attach={\"geometry\"}>\n        <bufferAttribute\n          attachObject={[\"attributes\", \"position\"]}\n          args={[f32array,3]}\n        />\n      </bufferGeometry>\n      <meshBasicMaterial\n        color={c}\n        opacity={opacity}\n        transparent={true}\n        side={THREE.FrontSide}\n      />\n    </mesh>\n  )\n}\n\nfunction Face({vertices, model, sharedData, i}) {\n\n  const color = new THREE.Color();\n  color.copy(model.fStatus[i] === 2 ? cSelected : model.fStatus[i] === 1 ? cHovered : cBlack);\n\n  const handleClick = (e)=>{\n    if (model.editing) {\n      // model.fStatus[i] = 2;\n      e.stopPropagation();\n      if (sharedData.addingJoint) {\n        model.addPolytope(i);\n        model.forceUpdate();\n      }\n    }\n  }\n\n  const handlePointerOver = (e)=>{\n    if (model.editing) {\n      if (model.fStatus[i] !== 2) model.fStatus[i] = 1;\n      e.stopPropagation();\n    }\n  }\n\n  const handlePointerOut = (e)=>{\n    if (model.editing) {\n      if (model.fStatus[i] !== 2) model.fStatus[i] = 0;\n      e.stopPropagation();\n    }\n  }\n\n  const [,forceUpdate] = useReducer(x=>x+1, 0);\n\n  useFrame( ()=>{\n    if (model.editing) forceUpdate();\n  })\n\n  return (\n    <Triangle vertices={vertices} c={color} opacity={model.editing?0.2:0}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}\n    />\n  )\n}\n\nfunction PneuMesh({\n  model,\n  sharedData,\n  setOControls\n}) {\n\n  const [clock] = React.useState(new THREE.Clock());\n  useFrame((state)=>{\n    const timeUntilNextFrame = (1000 / fps) - clock.getDelta();\n    setTimeout(()=>\n      {\n        state.ready=true;\n        state.invalidate();\n      },\n      Math.max(0, timeUntilNextFrame)\n    )\n    state.ready=false;\n    const nStepsPerSecond = 1 / model.Model.h;\n    model.step(Math.floor((2.4 / model.Model.h ) / fps));\n  }, 0)\n\n\n  const joints=[];\n  const beams=[];\n  const faces = [];\n\n  for (let [i, v] of model.v.entries()) {\n    joints.push(\n      <Joint\n        key={(\"J\" + String(i))}\n        v={v}\n        iv={i}\n        model={model}\n        setOControls={setOControls}\n        sharedData={sharedData}\n      />\n    )\n  }\n\n  for (let [i, e] of model.e.entries()) {\n    const v0 = model.v[e[0]];\n    const v1 = model.v[e[1]];\n    beams.push(\n      <Beam\n        key={(\"B\"+String(i))}\n        v0={v0}\n        v1={v1}\n        ie={i}\n        model={model}\n        sharedData={sharedData}\n        selected={e.selected}\n        hovered={e.hovered}\n      />\n      )\n  }\n\n  // for (let [i, f] of model.faces.entries()) {\n  //   const vertices = f.map(iv=>model.v[iv]);\n  //   faces.push(\n  //     <Face key={\"F\" + String(i)} vertices={vertices} sharedData={sharedData} model={model} i={i}/>\n  //   );\n  // }\n\n  return ([...joints, ...beams])\n}\n\n\nfunction DLight() {\n  const light = new THREE.DirectionalLight(new THREE.Color(1,1,1), 1.2);\n  light.position.set(0, 0, 5);\n  light.castShadow = true;\n  let mapSize = 10\n  light.shadow.mapSize.width = 512 * mapSize;\n  light.shadow.mapSize.height = 512 * mapSize;\n  light.shadow.camera.top = -3 * mapSize;\n  light.shadow.camera.right = 3 * mapSize;\n  light.shadow.camera.left = -3 * mapSize;\n  light.shadow.camera.bottom = 3 * mapSize;\n  light.shadow.camera.near = 0.1;\n  light.shadow.camera.far = 500;\n  return (<primitive object={light}/>)\n}\n\nconst Controls = ({oControls}) => {\n\n  const {\n    camera,\n    gl: { domElement },\n  } = useThree();\n  /* Invoke the OrbitControls' update function on every frame */\n  useFrame(() => oControls.current.update())\n\n  return <orbitControls ref={oControls} args={[camera, domElement]}/>\n}\n\nfunction Viewer({model, sharedData}) {\n  const oControls = useRef();\n  model.controls = oControls;\n  const [, forceUpdate] = useReducer(x => { return (x+1)}, 0);\n  model.forceUpdate = forceUpdate;\n\n  function setOControls(s){\n    oControls.current.enabled = s\n  }\n\n  return (\n      <Canvas\n        shadowMap={true}\n        concurrent={true}\n        onCreated={({gl, camera}) => {\n          let intensity = 0.92\n          gl.setClearColor(new THREE.Color(intensity, intensity, intensity))\n          gl.setPixelRatio(window.devicePixelRatio);  // required\n          gl.shadowMap.enabled=true;  // default\n          gl.shadowMap.type=THREE.PCFSoftShadowMap; // default\n        }}\n        camera={{\n          fov: 45,\n          position:[0, -20, 1],\n          up:[0, 0, 1]\n        }}\n\n        gl={{antialias:true}}\n      >\n        <Controls oControls={oControls}/>\n        <ambientLight\n          color={new THREE.Color(1, 1, 1)}\n          intensity={0.5}\n        />\n\n        <DLight/>\n\n        <mesh\n          position={[0, 0, 0]}\n          receiveShadow={true}\n          visible={true}\n        >\n          <planeGeometry args={[10000, 10000]}/>\n          <shadowMaterial opacity={0.3}/>\n        </mesh>\n\n        <gridHelper\n          args={[100, 100]}\n          rotation-x={-Math.PI/2}\n          position-z={0}\n          visible={true}\n        />\n\n        <PneuMesh model={model} sharedData={sharedData} setOControls={setOControls}/>\n        <Stats/>\n\n      </Canvas>\n  );\n}\n\nexport default Viewer;\n","import './style.css';\nimport React, {useRef, useState, useMemo, useReducer} from 'react'\nimport {makeStyles, Grid, List, ListItem, ListItemIcon, ListItemText, Divider,\n        Icon, Slider, Switch, Typography, IconButton}\n        from '@material-ui/core'\nimport { extend, Canvas, useFrame, useThree, useResource, useUpdate } from 'react-three-fiber'\nimport {AccessAlarm, Publish, GetApp, ChevronLeft, Edit, GpsFixed, GpsNotFixed,\n        RadioButtonChecked, RadioButtonUnchecked, FilterCenterFocus,\n        SettingsEthernet, WbSunny, FiberManualRecord, Lock, LockOpen} from \"@material-ui/icons\";\n\nconst cBackground = \"rgba(200, 200, 200, 0.6)\";\n\nconst cHovered = \"rgba(250, 250, 250, 0.9)\";\nconst cOff = \"rgba(150, 150, 150, 1)\";\n\nconst cChannels = [\n  \"rgb(100, 100, 200)\",\n  \"rgb(200, 200, 100)\",\n  \"rgb(100, 200, 100)\",\n  \"rgb(100, 200, 200)\",\n  \"rgb(200, 100, 200)\",\n];\n\nconst widthBlock = 5;   // vh\nconst heightBlock = 5;    // vh\nconst paddingBlock = 1;   // vh\nconst marginBlock = 0.5;     // vh\nconst paddingBlocks = 0.5;\nconst widthSlider = 30;\nconst marginSlider = 0.1;\nconst widthSliders = (widthSlider + marginSlider * 2);\n\n\nconst useStyles = makeStyles((theme) => ({\n  mainGUI: {\n    position: \"absolute\",\n    right: \"1.5vh\",\n    top: \"1.5vh\",\n    width: \"28vh\",\n    height: \"auto\",\n    background: cBackground,\n    \"& .MuiList-root\" : {\n      \"& .MuiListItem-root\" : {\n        minHeight: \"6vh\"\n      }\n    }\n  },\n  editingGUI: {\n    position: \"absolute\",\n    right: \"30vh\",\n    top: \"1.5vh\",\n    width: \"30vh\",\n    // height: \"30vh\",\n    background: cBackground,\n  },\n  scriptGUI: {\n    position: \"absolute\",\n    left: \"2vh\",\n    bottom: \"2vh\",\n    background: cBackground,\n  },\n  editingScriptGUI: {\n    position: \"absolute\",\n    right: \"30vh\",\n    top: \"40vh\",\n    width: \"40vh\",\n    background: cBackground,\n  }\n}))\n\nfunction SettingActive({model, updateGUI}) {\n  const icons = [];\n\n  let passive =\n    ![...Array(model.e.length).keys()].every(ie=>(\n      (model.eStatus[ie] !== 2) || (model.eStatus[ie] === 2 && model.edgeActive[ie] === true)\n    ));\n\n  let active =\n    ![...Array(model.e.length).keys()].every(ie=>(\n      (model.eStatus[ie] !== 2) || (model.eStatus[ie] === 2 && model.edgeActive[ie] === false)\n    ));\n\n  icons.push(\n    <Grid item key={\"active\"} style={{width: \"50%\", textAlign: \"center\"}}>\n    <IconButton\n      size={\"small\"}\n      onClick={()=> {\n          for (let ie = 0; ie < model.e.length; ie++) {\n            if (model.eStatus[ie] === 2) {\n              model.edgeActive[ie] = true;\n              model.lMax[ie] = model.Model.defaultMaxLength;\n            }\n          }\n          updateGUI();\n          setTimeout(model.forceUpdate, 50);\n        }\n      }\n    >\n      <WbSunny/>\n    </IconButton>\n    </Grid>\n  )\n\n  icons.push(\n    <Grid item key={\"passive\"} style={{width: \"50%\", textAlign: \"center\"}}>\n    <IconButton\n      size={\"small\"}\n      onClick={()=> {\n          for (let ie = 0; ie < model.e.length; ie++) {\n            if (model.eStatus[ie] === 2) {\n              model.edgeActive[ie] = false;\n            }\n          }\n          updateGUI();\n          setTimeout(model.forceUpdate, 50);\n        }\n      }\n    >\n      <FiberManualRecord/>\n    </IconButton>\n    </Grid>\n  )\n\n\n  return (\n    <ListItem>\n      <ListItemText style={{width: \"50%\"}}>\n        Active / Passive\n      </ListItemText>\n      <Grid container style={{width: \"50%\"}}>\n        {icons}\n      </Grid>\n    </ListItem>\n  )\n}\n\nfunction SettingChannel({n, model, updateGUI}) {\n  const icons = [];\n\n  for (let i=0; i<n; i++) {\n    let checked =\n      ![...Array(model.e.length).keys()].every(ie=>(\n        (model.eStatus[ie] !== 2) || ((model.eStatus[ie] === 2) && (model.edgeChannel[ie] !== i))\n      ))\n\n    icons.push(\n      <Grid key={i} item style={{width: `${1/n * 100}%`, textAlign: \"center\"}} >\n        <IconButton\n          size={\"small\"}\n          onClick={()=> {\n              for (let ie = 0; ie < model.e.length; ie++) {\n                if (model.eStatus[ie] === 2) {\n                  model.edgeChannel[ie] = i;\n                }\n              }\n              updateGUI();\n\n            }\n          }\n        >\n          {checked? <RadioButtonChecked/> :  <RadioButtonUnchecked/>}\n        </IconButton>\n      </Grid>\n    )\n  }\n\n  return (\n  <ListItem>\n    <Grid container styles={{width: \"50%\"}}>\n      {icons}\n    </Grid>\n  </ListItem>\n  )\n}\n\nfunction ControlChannel({n, model, updateGUI}) {\n  const switches = [];\n\n  for (let i=0; i<n; i++) {\n    switches.push(\n      <Grid key={i} item style={{width: `${1/n * 100}%`, textAlign: \"center\"}}>\n        <Switch\n          size={\"small\"}\n          checked={model.inflateChannel[i]}\n          onClick={(e)=>{\n            console.log(e.target.checked);\n            model.inflateChannel[i] = e.target.checked;\n            updateGUI();\n          }}\n        />\n        </Grid>\n    );\n  }\n\n\n  return(\n    <ListItem>\n      <Grid container styles={{width: \"100%\"}} alignItems={\"center\"}>\n        {switches}\n      </Grid>\n    </ListItem>\n  )\n}\n\nfunction Scripts({model, sharedData, updateGUI, classes}) {\n  model.precompute();\n  const widthBlocks = (widthBlock + marginBlock * 2) * model.numActions + paddingBlocks * 2;\n\n  const Block = ({model, iChannel, iAction}) => {\n    const [hovered, setHovered] = useState(false);\n    const isOn = model.script[iChannel][iAction];\n    const [actuating, setActuating] = useState(iAction===model.iAction);\n\n    return (\n      <Grid item\n            key={iAction}\n            className={classes.scriptBlock}\n            style={{\n              background: cChannels[iChannel],\n              width: `${widthBlock}vh`,\n              height: `${heightBlock}vh`,\n              padding: `${paddingBlock}vh`,\n              margin: `${marginBlock}vh`,\n              border: `2px ${hovered?\"solid\":\"none\"} ${cHovered}`,\n              opacity: `${isOn?1:hovered?0.4:0.1}`\n            }}\n            onPointerOver={()=>{setHovered(true)}}\n            onPointerOut={()=>{setHovered(false)}}\n            onClick={()=>{model.script[iChannel][iAction]=!isOn}}\n      >\n      </Grid>\n    )\n  }\n\n  const Row = ({model, iChannel}) => {\n    const blocks = [];\n    for (let iAction=0; iAction<model.numActions; iAction++) {\n      const isOn=true;\n      blocks.push(\n        <Block key={iAction} model={model} isOn={isOn} iChannel={iChannel} iAction={iAction} />\n      );\n    }\n\n    return(\n      <Grid container item spacing={0}>\n        {/*<React.Fragment>*/}\n          {blocks}\n        {/*</React.Fragment>*/}\n      </Grid>\n    )\n  }\n\n  const rows = [];\n  for (let iChannel=0; iChannel<model.numChannels; iChannel++) {\n    rows.push(<Row key={iChannel} iChannel={iChannel} model={model}/>)\n  }\n\n  return ([\n    <Grid key={'buttons'} container item spacing={0} style={{padding:`${paddingBlocks}vh`, width: `${widthBlocks}vh`}}>\n      {rows}\n    </Grid>,\n\n    ]\n  );\n}\n\n\nfunction GUI({model, options, sharedData}) {\n\n  const [, updateGUI] = useReducer(x => x+1, 0);\n  sharedData.updateGUI = updateGUI;\n  window.updateGUI = updateGUI;\n\n  const classes = useStyles();\n\n  const load = (e)=>{\n    let input = document.createElement('input');\n    document.body.appendChild(input);\n    input.type = 'file';\n    input.id = 'inputFile';\n    input.style = 'display:none';\n\n    document.getElementById(\"inputFile\").click();\n    document.getElementById(\"inputFile\").onchange = ()=>{\n\n      let reader = new FileReader();\n      reader.onload = (event) => {\n        let inputFileString = event.target.result;\n        window.inputFileString = inputFileString;\n        let data = JSON.parse(inputFileString);\n        window.data =data;\n        model.loadDict(data);\n        model.simulate=false;\n        model.gravity=true;\n        model.forceUpdate();\n        updateGUI();\n      };\n      reader.readAsText(document.getElementById(\"inputFile\").files[0]);\n      document.body.removeChild(input);\n    };\n  }\n\n  const save = (e)=>{\n    let data = model.saveData();\n    let json = JSON.stringify(data);\n\n    let download = document.createElement('a');\n    document.body.appendChild(download);\n    download.download = 'download.json';\n    download.style.display = 'none';\n    download.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(json);\n    download.click();\n    document.body.removeChild(download);\n  }\n\n  return (\n    [\n    <div key={\"mainGUI\"} className={classes.mainGUI}\n         onPointerOver={(e)=>{sharedData.GUIHovered=true}}\n         onPointerOut={(e)=>{sharedData.GUIHovered=false}}\n    >\n      <List>\n        <ListItem button selected={false}\n                  onClick={load}>\n          <ListItemIcon>\n            <Publish/>\n          </ListItemIcon>\n          <ListItemText>\n            Load\n          </ListItemText>\n        </ListItem>\n\n\n        <ListItem button\n                  onClick={save}>\n          <ListItemIcon>\n            <GetApp/>\n          </ListItemIcon>\n          <ListItemText>\n            Download\n          </ListItemText>\n        </ListItem>\n\n        <Divider/>\n\n        <ListItem button selected={model.editing}\n                  onClick={(e)=>{\n                    model.editing = !model.editing;\n                    model.Model.gravity = !model.editing;\n                    model.simulate = true;\n                    model.gravity = !model.editing;\n                    sharedData.movingJoint = false;\n                    sharedData.removingJoint = false;\n                    sharedData.addingJoint = false;\n                    updateGUI();\n                    if (model.editing) {\n                      model.resetV();\n                    }\n                    model.forceUpdate();\n                  }}>\n          <ListItemIcon>\n            <ChevronLeft/>\n          </ListItemIcon>\n          <ListItemText>\n            Edit Shape\n          </ListItemText>\n        </ListItem>\n\n\n        <ListItem>\n          <Typography style={{width: \"50%\"}}>\n            Contraction\n          </Typography>\n          <Slider\n            style={{width: \"50%\"}}\n            disabled={\n             model.eStatus.includes(2) ?\n               ![...Array(model.e.length).keys()].every(ie=>(\n                 (model.eStatus[ie]===2 && model.edgeActive[ie]) || (model.eStatus[ie] !==2))) :\n                 true\n            }\n            defaultValue={model.Model.maxMaxContraction}\n            aria-labelledby={\"discrete-slider-custom\"}\n            step={model.Model.contractionInterval}\n            min={0}\n            max={model.Model.maxMaxContraction}\n            valueLabelDisplay={\"auto\"}\n            onChange={(e, val)=>{\n              for (let i=0; i<model.e.length; i++) {\n                if (model.eStatus[i] === 2) {\n                  model.maxContraction[i] = val;\n                }\n              }\n            }}\n            onPointerUp={()=>{model.forceUpdate();}}\n          />\n        </ListItem>\n\n        <ListItem>\n          <Typography style={{width: \"50%\"}}>\n            Length\n          </Typography>\n            <Slider\n              style={{width: \"50%\"}}\n              disabled={\n                model.eStatus.includes(2) ?\n                  ![...Array(model.e.length).keys()].every(ie=>(\n                    (model.eStatus[ie]===2 && !model.edgeActive[ie]) || (model.eStatus[ie] !==2))) :\n                  true\n              }\n              defaultValue={model.Model.defaultMinLength}\n              aria-labelledby={\"discrete-slider-custom\"}\n              step={model.Model.contractionInterval * model.Model.defaultMaxLength}\n              min={model.Model.defaultMinLength}\n              max={model.Model.defaultMaxLength}\n              valueLabelDisplay={\"auto\"}\n              // marks={marks}\n              onChange={\n                (e, val)=>{\n                  for (let i=0; i<model.e.length; i++) {\n                    if (model.eStatus[i] === 2 && model.edgeActive[i] === false) {\n                      model.lMax[i] = val;\n                    }\n                  }\n                }\n              }\n              onPointerUp={()=>{model.forceUpdate()}}\n            />\n        </ListItem>\n\n        <ListItem>\n          <ListItemText style={{width: \"50%\"}}>\n            Fix Joints\n          </ListItemText>\n          <Grid container style={{width: \"50%\"}}  spacing={0} alignItems={\"center\"}>\n          <Grid item key={\"fix\"} style={{width: \"50%\" , textAlign: \"center\"}}>\n\n          <IconButton\n            size={\"small\"}\n            onClick={(e)=>{\n              for (let i=0; i<model.v.length; i++) {\n                if (model.vStatus[i] === 2) model.fixedVs[i] = true;\n              }\n              updateGUI();\n              model.forceUpdate();\n            }}>\n              <Lock/>\n          </IconButton>\n          </Grid>\n\n            <Grid item key={\"unfix\"} style={{width: \"50%\" , textAlign: \"center\"}}>\n          <IconButton\n            size={\"small\"}\n            onClick={(e)=>{\n              for (let i=0; i<model.v.length; i++) {\n                if (model.vStatus[i] === 2) model.fixedVs[i] = false;\n              }\n              updateGUI();\n              model.forceUpdate();\n            }}>\n              <LockOpen/>\n          </IconButton>\n          </Grid>\n          </Grid>\n\n        </ListItem>\n\n        <SettingActive model={model} updateGUI={updateGUI}/>\n\n\n        <Divider/>\n\n        <ListItem button selected={sharedData.editingScript}\n                  onClick={(e)=>{\n                    sharedData.editingScript = !sharedData.editingScript;\n                    updateGUI();\n                  }}>\n          <ListItemIcon>\n            <ChevronLeft/>\n          </ListItemIcon>\n          <ListItemText>\n            Script & Channel\n          </ListItemText>\n        </ListItem>\n\n        <SettingChannel n={model.numChannels} model={model} updateGUI={updateGUI}/>\n\n        <ControlChannel n={model.numChannels} model={model} updateGUI={updateGUI}/>\n\n        <Divider/>\n\n        <ListItem>\n          <ListItemText>\n            Gravity\n          </ListItemText>\n          <Switch\n            i={0}\n            checked={model.gravity}\n            onChange={(e)=>{\n              model.gravity = !model.gravity;\n              updateGUI();\n            }}\n          />\n        </ListItem>\n\n\n        <ListItem>\n          <ListItemText>\n            Simulate\n          </ListItemText>\n          <Switch\n            i={0}\n            checked={model.simulate}\n            onChange={(e)=>{\n              model.simulate = !model.simulate;\n              updateGUI();\n            }}\n          />\n        </ListItem>\n\n\n        <ListItem>\n          <Typography style={{width: \"50%\"}}>\n            Friction\n          </Typography>\n          <Slider\n            style={{width: \"50%\"}}\n            defaultValue={model.Model.frictionFactor}\n            aria-labelledby={\"discrete-slider-custom\"}\n            step={0.1}\n            min={0}\n            max={1}\n            valueLabelDisplay={\"auto\"}\n            // marks={marks}\n          />\n        </ListItem>\n\n        <Divider/>\n\n        <ListItem button\n                  onClick={(e)=>{\n                    model.controls.current.target = model.centroid();\n                    model.forceUpdate();\n                  }}>\n          <ListItemIcon>\n            <FilterCenterFocus/>\n          </ListItemIcon>\n          <ListItemText>\n            Look At Center\n          </ListItemText>\n        </ListItem>\n\n\n        <ListItem>\n          <ListItemText>\n            Channel Color\n          </ListItemText>\n          <Switch\n            i={1}\n            checked={sharedData.showChannel}\n            onChange={(e)=>{\n              sharedData.showChannel = !sharedData.showChannel;\n              updateGUI();\n            }}\n          />\n        </ListItem>\n\n        <ListItem>\n          <ListItemText>\n            Length Info\n          </ListItemText>\n          <Switch\n            i={2}\n            checked={sharedData.showInfo}\n            onChange={(e)=>{\n              sharedData.showInfo = !sharedData.showInfo;\n              updateGUI();\n            }}\n          />\n        </ListItem>\n\n      </List>\n    </div>,\n\n\n    <div key={\"editingGUI\"} className={classes.editingGUI}\n         style={model.editing ? {display: \"block\"} : {display: \"none\"}}\n         onPointerOver={(e)=>{sharedData.GUIHovered=true}}\n         onPointerOut={(e)=>{sharedData.GUIHovered=false}}\n    >\n        <List>\n          <ListItem>\n            <ListItemText>\n              Add Joint\n            </ListItemText>\n            <Switch\n              key={\"add_joint\"}\n              checked={sharedData.addingJoint}\n              onChange={(e,val)=>{\n                sharedData.addingJoint = val;\n                if (val) {\n                  sharedData.removingJoint = false;\n                  sharedData.movingJoint = false;\n                }\n                updateGUI();\n              }}\n            />\n          </ListItem>\n\n          <ListItem>\n            <ListItemText>\n              Move Joint\n            </ListItemText>\n            <Switch\n              key={\"add_joint\"}\n              checked={sharedData.movingJoint}\n              onChange={(e,val)=>{\n                sharedData.movingJoint = val;\n                if (val) {\n                  sharedData.removingJoint = false;\n                  sharedData.addingJoint = false;\n                }\n                model.simulate = true;\n                model.resetSelection();\n                updateGUI();\n              }}\n            />\n          </ListItem>\n\n          <ListItem>\n            <ListItemText>\n              Remove Joint\n            </ListItemText>\n            <Switch\n              key={\"remove_joint\"}\n              checked={sharedData.removingJoint}\n              onChange={(e,val)=>{\n                sharedData.removingJoint = val;\n                if (val) {\n                  sharedData.addingJoint = false;\n                  sharedData.movingJoint = false;\n                }\n                updateGUI();\n              }}\n            />\n          </ListItem>\n\n          <ListItem button\n                    onClick={(e)=>{\n                      const iJoints = [];\n                      for (let i=0; i<model.v.length; i++) {\n                        if (model.vStatus[i] === 2) iJoints.push(i);\n                      }\n                      model.addEdges(iJoints);\n                      model.precompute();\n                      model.forceUpdate();\n                      updateGUI();\n                    }}>\n            <ListItemIcon>\n              <SettingsEthernet />\n            </ListItemIcon>\n            <ListItemText>\n              Connect Joints\n            </ListItemText>\n          </ListItem>\n\n          <ListItem>\n            <ListItemText>\n              X:\n            </ListItemText>\n            <Slider\n              defaultValue={0}\n              arial-labelledby={\"continuous-slider\"}\n              step={0.01}\n              min={-Math.PI}\n              max={Math.PI}\n              valueLabelDisplay={\"auto\"}\n              onChange={(e, val)=>{\n                model.rotate(val, model.euler.y, model.euler.z);\n                model.resetV();\n              }}\n            />\n          </ListItem>\n\n\n          <ListItem>\n            <ListItemText>\n              Y:\n            </ListItemText>\n            <Slider\n              defaultValue={0}\n              arial-labelledby={\"continuous-slider\"}\n              step={0.01}\n              min={-Math.PI}\n              max={Math.PI}\n              valueLabelDisplay={\"auto\"}\n              onChange={(e, val)=>{\n                model.rotate(model.euler.x, val, model.euler.z);\n                model.resetV();\n              }}\n            />\n          </ListItem>\n\n          <ListItem>\n            <ListItemText>\n              Z:\n            </ListItemText>\n            <Slider\n              defaultValue={0}\n              arial-labelledby={\"continuous-slider\"}\n              step={0.01}\n              min={-Math.PI}\n              max={Math.PI}\n              valueLabelDisplay={\"auto\"}\n              onChange={(e, val)=>{\n                model.rotate(model.euler.x, model.euler.y, val);\n                model.resetV();\n              }}\n            />\n          </ListItem>\n        </List>\n\n\n    </div>,\n\n    <div key={\"scriptGUI\"} className={classes.scriptGUI}\n         style={sharedData.editingScript ? {display: \"block\"} : {display: \"block\"}}\n         onPointerOver={(e)=>{sharedData.GUIHovered=true}}\n         onPointerOut={(e)=>{sharedData.GUIHovered=false}}\n    >\n      <Scripts model={model} sharedData={sharedData} classes={classes} updateGUI={updateGUI}/>\n    </div>,\n\n\n    <div key={\"editingScriptGUI\"} className={classes.editingScriptGUI}\n         style={sharedData.editingScript ? {display: \"block\"} : {display: \"none\"}}\n         onPointerOver={(e)=>{sharedData.GUIHovered=true}}\n         onPointerOut={(e)=>{sharedData.GUIHovered=false}}\n    >\n\n      <Grid key={'numChannels'} container item spacing={2} alignItems={\"center\"} style={{\n        padding:`${paddingBlocks}vh`, paddingTop:'0', paddingBottom:'0', width: `${widthSliders + 20}vh`\n      }}>\n        <Grid item style={{margin: `${marginSlider}vh`, width: \"10vh\", fontSize:\"small\"}}>\n          Channels\n        </Grid>\n        <Grid item style={{margin:`${marginSlider}vh` , width: `${widthSlider}vh`}}>\n\n          <Slider\n            key={'numChannels'}\n            defaultValue={model.Model.defaultNumChannels}\n            aria-labelledby={\"discrete-slider-custom\"}\n            step={1}\n            min={1}\n            max={5}\n            valueLabelDisplay={\"auto\"}\n            onChange={(e, val)=>{\n              model.numChannels = val;\n              model.precompute();\n              updateGUI();\n            }}\n          />\n        </Grid>\n      </Grid>\n\n      <Grid key={'numActions'} container item spacing={2} alignItems={\"center\"} style={{\n        padding:`${paddingBlocks}vh`, paddingTop:'0', paddingBottom:'0', width: `${widthSliders + 20}vh`\n      }}>\n        <Grid item style={{margin: `${marginSlider}vh`,  width: \"10vh\", fontSize:\"small\"}}>\n          Actions\n        </Grid>\n        <Grid item style={{margin:`${marginSlider}vh` , width: `${widthSlider}vh`}}>\n\n          <Slider\n            key={'numActions'}\n            defaultValue={model.Model.defaultNumActions}\n            aria-labelledby={\"discrete-slider-custom\"}\n            step={1}\n            min={1}\n            max={20}\n            valueLabelDisplay={\"auto\"}\n            onChange={(e, val)=>{\n              model.numActions = val;\n              model.precompute();\n              updateGUI();\n            }}\n          />\n        </Grid>\n      </Grid>\n\n    </div>\n\n\n  ]\n  )\n}\n\n\nexport default GUI;\n","import {Model} from './model.js'\nimport Viewer from './viewer.js'\nimport GUI from './gui';\nimport React, {useRef} from \"react\";\n\n\nfunction Main() {\n  let model = new Model();\n  window.model = model;\n\n  const sharedData = {\n    updateGUI: null,\n    GUIHovered: false,\n    unSelect: false,\n    addingJoint: false,\n    movingJoint: false,\n    removingJoint: false,\n    showChannel: false,\n    editingScript: false,\n    numActions: 20,\n    numChannels: 4,\n    infoPanel: null,\n    showInfo: false\n  };\n  model.sharedData = sharedData;\n  window.sharedData = sharedData;\n\n  sharedData.infoPanel = document.getElementById('infoPanel');\n  if (!sharedData.infoPanel) {\n    sharedData.infoPanel = document.createElement('div');\n    document.body.appendChild(sharedData.infoPanel);\n  }\n  sharedData.infoPanel.id = 'infoPanel';\n  sharedData.infoPanel.style.background = 'rgba(255, 255, 255, 0.9)';\n  sharedData.infoPanel.style.position = 'absolute';\n  sharedData.infoPanel.style.padding = '10px';\n  sharedData.infoPanel.appendChild(sharedData.infoPanel.ownerDocument.createTextNode(\" \"));\n\n\n\n  window.addEventListener('pointerdown', (e)=>{\n    sharedData.unSelect = true;\n  }, false);\n\n  window.addEventListener('pointermove', (e)=>{\n    sharedData.unSelect = false;\n  }, false);\n\n  window.addEventListener('pointerup', (e)=>{\n    if (sharedData.unSelect) {\n      if (!sharedData.GUIHovered) {\n        if (model.vStatus.every(b => b !== 1) && model.eStatus.every(b => b !== 1) && model.fStatus.every(b => b !== 1)) {\n          model.vStatus.fill(0);\n          model.eStatus.fill(0);\n          model.fStatus.fill(0);\n        }\n      }\n\n      if (sharedData.updateGUI) setTimeout(() => {\n        sharedData.updateGUI()\n      }, 10);\n    }\n\n  }, false);\n\n  window.addEventListener('keydown', (e)=>{\n      if (e.code === \"KeyA\" && (e.metaKey || e.ctrlKey)) {\n        model.eStatus.fill(2);\n        model.vStatus.fill(2);\n      }\n    }\n  , false)\n\n  return (\n    [\n      <Viewer key={'viewer'} model={model} sharedData={sharedData}/>,\n      <GUI id={'hehe'}key={'gui'} model={model} sharedData={sharedData}/>\n    ]\n  )\n\n}\n\nexport default Main;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport Main from './main';\nimport GUI from './gui';\nimport reportWebVitals from './reportWebVitals';\n\nlet root = document.getElementById('root');\nReactDOM.render(\n  <React.StrictMode>\n    <Main />\n  </React.StrictMode>,\n  root\n);\n\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}