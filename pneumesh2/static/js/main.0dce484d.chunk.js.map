{"version":3,"sources":["model.js","logo.svg","viewer.js","gui.js","main.js","reportWebVitals.js","index.js"],"names":["Vertex","pos","fixed","pos0","vel","force","this","vs","es","fs","id","all","length","push","Edge","lMax","maxContraction","edgeChannel","edgeActive","l","iv","Model","viewer","controls","sharedData","configure","reset","loadData","resetSelection","recordV","v","e","v0","c","a0","fixedVs","script","f","vStatus","eStatus","fStatus","iAction","numSteps","timeStart","Date","editing","simulate","gravity","directional","euler","thre","numChannels","defaultNumChannels","numActions","defaultNumActions","inflateChannel","Array","fill","contractionPercent","data","console","log","from","p","i","Math","sqrt","updateCorners","precompute","initCheck","x","y","z","slice","actions","clone","prevData","same","JSON","stringify","saveData","iHistory","sameData","history","shift","applyHistory","zOffset","bbox","vv","copy","copyArrays","oldValue","newValue","min","distanceTo","maxMaxContraction","defaultMaxLength","map","_","iChannel","updateDataStructure","e0","e1","getAngle","alpha","ids","iO","iA","iB","vec0","sub","vec1","angleTo","abs","angleThreshold","vec","l0","lMin","k","normalize","multiplyScalar","add","negate","gravityFactor","numStepsAction","floor","n","scripting","iStep","runScript","contractionPercentRate","update","movingJoint","h","frictionFactor","dampingRatio","pow","ceil","angleCheckFrequency","assert","checkCorners","iJoint","defaultMinLength","iJoints","j","notExist","includes","ees","ee","filter","reindexObjects","updateFromDataStructure","forceUpdate","iEdge","center","divideScalar","cent","centroid","xMax","yMax","zMax","xMin","yMin","zMin","max","ivs","centFront","rotRadZ","atan2","PI","rotateTo","t","getTime","Infinity","alert","eulerInverse","setFromVector3","toVector3","applyEuler","file","rawFile","XMLHttpRequest","open","onreadystatechange","readyState","status","json","parse","contractionInterval","contractionLevels","round","Boolean","numStepsActionMultiplier","angleCheckFrequencyMultiplier","setting","responseText","send","readTextFile","indices","vs0","vs1","error","O","A","B","cls","extend","OrbitControls","cWhite","THREE","cChannels","cBlack","cSelected","cHovered","cFixed","cPassive","dTube","viewChannel","Ball","d","model","handleClick","handlePointerOver","handlePointerOut","setOControls","translating","mesh","useRef","material","transControls","useState","dragging","setDragging","prevPos","useFrame","state","current","position","color","worldPosition","useEffect","callbackDraggingChanged","value","target","object","recordHistory","addEventListener","removeEventListener","TransformControls","ref","enabled","showX","showY","showZ","mode","space","castShadow","scale","onClick","onPointerOver","onPointerOut","args","Joint","setTranslating","sate","selected","hovered","removingJoint","removeJoint","addingJoint","addJoint","updateGUI","stopPropagation","Cylinder","v1","opacity","transparent","axis","quaternion","setFromUnitVectors","setFromQuaternion","rotation","Beam","ie","vecPiston","vecTube","vecConstraint","vOut0","vOut1","vIn0","vIn1","vTube00","vTube01","vTube11","vTube10","vConstraint0","vConstraint1","cOut","cIn","cJoint","cBeam","cInner","changeColor","showChannel","showInfo","infoPanel","style","display","left","String","clientX","top","clientY","firstChild","removeChild","appendChild","ownerDocument","createTextNode","createElement","transpacency","cylinders","PneuMesh","React","clock","timeUntilNextFrame","getDelta","setTimeout","ready","invalidate","step","joints","beams","entries","DLight","light","set","shadow","mapSize","width","height","camera","right","bottom","near","far","window","fps","Controls","oControls","useThree","domElement","gl","Viewer","useReducer","updateModel","shadowMap","concurrent","onCreated","setClearColor","setPixelRatio","devicePixelRatio","type","fov","up","antialias","intensity","receiveShadow","visible","rotation-x","position-z","s","cBackground","paddingBlocks","marginSlider","useStyles","makeStyles","theme","mainGUI","background","minHeight","editingGUI","scriptGUI","editingScriptGUI","SettingActive","icons","keys","every","Grid","item","textAlign","IconButton","size","WbSunny","FiberManualRecord","ListItem","ListItemText","container","SettingChannel","checked","RadioButtonChecked","RadioButtonUnchecked","styles","ControlChannel","switches","Switch","alignItems","Scripts","classes","widthBlocks","Block","setHovered","isOn","className","scriptBlock","padding","margin","border","Row","blocks","spacing","rows","GUI","options","GUIHovered","List","button","download","document","body","href","encodeURIComponent","click","ListItemIcon","GetApp","input","getElementById","onchange","reader","FileReader","onload","event","inputFileString","result","loadDict","readAsText","files","Publish","Divider","editingScript","ChevronLeft","Typography","Slider","disabled","defaultValue","aria-labelledby","valueLabelDisplay","onChange","val","onPointerUp","Lock","LockOpen","FilterCenterFocus","addEdges","SettingsEthernet","arial-labelledby","onMouseDown","onMouseUp","AddCircleOutlineRounded","iJointsSelected","align","VerticalAlignCenter","paddingTop","paddingBottom","widthSliders","fontSize","unSelect","b","code","metaKey","ctrlKey","shiftKey","undo","redo","Main","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","root","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.0dce484d.chunk.js","sourcesContent":["import * as thre from 'three';\nimport React, {useRef, useState, useMemo} from 'react'\n\nclass Vertex {\n  static all = [];\n\n  constructor(pos, fixed, pos0, vel, force) {\n    this.pos = pos;     // thre.Vector3\n    this.fixed = fixed;\n    this.pos0 = pos0;\n    this.vel = vel;\n    this.force =force;\n    this.vs =[];  // neighbor vertices\n    this.es = [];   // neighbor edges\n    this.fs = [];   // incident faces\n\n    this.id = Vertex.all.length;\n    Vertex.all.push(this);\n  }\n}\n\nclass Edge {\n  static all = [];\n\n  constructor(vs, lMax, maxContraction, edgeChannel, edgeActive, l) {\n    this.vs = [];\n    this.lMax = lMax;\n    this.maxContraction = maxContraction;\n    this.edgeChannel = edgeChannel;\n    this.edgeActive = edgeActive;\n    this.l = l;\n\n    for (let iv of vs) {\n      this.vs.push(Vertex.all[iv]);\n    }\n    Vertex.all[vs[0]].vs.push(Vertex.all[vs[1]]);\n    Vertex.all[vs[1]].vs.push(Vertex.all[vs[0]]);\n    Vertex.all[vs[0]].es.push(this);\n    Vertex.all[vs[1]].es.push(this);\n\n    this.id = Edge.all.length;\n    Edge.all.push(this);\n  }\n\n}\n\nclass Model {\n  static history = [];\n  static iHistory = -1;\n\n  static configure() {\n    let setting = (json) => {\n      let data = JSON.parse(json);\n      Model.k = data.k;\n      Model.h = data.h;\n      Model.dampingRatio = data.dampingRatio;\n      Model.contractionInterval = data.contractionInterval;\n      Model.contractionLevels = data.contractionLevels;\n      Model.maxMaxContraction = Math.round(Model.contractionInterval * (Model.contractionLevels - 1) * 100) /100;\n      Model.contractionPercentRate = data.contractionPercentRate;\n      Model.gravityFactor = data.gravityFactor;\n      Model.gravity = Boolean(data.gravity);\n      Model.defaultMinLength = data.defaultMinLength;\n      Model.defaultMaxLength = Model.defaultMinLength / (1 - Model.maxMaxContraction);\n      Model.frictionFactor = data.frictionFactor;\n      Model.numStepsAction = data.numStepsActionMultiplier / Model.h;\n      Model.defaultNumActions = data.defaultNumActions;\n      Model.defaultNumChannels = data.defaultNumChannels;\n      Model.angleThreshold = data.angleThreshold;\n      Model.angleCheckFrequency = Model.numStepsAction * data.angleCheckFrequencyMultiplier;  // every # steps check angle thresholds\n    }\n\n    function readTextFile(file)\n    {\n      let rawFile = new XMLHttpRequest();\n      rawFile.open(\"GET\", file, false);\n      rawFile.onreadystatechange = function ()\n      {\n        if(rawFile.readyState === 4)\n        {\n          if(rawFile.status === 200 || rawFile.status === 0)\n          {\n            let allText = rawFile.responseText;\n            setting(allText);\n          }\n        }\n      }\n      rawFile.send(null);\n    }\n\n    readTextFile(\"config.json\")\n  }\n\n  constructor() {\n    this.viewer = null;\n\n    this.Vertex = Vertex;\n    this.Edge = Edge;\n    this.Model = Model;\n    this.controls = null;\n    this.sharedData = null;\n\n    Model.configure();\n    this.reset();\n\n    this.loadData();\n    this.resetSelection();\n    this.recordV();\n  }\n\n  reset() {\n    // input data\n    this.v = [];  // vertex positions: nV x 3\n    this.e = [];  // edge positions: nE x 2\n    this.v0 = [];\n    this.c = [];  // instances of v of corners: nC x 3, e.g. <AOB -> [iO, iA, iB]\n    this.a0 = [];   // corner angles: nC\n    this.fixedVs = [];  // id of vertices that are fixed\n    this.lMax = []; // maximum length\n    this.edgeActive = [];  // if beam is active: nE\n    this.edgeChannel = [];  // id of beam edgeChannel: nE\n    this.script = [];    // nTimeSteps x nChannels\n\n    // update at every step\n    this.maxContraction = [];  // percentage of maxMaxContraction: nE\n    this.vel = [];  // vertex velocities: nV x 3\n    this.f = [];  // vertex forces: nV x 3\n    this.l = [];    // current length of beams: nE\n\n    // interface\n    this.vStatus = [];    // 0: none, 1: hovered; 2: selected\n    this.eStatus = [];    // 0: none, 1: hovered; 2: selected\n    this.fStatus = [];    // 0: none, 1: hovered; 2: selected\n\n    // statistics\n    this.iAction = 0;\n    this.numSteps = 0;\n    this.timeStart = new Date();\n\n    // status\n    this.editing = false;\n    this.simulate = true;\n    Model.gravity = true;\n    this.directional = false;\n    this.euler = new thre.Euler(0, 0, 0);\n\n    // channel status\n    this.numChannels = Model.defaultNumChannels;\n    this.numActions = Model.defaultNumActions;\n    this.inflateChannel = new Array(this.numChannels).fill(false);\n    this.contractionPercent = new Array(this.numChannels).fill(1);  // contraction percentage of each channel, 0-1\n  }\n\n  loadDict(data) {\n    console.log(data);\n    // load a dictionary\n    let v = [];\n    let e = Array.from(data.e);\n    let f = [];\n    let p = [];\n    // f = Array.from(data.f);\n    // p = Array.from(data.p);\n    for (let i=0; i<data.v.length; i++) {\n      v.push(new thre.Vector3(data.v[i][0], data.v[i][1], data.v[i][2]));\n    }\n    this.reset();\n    let lMax, maxContraction, fixedVs, edgeChannel, edgeActive, script\n    if (data.lMax) { lMax = data.lMax;}\n    if (data.maxContraction) {maxContraction = data.maxContraction;}\n    if (data.fixedVs)  {fixedVs = data.fixedVs;}\n    if (data.edgeChannel)  edgeChannel = data.edgeChannel;\n    if (data.edgeActive)  edgeActive = data.edgeActive;\n    if (data.script) script = data.script;\n    if (data.numChannels) this.numChannels = data.numChannels;\n    if (data.numActions) this.numActions = data.numActions;\n    this.loadData(v, e, f, p, lMax, maxContraction, fixedVs, edgeChannel, edgeActive, script);\n\n    if (!(data.lMax || data.maxContraction || data.fixedVs)) {\n      this.loadData(v, e, f, p);\n    }\n  }\n\n  loadData(v, e, f, p, lMax=null, maxContraction=null, fixedVs=null, edgeChannel=null, edgeActive=null, script=[]){\n    if (v && e) {\n      this.v = v;\n      this.e = e;\n    }\n    else{\n      this.v.push(new thre.Vector3(1, -1/Math.sqrt(3), 0.2));\n      this.v.push(new thre.Vector3(0, 2/Math.sqrt(3), 0.2));\n      this.v.push(new thre.Vector3(-1, -1/Math.sqrt(3), 0.2));\n      this.v.push(new thre.Vector3(0, 0, 4/Math.sqrt(6) + 0.2));\n\n      this.e.push([0, 1]);\n      this.e.push([1, 2]);\n      this.e.push([2, 0]);\n      this.e.push([0, 3]);\n      this.e.push([1, 3]);\n      this.e.push([2, 3]);\n    }\n\n    if (fixedVs) this.fixedVs = fixedVs;\n    if (lMax) this.lMax = lMax;\n    if (maxContraction) this.maxContraction = maxContraction;\n    if (edgeActive) this.edgeActive = edgeActive;\n    if (edgeChannel) this.edgeChannel = edgeChannel;\n    if (script) this.script = script;\n\n    this.updateCorners();\n    this.precompute();\n\n    this.initCheck();\n    this.resetSelection();\n    this.recordV();\n  }\n\n  saveData() {\n    let data = {};\n    data.v = [];\n    for (let v of this.v) {\n      data.v.push([v.x, v.y, v.z]);\n    }\n    data.v0 = [];\n    for (let v0 of this.v0) {\n      data.v0.push([v0.x, v0.y, v0.z]);\n    }\n\n    data.e = [];\n    for (let i=0; i<this.e.length; i++) {\n      data.e.push(this.e[i].slice());\n    }\n    data.fixedVs = this.fixedVs.slice();\n    data.lMax = this.lMax.slice();\n    data.edgeChannel = this.edgeChannel.slice();\n    data.edgeActive = this.edgeActive.slice();\n    data.script = [];\n    for (let i=0; i<this.script.length; i++) {\n      const actions = this.script[i].slice();\n      data.script.push(actions);\n    }\n\n    data.maxContraction = this.maxContraction.slice();\n    data.vStatus = this.vStatus.slice();\n    data.eStatus = this.eStatus.slice();\n    data.fStatus = this.fStatus.slice();\n\n    data.euler = this.euler.clone();\n\n    data.numChannels = this.numChannels;\n    data.numActions = this.numActions;\n    data.inflateChannel = this.inflateChannel.slice();\n    data.contractionPercent = this.contractionPercent.slice();\n\n    return data;\n  }\n\n  sameData(data, prevData) {\n    let same = true;\n\n    if (JSON.stringify(data.e) !== JSON.stringify(prevData.e)) same = false;\n    if (JSON.stringify(data.fixedVs) !== JSON.stringify(prevData.fixedVs)) same = false;\n    if (JSON.stringify(data.lMax) !== JSON.stringify(prevData.lMax)) same = false;\n    if (JSON.stringify(data.edgeChannel) !== JSON.stringify(prevData.edgeChannel)) same = false;\n    if (JSON.stringify(data.edgeActive) !== JSON.stringify(prevData.edgeActive)) same = false;\n    if (JSON.stringify(data.script) !== JSON.stringify(prevData.script)) same = false;\n    if (JSON.stringify(data.maxContraction) !== JSON.stringify(prevData.maxContraction)) same = false;\n    if (data.euler.x !== prevData.euler.x) same = false;\n    if (data.euler.y !== prevData.euler.y) same = false;\n    if (data.euler.z !== prevData.euler.z) same = false;\n\n    if (data.numChannels !== prevData.numChannels) same = false;\n    if (data.numActions !== prevData.numActions) same = false;\n\n    return same;\n  }\n\n  recordHistory() {\n    const data = this.saveData();\n\n    if (this.Model.iHistory !== -1) {\n      if (this.sameData(data, this.Model.history[this.Model.iHistory])) {\n        return;\n      }\n    }\n\n    console.log('record');\n\n    Model.history = Model.history.slice(0, Model.iHistory + 1);\n\n    Model.history.push(this.saveData());\n    if (Model.history.length > 50) {\n      Model.history.shift();\n    }\n    Model.iHistory = Model.history.length - 1;\n  }\n  \n  applyHistory(i, update=true) {\n    if (i === -1) return;\n\n    const data = Model.history[i];\n\n    this.v = [];\n    for (let v of data.v) {\n      this.v.push(new thre.Vector3(v[0], v[1], v[2]));\n    }\n    this.v0 = [];\n    for (let v0 of data.v0) {\n      this.v0.push(new thre.Vector3(v0[0], v0[1], v0[2]));\n    }\n    this.e = [];\n    for (let i=0; i<data.e.length; i++) {\n      this.e.push(data.e[i].slice());\n    }\n    this.fixedVs =data.fixedVs.slice();\n    this.lMax = data.lMax.slice();\n    this.edgeChannel = data.edgeChannel.slice();\n    this.edgeActive = data.edgeActive.slice();\n    this.script = [];\n    for (let i=0; i<data.script.length; i++) {\n      const actions = data.script[i].slice();\n      this.script.push(actions);\n    }\n\n    this.maxContraction = data.maxContraction.slice();\n    this.vStatus = data.vStatus.slice();\n    this.eStatus = data.eStatus.slice();\n    this.fStatus = data.fStatus.slice();\n\n    this.euler = data.euler.clone();\n\n    this.numChannels = data.numChannels;\n    this.numActions = data.numActions;\n    this.inflateChannel = data.inflateChannel.slice();\n    this.contractionPercent = data.contractionPercent.slice();\n  }\n  \n  undo() {\n    if (Model.iHistory - 1 >= 0) {\n      Model.iHistory -= 1;\n    }\n    this.applyHistory(Model.iHistory);\n  }\n  \n  redo() {\n    if (Model.iHistory + 1 < Model.history.length) {\n\n      console.log(Model.iHistory);\n      Model.iHistory += 1;\n      console.log('yes');\n      console.log(Model.iHistory);\n    }\n    this.applyHistory(Model.iHistory);\n  }\n\n  resetSelection() {\n    this.vStatus = new Array(this.v.length).fill(0);\n    this.eStatus = new Array(this.e.length).fill(0);\n    this.fStatus = new Array(this.f.length).fill(0);\n  }\n\n  recordV() {\n    this.v0 = [];\n    let bbox = this.bbox();\n    let zOffset = -bbox[5];\n\n    for (let v of this.v) {\n      let vv = v.clone();\n      vv.z += zOffset;\n      this.v0.push(vv);\n    }\n  }\n\n  resetV() {\n    this.iAction = 0;\n    this.numSteps = 0;\n\n    for (let i=0; i<this.v.length; i++) {\n      this.v[i].copy(this.v0[i]);\n    }\n\n    this.numSteps = 0;\n  }\n\n  precompute() {\n    const copyArrays = (oldValue, newValue)=>{\n      for (let i=0; i<Math.min(oldValue.length, newValue.length); i++) {\n        newValue[i] = oldValue[i];\n      }\n      return newValue;\n    }\n\n    this.l = [];\n    for (let i=0; i<this.e.length; i++) {\n      let e = this.e[i];\n      this.l.push(this.v[e[0]].distanceTo(this.v[e[1]]));\n    }\n\n    if (this.vel.length !== this.v.length) {\n      this.vel = [];\n      for (let i=0; i<this.v.length; i++) {\n        this.vel.push(new thre.Vector3());\n      }\n    }\n    if (this.maxContraction.length !== this.e.length) {\n      const newValue = new Array(this.e.length).fill(Model.maxMaxContraction);\n      this.maxContraction = copyArrays(this.maxContraction, newValue);\n    }\n    if (this.fixedVs.length !== this.v.length) {\n      const newValue = new Array(this.v.length).fill(false);\n      this.fixedVs = copyArrays(this.fixedVs, newValue);\n    }\n    if (this.lMax.length !== this.e.length) {\n      const newValue = new Array(this.e.length).fill(Model.defaultMaxLength);\n      this.lMax = copyArrays(this.lMax, newValue);\n    }\n    if (this.edgeActive.length !== this.e.length) {\n      const newValue = new Array(this.e.length).fill(true);\n      this.edgeActive = copyArrays(this.edgeActive, newValue);\n    }\n    if (this.edgeChannel.length !== this.e.length) {\n      const newValue = new Array(this.e.length).fill(0);\n      this.edgeChannel = copyArrays(this.edgeChannel, newValue);\n    }\n    if ((this.script.length !== this.numChannels)\n      || (this.script.length && this.script[0].length !== this.numActions))\n    {\n      const newValue = Array(this.numChannels).fill(false).map(_=>Array(this.numActions).fill(false));\n      if (this.script.length === 0) this.script = newValue;\n\n      for (let iChannel=0; iChannel<Math.min(this.script.length, newValue.length); iChannel++) {\n        for (let iAction=0; iAction<Math.min(this.script[0].length, newValue[0].length); iAction++) {\n          newValue[iChannel][iAction] = this.script[iChannel][iAction];\n        }\n      }\n      this.script = newValue;\n    }\n  }\n\n  initCheck() {\n\n    // rescale\n    if (false) {\n      let minlMax = 1e5;\n      for (let i = 0; i < this.e.length; i++) {\n        if (this.edgeActive[i]) {\n          if (this.l[i] < minlMax) {\n            minlMax = this.l[i];\n          }\n        }\n      }\n      console.log(`Minimum max length among active beams is ${minlMax}.`)\n      for (let i = 0; i < this.v.length; i++) {\n        this.v[i].divideScalar(minlMax);\n        this.v[i].multiplyScalar(Model.defaultMaxLength);\n      }\n    }\n\n    // lMax check\n    for (let i=0; i<this.e.length; i++) {\n      if (this.edgeActive[i]) {\n        if (this.lMax[i] !== this.Model.defaultMaxLength) {\n          console.log(`An active beam is having wrong max length ${this.lMax[i]}.`)\n          this.lMax[i] = this.Model.defaultMaxLength;\n        }\n      }\n    }\n\n  }\n\n  static getAngle(e0, e1, indices=false) {\n    // e0, e1: Edge instances\n    // indices: return indices of three vertices OAB\n    // return: angle between them, (return indices of three vertices OAB)\n    let vs0 = e0.vs;\n    let vs1 = e1.vs;\n    let vs;\n    if (vs0[0] === vs1[0]) vs = [vs0[0], vs0[1], vs1[1]];\n    else if (vs0[0] === vs1[1]) vs = [vs0[0], vs0[1], vs1[0]];\n    else if (vs0[1] === vs1[0]) vs = [vs0[1], vs0[0], vs1[1]];\n    else if (vs0[1] === vs1[1]) vs = [vs0[1], vs0[0], vs1[0]];\n    else console.error(\"edges not intersected\");\n\n    const O = vs[0].pos.clone();\n    const A = vs[1].pos.clone();\n    const B = vs[2].pos.clone();\n\n    A.sub(O);\n    B.sub(O);\n    if (indices) {\n      return [A.angleTo(B), [vs[0].id, vs[1].id, vs[2].id] ];\n    }\n\n    return A.angleTo(B);\n  }\n\n  updateCorners() {\n    // update this.c, this.a0\n    this.updateDataStructure();\n\n    this.c = [];\n    this.a0 = [];\n    for (let v of Vertex.all) {\n      let es = v.es;\n      for (let i=0; i<es.length-1; i++) {\n        let e0 = es[i];\n        let e1 = es[i+1];\n\n        let [alpha, ids] = Model.getAngle(e0, e1, true);\n        this.c.push(ids);\n        this.a0.push(alpha);\n      }\n    }\n  }\n\n  checkCorners() {\n    // return false if any angle change is larger than threshold\n    for (let i=0; i<this.c.length; i++) {\n      let [iO, iA, iB] = this.c[i];\n      let vec0 = this.v[iA].clone().sub(this.v[iO]);\n      let vec1 = this.v[iB].clone().sub(this.v[iO]);\n      let alpha = vec0.angleTo(vec1);\n      if (Math.abs(alpha - this.a0[i]) > Model.angleThreshold) return false;\n    }\n    return true;\n  }\n\n  update() {\n    // initialize forces\n    this.f = [];\n    for (let i=0; i<this.v.length; i++) {\n      this.f.push(new thre.Vector3());\n    }\n\n    // length maxContraction\n    for (let i=0; i<this.e.length; i++) {\n      let e = this.e[i];\n      let v0 = this.v[e[0]];\n      let v1 = this.v[e[1]];\n\n      let vec = v1.clone().sub(v0); // from 0 to 1\n\n      let l0 = this.lMax[i];\n      if (this.edgeActive[i]) {\n        let iChannel = this.edgeChannel[i];\n        let lMax = l0;\n        let lMin = lMax * (1 - this.maxContraction[i]);\n        l0 = lMax - this.contractionPercent[iChannel] * (lMax - lMin);\n      }\n      let d = vec.length() - l0;\n      let f = (d) * Model.k;\n      f = vec.normalize().multiplyScalar(f);  // from 0 to 1\n\n      this.f[e[0]].add(f);\n      this.f[e[1]].add(f.negate());\n    }\n\n    // gravity\n    for (let i=0; i<this.v.length; i++) {\n      if (Model.gravity) {\n        this.f[i].add(new thre.Vector3(0, 0, -Model.gravityFactor * Model.gravity));\n      }\n    }\n    // friction\n  }\n\n  runScript() {\n    if (this.script.length === 0) return 0;\n\n    if (this.numSteps > ((this.iAction + 1) % this.numActions) * Model.numStepsAction ) {\n      this.iAction = Math.floor(this.numSteps / Model.numStepsAction) % this.numActions;\n      if (this.editing) {\n        this.iAction = 0;\n      }\n\n      for (let iChannel=0; iChannel<this.numChannels; iChannel++) {\n        this.inflateChannel[iChannel] = this.script[iChannel][this.iAction];\n      }\n    }\n  }\n\n  step(n=1, scripting = true) {\n\n    for (let iStep=0; iStep<n; iStep++) {\n      this.precompute();\n      if (!this.simulate) {return}\n\n      if (scripting) {\n        this.runScript();\n      }\n\n      if (this.editing) {\n        // this.center();\n      }\n\n      // update contraction percentage\n      for (let i=0; i<this.inflateChannel.length; i++) {\n        if (this.inflateChannel[i]) {\n          this.contractionPercent[i] -= Model.contractionPercentRate;\n          if (this.contractionPercent[i] < 0) {\n            this.contractionPercent[i] = 0;\n          }\n        }\n        else {\n          this.contractionPercent[i] += Model.contractionPercentRate;\n          if (this.contractionPercent[i] > 1) {\n            this.contractionPercent[i] = 1;\n          }\n        }\n      }\n\n\n      this.update(); // update lengths and forces\n\n      for (let i=0; i<this.v.length; i++) {\n        if (this.fixedVs[i]) continue;\n\n        if (this.sharedData.movingJoint && this.vStatus[i] !== 2) continue;\n\n        this.vel[i].add(this.f[i].clone().multiplyScalar(Model.h));\n\n        if (this.v[i].z <= 0) {\n          this.vel[i].x *= (1 - Model.frictionFactor);\n          this.vel[i].y *= (1 - Model.frictionFactor);\n        }\n\n        this.vel[i].multiplyScalar(Model.dampingRatio);   // damping\n        if (this.vel[i].length() > 5) {\n\n          this.vel[i].multiplyScalar(Math.pow(0.9, Math.ceil(Math.log(5/this.vel[i].length()) / Math.log(0.9))));\n        }\n\n        this.v[i].add(this.vel[i].clone().multiplyScalar(Model.h));\n\n        if (this.v[i].z <= 0) {\n          this.vel[i].z = -this.vel[i].z;\n          this.v[i].z = 0;\n        }\n      }\n\n      if (this.numSteps % Model.angleCheckFrequency === 0) {\n        console.assert(this.checkCorners());\n      }\n\n      this.numSteps += 1;\n    }\n\n    return this.v;\n  }\n\n  addJoint(iJoint) {\n    let v = new thre.Vector3();\n    v.copy(this.v[iJoint]);\n    let vec = new thre.Vector3(Model.defaultMinLength, 0, 0);\n    v = v.add(vec);\n    this.v.push(v);\n\n    let e = [iJoint, this.v.length - 1];\n    this.e.push(e);\n\n    this.updateCorners();\n  }\n\n  addEdges(iJoints) {\n    for (let i=0; i<iJoints.length; i++) {\n      for (let j=i+1; j<iJoints.length; j++) {\n        let notExist = true;\n        for (let e of this.e) {\n          if (e.includes(iJoints[i]) && e.includes(iJoints[j])) {\n            notExist = false;\n            break;\n          }\n        }\n        if (notExist) this.e.push([iJoints[i], iJoints[j]]);\n      }\n    }\n\n    this.updateCorners();\n  }\n\n  removeJoint(iJoint) {\n    if ([0,1,2,3].includes(iJoint)) return;\n\n    this.updateDataStructure();\n\n    const ees = [];   // edges to remove\n\n    const v = Vertex.all[iJoint];\n    for (let ee of v.es) {\n      ees.push(ee);\n    }\n\n    Vertex.all = Vertex.all.filter(vv=>vv !== v);\n    Edge.all = Edge.all.filter(ee=>!ees.includes(ee));\n\n    Model.reindexObjects(Vertex)\n    Model.reindexObjects(Edge)\n\n    this.updateFromDataStructure();\n    this.updateCorners();\n\n    this.forceUpdate();\n  }\n\n  removeEdge(iEdge) {\n\n  }\n\n  // update the model variables to data structures\n  updateDataStructure() {\n    Vertex.all = [];\n    for (let i = 0; i < this.v.length; i++) {\n      new Vertex(this.v[i], this.fixedVs[i], this.v0[i], this.vel[i], this.f[i]);\n    }\n    Edge.all = [];\n    for (let i = 0; i < this.e.length; i++) {\n      new Edge(this.e[i], this.lMax[i], this.maxContraction[i], this.edgeChannel[i], this.edgeActive[i], this.l[i]);\n    }\n  }\n\n  // convert data structures to model variables\n  updateFromDataStructure() {\n    this.v = [];\n    this.fixedVs = [];\n    this.v0 = [];\n    this.vel = [];\n    this.f = [];\n    for (let v of Vertex.all) {\n      this.v.push(v.pos);\n      this.fixedVs.push(v.fixed);\n      this.v0.push(v.pos0);\n      this.vel.push(v.vel);\n      this.f.push(v.f);\n    }\n\n    this.e = [];\n    this.lMax = [];\n    this.maxContraction = [];\n    this.edgeChannel = [];\n    this.edgeActive = [];\n    this.l = [];\n    for (let e of Edge.all) {\n      let vs = [e.vs[0].id, e.vs[1].id];\n      this.e.push(vs);\n      this.lMax.push(e.lMax);\n      this.maxContraction.push(e.maxContraction);\n      this.edgeChannel.push(e.edgeChannel);\n      this.edgeActive.push(e.edgeActive);\n      this.l.push(e.l);\n    }\n\n    this.vStatus = new Array(this.v.length).fill(0);\n    this.eStatus = new Array(this.e.length).fill(0);\n  }\n\n  static reindexObjects = (cls) => {\n    let i = 0;\n    for (let o of cls.all) {\n      o.id = i;\n      i += 1;\n    }\n  };\n\n  centroid(v0=false) {\n    let center = new thre.Vector3(0, 0, 0);\n    const vs = v0 ? this.v0 : this.v;\n    for (let v of vs) {\n      center.add(v);\n    }\n    center.divideScalar(this.v.length);\n    return center;\n  }\n\n  center(v0=false) {\n    // v0 : center v0 of the object if true\n    const cent = this.centroid();\n    const [xMax, yMax, zMax, xMin, yMin, zMin] = this.bbox();\n    const gap = Math.max([zMax - zMin, yMax - yMin, xMax - xMin]);\n\n    for (let i=0; i<this.v.length; i++) {\n      this.v[i].x -= cent.x;\n      this.v[i].y -= cent.y;\n      this.v[i].z -= zMin;\n      this.v[i].z += zMax - zMin;\n    }\n\n    this.recordV();\n  }\n\n  align(x=true, ivs = []) {\n    // align the axis of model(from centroid to the centroid of selected front vertices) along x/y axis\n    // x: align along x axis if true, otherwise along y axis\n    // ivs: indices of front vertices\n\n    if (ivs.length > 0) {\n      let centFront = new thre.Vector3(0, 0, 0);\n      for (let iv of ivs) {\n        const v = this.v[iv];\n        centFront.add(v);\n      }\n\n      centFront.divideScalar(ivs.length);\n\n      const cent = this.centroid();\n\n      centFront.sub(cent);\n      let vec = centFront.clone();\n      vec.z = 0;\n\n      // Returns the angle (in radians) from the X axis to a point.\n      let rotRadZ = Math.atan2(vec.y, vec.x);\n\n      if (!x) rotRadZ -= Math.PI / 2;\n\n      this.rotateTo(this.euler.x, this.euler.y, this.euler.z-rotRadZ);\n    }\n  }\n\n  stepsPerSecond() {\n    let t = new Date();\n    return this.numSteps / ((t.getTime() - this.timeStart.getTime()) / 1000);\n  }\n\n  bbox() {\n    let xMax, yMax, zMax, xMin, yMin, zMin;\n    xMax = yMax = zMax = -Infinity;\n    xMin = yMin = zMin = Infinity;\n    for (let v of this.v) {\n      if (v.x > xMax) xMax = v.x;\n      if (v.y > yMax) yMax = v.y;\n      if (v.z > zMax) zMax = v.z;\n      if (v.x < xMin) xMin = v.x;\n      if (v.y < yMin) yMin = v.y;\n      if (v.z < zMin) zMin = v.z;\n    }\n    return [xMax, yMax, zMax, xMin, yMin, zMin];\n  }\n\n  infoJoints() {\n    return 'joints: '+ this.v.length;\n  }\n\n  infoBeams() {\n    return 'actuators: ' + this.e.length;\n  }\n\n  fixJoints(ids) {\n    for (let i=0; i<ids.length; i++) {\n      let id = ids[i];\n      alert('not implemented');\n    }\n  }\n\n  unfixAll() {\n    this.fixedVs = [];\n    this.fixedVs = new Array(this.v.length).fill(false);\n  }\n\n  rotateTo(x, y, z) {\n    // this.resetV();\n\n    let center = this.centroid();\n    let eulerInverse = new thre.Euler();\n    eulerInverse.setFromVector3(this.euler.toVector3().negate(), 'ZYX');\n    this.euler =new thre.Euler(x, y, z);\n\n    for (let i=0; i<this.v.length; i++) {\n      this.v[i].sub(center);\n      this.v[i].applyEuler(eulerInverse);\n      this.v[i].applyEuler(this.euler);\n      this.v[i].add(center);\n    }\n\n    this.recordV();\n  }\n\n}\n\nexport {Model};\n","export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","import logo from './logo.svg';\nimport './style.css';\nimport React, {useRef, useState, useMemo, useEffect, useReducer} from 'react'\nimport * as THREE from 'three'\nimport { extend, Canvas, useFrame, useThree, useResource, useUpdate } from 'react-three-fiber'\n\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport {TransformControls, Stats} from \"drei\";\n// import { EffectComposer, Outline } from 'react-postprocessing'\nextend({OrbitControls})\n\nconst cWhite = new THREE.Color(0.6, 0.6, 0.6);\nconst cChannels = [\n  new THREE.Color(0.1, 0.3, 0.6),\n  new THREE.Color(0.5, 0.4, 0.1),\n  new THREE.Color(0.5, 0.1, 0.5),\n  new THREE.Color(0.1, 0.5, 0.2),\n  new THREE.Color(0.6, 0.1, 0.4),\n];\nconst cPureWhite = new THREE.Color(1, 1, 1);\nconst cBlack = new THREE.Color(0.05, 0.05, 0.05);\nconst cSelected = new THREE.Color(0.9, 0.0, 0.0);\nconst cHovered = new THREE.Color(0.9, 0.05, 0.0);\nconst cFixed = new THREE.Color(0.2, 0.8, 0.8);\nconst cPassive = new THREE.Color(0.15, 0.15, 0.15);\nconst dIn = 0.05;     // diameter of the inner piston\nconst dOut = 0.065;    // diameter of the outer piston\nconst dConstraint = 0.06;    // diameter of the constraint\nconst lConstraint = 0.04;    // length of the constraint\nconst lPiston = 0.527;       // length of each half piston\nconst lTube = 0.330;         // length of tube of each joint\nconst dTube = 0.026;  // diameter of joint tubes\nconst dJoint = 0.06;    // diameter of the joint ball\nconst fps = 30;\nconst viewChannel = false;\nwindow.fps = fps;\n\nfunction Ball({v, d, c, model, handleClick, handlePointerOver, handlePointerOut, setOControls, translating}) {\n\n  const mesh=useRef();\n  const material = useRef();\n  const transControls = useRef();\n  const [dragging, setDragging] = useState(false);\n  const prevPos = new THREE.Vector3();\n\n  useFrame((state)=>{\n\n    if (mesh.current === null)  return;\n\n    mesh.current.position.copy(v);\n    material.current.color.copy(c);\n\n\n    if (translating) {\n      const controls = transControls.current;\n      if (dragging)  {\n        v.copy(controls.worldPosition.clone().add(controls.position));\n        mesh.current.position.copy(v);\n      }\n      else {\n        transControls.current.position.copy(v);\n      }\n    }\n  });\n\n  useEffect(()=>{\n    const callbackDraggingChanged = (e) => {\n      setOControls(!e.value);\n      setDragging(e.value);\n\n      const controls = e.target;\n      if (e.value ===false) {\n        controls.object.position.multiplyScalar(0);\n        model.simulate=true;\n        model.recordHistory();\n      }\n      else {\n        model.simulate=false;\n        prevPos.copy(controls.worldPosition);\n      }\n    }\n\n    const controls = transControls.current;\n    controls.position.copy(v);\n    if (controls) {\n      controls.addEventListener('dragging-changed', callbackDraggingChanged);\n      return () => {\n        controls.removeEventListener('dragging-changed', callbackDraggingChanged);\n      }\n    }\n  })\n\n  return(\n    <TransformControls\n      ref={transControls}\n      enabled={translating}\n      showX={translating}\n      showY={translating}\n      showZ={translating}\n      mode={\"translate\"}\n      space={\"local\"}\n    >\n      <mesh\n        ref={mesh}\n        position={v}\n        castShadow={true}\n        scale={[d, d, d]}\n        onClick={handleClick}\n        onPointerOver={handlePointerOver}\n        onPointerOut={handlePointerOut}\n      >\n        <sphereBufferGeometry args={[1, 20, 20]}/>\n        {\n          viewChannel?\n          <meshBasicMaterial\n          ref={material}\n          color={cBlack}\n          transparent={true}\n          opacity={0.4}\n        />\n        :\n            <meshLambertMaterial\n              ref={material}\n              color={c}\n            />\n        }\n      </mesh>\n    </TransformControls>\n  )\n}\n\nfunction Joint({v, iv, model, setOControls, sharedData}) {\n  const selected = (model.vStatus[iv] === 2);\n  const hovered = (model.vStatus[iv] === 1);\n  const fixed = false;\n  const [translating, setTranslating] = useState(false);\n  const color = new THREE.Color();\n\n  useFrame((sate)=>{\n    const selected = (model.vStatus[iv] === 2);\n    const hovered = (model.vStatus[iv] === 1);\n    const fixed = model.fixedVs[iv];\n    color.copy(selected?cSelected:hovered?cHovered:fixed?cFixed:cWhite);\n    if (sharedData.movingJoint && model.vStatus[iv] === 2 && !translating) {\n      setTranslating(true);\n    }\n    if ((!sharedData.movingJoint || model.vStatus[iv] !== 2) && translating) {\n      setTranslating(false);\n    }\n  });\n\n  const handleClick = (e)=>{\n    if (sharedData.removingJoint) {\n      model.removeJoint(iv);\n      model.precompute();\n      model.recordV();\n      model.forceUpdate();\n    }\n    else if(sharedData.addingJoint){\n      model.addJoint(iv);\n      model.precompute();\n      model.recordV();\n      model.forceUpdate();\n    }\n    else if (sharedData.movingJoint) {\n      model.vStatus.fill(0);\n      model.vStatus[iv] = 2;\n    }\n    else {\n      model.vStatus[iv] = 2;\n    }\n    sharedData.updateGUI();\n    e.stopPropagation();\n  }\n\n  const handlePointerOver = (e)=>{\n    if (model.vStatus[iv] !== 2) model.vStatus[iv] = 1;\n    e.stopPropagation();\n  }\n  const handlePointerOut = (e)=>{\n    if (model.vStatus[iv] !== 2) model.vStatus[iv] = 0;\n    e.stopPropagation();\n  }\n\n  return(\n    <Ball key={\"ball\"} v={v} d={dJoint}\n          model={model}\n          handleClick={handleClick}\n          handlePointerOver={handlePointerOver}\n          handlePointerOut={handlePointerOut}\n          setOControls={setOControls}\n          translating={translating}\n          c={color}/>\n  )\n}\n\nfunction Cylinder({v0, v1, d, c, opacity, transparent, handleClick, handlePointerOver, handlePointerOut }) {\n  const mesh = useRef();\n  const material = useRef();\n\n  const update = (v0, v1)=>{\n    const pos = v0.clone().add(v1).divideScalar(2);\n    const vec = v1.clone().sub(v0);\n    const axis = new THREE.Vector3(0, 1, 0);\n\n    const l = vec.length();\n    vec.normalize();\n\n    const quaternion = new THREE.Quaternion().setFromUnitVectors(axis, vec);\n    const euler = new THREE.Euler().setFromQuaternion(quaternion);\n    return [pos, l, euler]\n  }\n\n  const [pos, l, euler] = update(v0, v1);\n\n  useFrame((state)=>{\n    if (mesh.current === null)  return;   // TODO: why?\n\n    const [pos, l, euler] = update(v0, v1);\n    mesh.current.position.copy(pos);\n    mesh.current.rotation.copy(euler);\n    mesh.current.scale[1] = l;\n    material.current.color.copy(c);\n  })\n\n  return (\n    <mesh\n      ref={mesh}\n      position={[pos.x, pos.y, pos.z]}\n      rotation={euler}\n      castShadow={true}\n      scale={[d, l, d]}\n      onClick={handleClick}\n      onPointerOver={handlePointerOver}\n      onPointerOut={handlePointerOut}\n    >\n      <cylinderBufferGeometry args={[1, 1, 1, 20]} />\n      {\n        viewChannel?\n        <meshBasicMaterial\n        ref={material}\n        color={c}\n        opacity={opacity}\n        transparent={transparent}\n      />\n      :\n          <meshLambertMaterial\n            ref={material}\n            color={c}\n          />\n      }\n    </mesh>\n  )\n}\n\nfunction Beam({v0, v1, ie, model, sharedData\n              }) {\n  let vec = v1.clone().sub(v0);\n  let l = vec.length();\n  vec.normalize();\n  const vecPiston = vec.clone().multiplyScalar(lPiston);\n  const vecTube = vec.clone().multiplyScalar(lTube);\n  const vecConstraint = vec.clone().multiplyScalar(lConstraint);\n\n  const vOut0 = vecTube.clone().add(v0);\n  const vOut1 = vOut0.clone().add(vecPiston);\n  const vIn0 = v1.clone().sub(vecTube);\n  const vIn1 = vIn0.clone().sub(vecPiston);\n  const vTube00 = v0.clone();\n  const vTube01 = v0.clone().add(vecTube);\n  const vTube11 = v1.clone();\n  const vTube10 = v1.clone().sub(vecTube);\n  const vConstraint0 = vIn0.clone().sub(vec.clone().multiplyScalar(\n    model.lMax[ie] * (model.Model.maxMaxContraction - model.maxContraction[ie])));\n  const vConstraint1 = vConstraint0.clone().add(vecConstraint);\n\n  const cOut = new THREE.Color();\n  const cIn = new THREE.Color();\n  const cJoint = new THREE.Color();\n  const cBeam = new THREE.Color();\n  const cInner = new THREE.Color();\n\n  const changeColor =()=>{\n    const c = cChannels[model.edgeChannel[ie]];\n    if (sharedData.showChannel) {\n      const selected = (model.eStatus[ie] === 2);\n      const hovered = (model.eStatus[ie] === 1);\n      cOut.copy(selected ? cSelected : hovered ? cHovered : c);\n      cIn.copy(selected ? cSelected : hovered ? cHovered : c);\n      cJoint.copy(selected ? cSelected : hovered ? cHovered : c);\n      cBeam.copy(selected ? cSelected : hovered ? cHovered : c);\n    }\n    else {\n      const selected = (model.eStatus[ie] === 2);\n      const hovered = (model.eStatus[ie] === 1);\n      cOut.copy(selected ? cSelected : hovered ? cHovered : cBlack);\n      cIn.copy(selected ? cSelected : hovered ? cHovered : cWhite);\n      cJoint.copy(selected ? cSelected : hovered ? cHovered : cWhite);\n      cBeam.copy(selected ? cSelected : hovered ? cHovered : cPassive);\n      cInner.copy(c);\n    }\n    cInner.copy(c);\n    if (viewChannel) {\n      cOut.copy(cBlack);\n      cIn.copy(cBlack);\n      cJoint.copy(cBlack);\n    }\n  }\n  changeColor();\n\n  useFrame((state)=>{\n    let vec = v1.clone().sub(v0);\n    let l = vec.length();\n    vec.normalize();\n    const vecPiston = vec.clone().multiplyScalar(lPiston);\n    const vecTube = vec.clone().multiplyScalar(lTube);\n    const vecConstraint = vec.clone().multiplyScalar(lConstraint);\n    vOut0.copy(vecTube.clone().add(v0));\n    vOut1.copy(vOut0.clone().add(vecPiston));\n    vIn0.copy(v1.clone().sub(vecTube));\n    vIn1.copy(vIn0.clone().sub(vecPiston));\n    vTube00.copy(v0.clone());\n    vTube01.copy(v0.clone().add(vecTube));\n    vTube11.copy(v1.clone());\n    vTube10.copy(v1.clone().sub(vecTube));\n    vConstraint0.copy(vIn0.clone().sub(vec.clone().multiplyScalar(\n      model.lMax[ie] * (model.Model.maxMaxContraction - model.maxContraction[ie]) )));\n    vConstraint1.copy(vConstraint0.clone().add(vecConstraint));\n\n    changeColor();\n  });\n\n  const handleClick = (e)=>{\n    model.eStatus[ie] = 2;\n    e.stopPropagation();\n  }\n  const handlePointerOver = (e)=>{\n    if (model.eStatus[ie] !== 2) {model.eStatus[ie] = 1;}\n    e.stopPropagation();\n\n    if (sharedData.showInfo) sharedData.infoPanel.style.display = 'block';\n    sharedData.infoPanel.style.left = String(e.clientX) + 'px';\n    sharedData.infoPanel.style.top = String(e.clientY) + 'px';\n    while (sharedData.infoPanel.firstChild) sharedData.infoPanel.removeChild(sharedData.infoPanel.firstChild);\n    sharedData.infoPanel.appendChild(sharedData.infoPanel.ownerDocument.createTextNode(\n      \"L: \" + String(Math.round(model.l[ie] * 1000) / 1000 / 1.2 * 93 ) + \"mm\",\n    ));\n    sharedData.infoPanel.appendChild(sharedData.infoPanel.ownerDocument.createElement(\"br\"));\n    sharedData.infoPanel.appendChild(sharedData.infoPanel.ownerDocument.createTextNode(\n      \"S: \" + String(Math.round(model.l[ie] * 1000) / 1000 / 1.2 * 62 ) + \"mm\",\n    ));\n  }\n  const handlePointerOut = (e)=>{\n    if (model.eStatus[ie] !== 2) {model.eStatus[ie] = 0;}\n    e.stopPropagation();\n    sharedData.infoPanel.style.display = \"none\";\n  }\n\n  const opacity = viewChannel? 0.15 : 1.0;\n  const transpacency = viewChannel;\n\n  const cylinders = [\n    <Cylinder key=\"out\" v0={vOut0} v1={vOut1} d={dOut} c={cOut} opacity={opacity} transparent={transpacency}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}/>,\n    <Cylinder key=\"in\" v0={vIn0} v1={vIn1} d={dIn} c={cIn} opacity={opacity} transparent={transpacency}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}/>,\n    <Cylinder key=\"joint0\" v0={vTube00} v1={vTube01} d={dTube} c={cJoint} opacity={opacity} transparent={transpacency}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}/>,\n    <Cylinder key=\"joint1\" v0={vTube10} v1={vTube11} d={dTube} c={cJoint} opacity={opacity} transparent={transpacency}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}/>\n    ];\n\n  if (viewChannel) {\n    cylinders.push(\n      <Cylinder key=\"inner\" v0={vTube00} v1={vTube11} d={dTube * 0.5} c={cInner} opacity={2} transparent={false}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}/>)\n  }\n\n  if (model.maxContraction[ie] !== model.Model.maxMaxContraction) {\n    cylinders.push(<Cylinder key=\"constraint\" v0={vConstraint0} v1={vConstraint1} d={dConstraint} c={cBlack}/>);\n  }\n\n  if (model.edgeActive[ie]) {\n    return (cylinders)\n  }\n  else {\n    return (\n      [<Cylinder key=\"beam\" v0={v0} v1={v1} d={dTube} c={cBeam} opacity={opacity} transparent={false}\n                handleClick={handleClick} handlePointerOver={handlePointerOver}\n                 handlePointerOut={handlePointerOut}/>]\n    )\n  }\n\n}\n\nfunction Triangle({vertices, c, opacity, handleClick, handlePointerOver, handlePointerOut}) {\n  const mesh = useRef();\n  const [,forceUpdate] = useReducer(x=>x+1, 0);\n  let vs = [];\n  for (let v of vertices) {\n    vs.push(v.x, v.y, v.z);\n  }\n  const f32array = Float32Array.from(vs);\n\n  return (\n    <mesh\n      ref={mesh}\n      onClick={handleClick}\n      onPointerOver={handlePointerOver}\n      onPointerOut={handlePointerOut}\n    >\n      <bufferGeometry attach={\"geometry\"}>\n        <bufferAttribute\n          attachObject={[\"attributes\", \"position\"]}\n          args={[f32array,3]}\n        />\n      </bufferGeometry>\n      <meshBasicMaterial\n        color={c}\n        opacity={opacity}\n        transparent={true}\n        side={THREE.FrontSide}\n      />\n    </mesh>\n  )\n}\n\nfunction Face({vertices, model, sharedData, i}) {\n\n  const color = new THREE.Color();\n  color.copy(model.fStatus[i] === 2 ? cSelected : model.fStatus[i] === 1 ? cHovered : cBlack);\n\n  const handleClick = (e)=>{\n    if (model.editing) {\n      // model.fStatus[i] = 2;\n      e.stopPropagation();\n      if (sharedData.addingJoint) {\n        model.addPolytope(i);\n        model.forceUpdate();\n      }\n    }\n  }\n\n  const handlePointerOver = (e)=>{\n    if (model.editing) {\n      if (model.fStatus[i] !== 2) model.fStatus[i] = 1;\n      e.stopPropagation();\n    }\n  }\n\n  const handlePointerOut = (e)=>{\n    if (model.editing) {\n      if (model.fStatus[i] !== 2) model.fStatus[i] = 0;\n      e.stopPropagation();\n    }\n  }\n\n  const [,forceUpdate] = useReducer(x=>x+1, 0);\n\n  useFrame( ()=>{\n    if (model.editing) forceUpdate();\n  })\n\n  return (\n    <Triangle vertices={vertices} c={color} opacity={model.editing?0.2:0}\n              handleClick={handleClick} handlePointerOver={handlePointerOver} handlePointerOut={handlePointerOut}\n    />\n  )\n}\n\nfunction PneuMesh({\n  model,\n  sharedData,\n  setOControls\n}) {\n\n  const [clock] = React.useState(new THREE.Clock());\n  useFrame((state)=>{\n    const timeUntilNextFrame = (1000 / fps) - clock.getDelta();\n    setTimeout(()=>\n      {\n        state.ready=true;\n        state.invalidate();\n      },\n      Math.max(0, timeUntilNextFrame)\n    )\n    state.ready=false;\n    const nStepsPerSecond = 1 / model.Model.h;\n    model.step(Math.floor((1.5 / model.Model.h ) / fps));\n  }, 0)\n\n\n  const joints=[];\n  const beams=[];\n  const faces = [];\n\n  for (let [i, v] of model.v.entries()) {\n    joints.push(\n      <Joint\n        key={(\"J\" + String(i))}\n        v={v}\n        iv={i}\n        model={model}\n        setOControls={setOControls}\n        sharedData={sharedData}\n      />\n    )\n  }\n\n  for (let [i, e] of model.e.entries()) {\n    const v0 = model.v[e[0]];\n    const v1 = model.v[e[1]];\n    beams.push(\n      <Beam\n        key={(\"B\"+String(i))}\n        v0={v0}\n        v1={v1}\n        ie={i}\n        model={model}\n        sharedData={sharedData}\n        selected={e.selected}\n        hovered={e.hovered}\n      />\n      )\n  }\n\n  // for (let [i, f] of model.faces.entries()) {\n  //   const vertices = f.map(iv=>model.v[iv]);\n  //   faces.push(\n  //     <Face key={\"F\" + String(i)} vertices={vertices} sharedData={sharedData} model={model} i={i}/>\n  //   );\n  // }\n\n  return ([...joints, ...beams])\n}\n\n\nfunction DLight() {\n  const light = new THREE.DirectionalLight(new THREE.Color(1,1,1), 1.5);\n  light.position.set(0, 0, 5);\n  light.castShadow = true;\n  let mapSize = 30\n  light.shadow.mapSize.width = 20 * mapSize;\n  light.shadow.mapSize.height = 20 * mapSize;\n  light.shadow.camera.top = -3 * mapSize;\n  light.shadow.camera.right = 3 * mapSize;\n  light.shadow.camera.left = -3 * mapSize;\n  light.shadow.camera.bottom = 3 * mapSize;\n  light.shadow.camera.near = 0.1;\n  light.shadow.camera.far = 500;\n  return (<primitive object={light}/>)\n}\n\nconst Controls = ({oControls}) => {\n\n  const {\n    camera,\n    gl: { domElement },\n  } = useThree();\n  /* Invoke the OrbitControls' update function on every frame */\n  useFrame(() => oControls.current.update())\n\n  return <orbitControls ref={oControls} args={[camera, domElement]}/>\n}\n\nfunction Viewer({model, sharedData}) {\n  const oControls = useRef();\n  model.controls = oControls;\n  const [, forceUpdate] = useReducer(x => { return (x+1)}, 0);\n  model.forceUpdate = forceUpdate;\n  window.updateModel = forceUpdate;\n  model.recordHistory();\n\n  function setOControls(s){\n    oControls.current.enabled = s\n  }\n\n  return (\n      <Canvas\n        shadowMap={true}\n        concurrent={true}\n        onCreated={({gl, camera}) => {\n          // let intensity = 0.92\n          let intensity = 1.0\n          gl.setClearColor(new THREE.Color(intensity, intensity, intensity))\n          gl.setPixelRatio(window.devicePixelRatio);  // required\n          gl.shadowMap.enabled=true;  // default\n          gl.shadowMap.type=THREE.PCFSoftShadowMap; // default\n        }}\n        camera={{\n          fov: 45,\n          position:[0, -20, 1],\n          up:[0, 0, 1]\n        }}\n\n        gl={{antialias:true}}\n      >\n        <Controls oControls={oControls}/>\n        <ambientLight\n          color={new THREE.Color(1, 1, 1)}\n          intensity={0.5}\n        />\n\n        <DLight/>\n\n        <mesh\n          position={[0, 0, 0]}\n          receiveShadow={true}\n          visible={true}\n        >\n          <planeGeometry args={[10000, 10000]}/>\n          <shadowMaterial opacity={0.3}/>\n        </mesh>\n\n        <gridHelper\n          args={[100, 100]}\n          rotation-x={-Math.PI/2}\n          position-z={0}\n          visible={true}\n        />\n\n        <PneuMesh model={model} sharedData={sharedData} setOControls={setOControls}/>\n        {/*<Stats/>*/}\n\n      </Canvas>\n  );\n}\n\nexport default Viewer;\n","import './style.css';\nimport React, {useRef, useState, useMemo, useReducer} from 'react'\nimport {makeStyles, Grid, List, ListItem, ListItemIcon, ListItemText, Divider,\n        Icon, Slider, Switch, Typography, IconButton}\n        from '@material-ui/core'\nimport { extend, Canvas, useFrame, useThree, useResource, useUpdate } from 'react-three-fiber'\nimport {AccessAlarm, Publish, GetApp, ChevronLeft, Edit, GpsFixed, GpsNotFixed,\n        RadioButtonChecked, RadioButtonUnchecked, FilterCenterFocus, AddCircleOutlineRounded, VerticalAlignCenter,\n        SettingsEthernet, WbSunny, FiberManualRecord, Lock, LockOpen} from \"@material-ui/icons\";\n\nconst cBackground = \"rgba(200, 200, 200, 0.6)\";\n\nconst cHovered = \"rgba(250, 250, 250, 0.9)\";\nconst cOff = \"rgba(150, 150, 150, 1)\";\n\nconst cChannels = [\n  \"rgb(100, 150, 220)\",\n  \"rgb(240, 240, 20)\",\n  \"rgb(200, 100, 200)\",\n  \"rgb(100, 200, 130)\",\n  \"rgb(200, 100, 200)\",\n];\n\nconst widthBlock = 5;   // vh\nconst heightBlock = 5;    // vh\nconst paddingBlock = 1;   // vh\nconst marginBlock = 0.5;     // vh\nconst paddingBlocks = 0.5;\nconst widthSlider = 20;\nconst marginSlider = 0.1;\nconst widthSliders = (widthSlider + marginSlider * 2);\n\n\nconst useStyles = makeStyles((theme) => ({\n  mainGUI: {\n    position: \"absolute\",\n    right: \"1.5vh\",\n    top: \"1.5vh\",\n    width: \"28vh\",\n    height: \"auto\",\n    background: cBackground,\n    \"& .MuiList-root\" : {\n      \"& .MuiListItem-root\" : {\n        minHeight: \"6vh\"\n      }\n    }\n  },\n  editingGUI: {\n    position: \"absolute\",\n    right: \"30vh\",\n    top: \"1.5vh\",\n    width: \"30vh\",\n    // height: \"30vh\",\n    background: cBackground,\n  },\n  scriptGUI: {\n    position: \"absolute\",\n    left: \"2vh\",\n    bottom: \"2vh\",\n    background: cBackground,\n  },\n  editingScriptGUI: {\n    position: \"absolute\",\n    right: \"30vh\",\n    top: \"44vh\",\n    width: \"30vh\",\n    background: cBackground,\n  }\n}))\n\nfunction SettingActive({model, updateGUI}) {\n  const icons = [];\n\n  let passive =\n    ![...Array(model.e.length).keys()].every(ie=>(\n      (model.eStatus[ie] !== 2) || (model.eStatus[ie] === 2 && model.edgeActive[ie] === true)\n    ));\n\n  let active =\n    ![...Array(model.e.length).keys()].every(ie=>(\n      (model.eStatus[ie] !== 2) || (model.eStatus[ie] === 2 && model.edgeActive[ie] === false)\n    ));\n\n  icons.push(\n    <Grid item key={\"active\"} style={{width: \"50%\", textAlign: \"center\"}}>\n    <IconButton\n      size={\"small\"}\n      onClick={()=> {\n          for (let ie = 0; ie < model.e.length; ie++) {\n            if (model.eStatus[ie] === 2) {\n              model.edgeActive[ie] = true;\n              model.lMax[ie] = model.Model.defaultMaxLength;\n            }\n          }\n          updateGUI();\n          setTimeout(model.forceUpdate, 50);\n        }\n      }\n    >\n      <WbSunny/>\n    </IconButton>\n    </Grid>\n  )\n\n  icons.push(\n    <Grid item key={\"passive\"} style={{width: \"50%\", textAlign: \"center\"}}>\n    <IconButton\n      size={\"small\"}\n      onClick={()=> {\n          for (let ie = 0; ie < model.e.length; ie++) {\n            if (model.eStatus[ie] === 2) {\n              model.edgeActive[ie] = false;\n            }\n          }\n          updateGUI();\n          setTimeout(model.forceUpdate, 50);\n        }\n      }\n    >\n      <FiberManualRecord/>\n    </IconButton>\n    </Grid>\n  )\n\n\n  return (\n    <ListItem>\n      <ListItemText style={{width: \"50%\"}}>\n        Active / Passive\n      </ListItemText>\n      <Grid container style={{width: \"50%\"}}>\n        {icons}\n      </Grid>\n    </ListItem>\n  )\n}\n\nfunction SettingChannel({n, model, updateGUI}) {\n  const icons = [];\n\n  for (let i=0; i<n; i++) {\n    let checked =\n      ![...Array(model.e.length).keys()].every(ie=>(\n        (model.eStatus[ie] !== 2) || ((model.eStatus[ie] === 2) && (model.edgeChannel[ie] !== i))\n      ))\n\n    const color = cChannels[i];\n\n    icons.push(\n      <Grid key={i} item style={{width: `${1/n * 100}%`, textAlign: \"center\"}} >\n        <IconButton\n          size={\"small\"}\n          onClick={()=> {\n              for (let ie = 0; ie < model.e.length; ie++) {\n                if (model.eStatus[ie] === 2) {\n                  model.edgeChannel[ie] = i;\n                }\n              }\n              updateGUI();\n\n            }\n          }\n        >\n          {checked? <RadioButtonChecked style={{\"color\": color}}/> :  <RadioButtonUnchecked style={{\"color\": color}}/>}\n        </IconButton>\n      </Grid>\n    )\n  }\n\n  return (\n  <ListItem>\n    <Grid container styles={{width: \"50%\"}}>\n      {icons}\n    </Grid>\n  </ListItem>\n  )\n}\n\nfunction ControlChannel({n, model, updateGUI}) {\n  const switches = [];\n\n  for (let i=0; i<n; i++) {\n    switches.push(\n      <Grid key={i} item style={{width: `${1/n * 100}%`, textAlign: \"center\"}}>\n        <Switch\n          size={\"small\"}\n          checked={Boolean(model.inflateChannel[i])}\n          onClick={(e)=>{\n            console.log(e.target.checked);\n            model.inflateChannel[i] = e.target.checked;\n            updateGUI();\n          }}\n        />\n        </Grid>\n    );\n  }\n\n\n  return(\n    <ListItem>\n      <Grid container styles={{width: \"100%\"}} alignItems={\"center\"}>\n        {switches}\n      </Grid>\n    </ListItem>\n  )\n}\n\nfunction Scripts({model, sharedData, updateGUI, classes}) {\n  model.precompute();\n  const widthBlocks = (widthBlock + marginBlock * 2) * model.numActions + paddingBlocks * 2;\n\n  const Block = ({model, iChannel, iAction}) => {\n    const [hovered, setHovered] = useState(false);\n    const isOn = model.script[iChannel][iAction];\n    const [actuating, setActuating] = useState(iAction===model.iAction);\n\n    return (\n      <Grid item\n            key={iAction}\n            className={classes.scriptBlock}\n            style={{\n              background: cChannels[iChannel],\n              width: `${widthBlock}vh`,\n              height: `${heightBlock}vh`,\n              padding: `${paddingBlock}vh`,\n              margin: `${marginBlock}vh`,\n              border: `2px ${hovered?\"solid\":\"none\"} ${cHovered}`,\n              opacity: `${isOn?1:hovered?0.8:0.1}`\n            }}\n            onPointerOver={()=>{setHovered(true)}}\n            onPointerOut={()=>{setHovered(false)}}\n            onClick={()=>{model.script[iChannel][iAction]=!isOn}}\n      >\n      </Grid>\n    )\n  }\n\n  const Row = ({model, iChannel}) => {\n    const blocks = [];\n    for (let iAction=0; iAction<model.numActions; iAction++) {\n      const isOn=true;\n      blocks.push(\n        <Block key={iAction} model={model} isOn={isOn} iChannel={iChannel} iAction={iAction} />\n      );\n    }\n\n    return(\n      <Grid container item spacing={0}>\n        {/*<React.Fragment>*/}\n          {blocks}\n        {/*</React.Fragment>*/}\n      </Grid>\n    )\n  }\n\n  const rows = [];\n  for (let iChannel=0; iChannel<model.numChannels; iChannel++) {\n    rows.push(<Row key={iChannel} iChannel={iChannel} model={model}/>)\n  }\n\n  return ([\n    <Grid key={'buttons'} container item spacing={0} style={{padding:`${paddingBlocks}vh`, width: `${widthBlocks}vh`}}>\n      {rows}\n    </Grid>,\n\n    ]\n  );\n}\n\n\nfunction GUI({model, options, sharedData}) {\n\n  const [, updateGUI] = useReducer(x => x+1, 0);\n  sharedData.updateGUI = updateGUI;\n  window.updateGUI = updateGUI;\n  model.recordHistory();\n\n  const classes = useStyles();\n\n  const load = (e)=>{\n    let input = document.createElement('input');\n    document.body.appendChild(input);\n    input.type = 'file';\n    input.id = 'inputFile';\n    input.style = 'display:none';\n\n    document.getElementById(\"inputFile\").click();\n    document.getElementById(\"inputFile\").onchange = ()=>{\n\n      let reader = new FileReader();\n      reader.onload = (event) => {\n        let inputFileString = event.target.result;\n        window.inputFileString = inputFileString;\n        let data = JSON.parse(inputFileString);\n        window.data =data;\n        model.loadDict(data);\n        model.simulate=false;\n        model.Model.gravity=true;\n        model.forceUpdate();\n        updateGUI();\n      };\n      reader.readAsText(document.getElementById(\"inputFile\").files[0]);\n      document.body.removeChild(input);\n    };\n  }\n\n  const save = (e)=>{\n    model.recordV();\n\n    let data = model.saveData();\n    let json = JSON.stringify(data);\n\n    let download = document.createElement('a');\n    document.body.appendChild(download);\n    download.download = 'download.json';\n    download.style.display = 'none';\n    download.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(json);\n    download.click();\n    document.body.removeChild(download);\n  }\n\n  return (\n    [\n    <div key={\"mainGUI\"} className={classes.mainGUI}\n         onPointerOver={(e)=>{sharedData.GUIHovered=true}}\n         onPointerOut={(e)=>{sharedData.GUIHovered=false}}\n    >\n      <List>\n        <ListItem button\n                  onClick={save}>\n          <ListItemIcon>\n            <GetApp/>\n          </ListItemIcon>\n          <ListItemText>\n            Download\n          </ListItemText>\n        </ListItem>\n\n        <ListItem button selected={false}\n                  onClick={load}>\n          <ListItemIcon>\n            <Publish/>\n          </ListItemIcon>\n          <ListItemText>\n            Load\n          </ListItemText>\n        </ListItem>\n\n        <Divider/>\n\n        <ListItem button selected={model.editing}\n                  onClick={(e)=>{\n                    model.editing = !model.editing;\n                    sharedData.editingScript = false;\n                    model.simulate = true;\n                    sharedData.movingJoint = false;\n                    sharedData.removingJoint = false;\n                    sharedData.addingJoint = false;\n                    updateGUI();\n                    if (model.editing) {\n                      // model.resetV();\n                    }\n                    model.forceUpdate();\n                  }}>\n          <ListItemIcon>\n            <ChevronLeft/>\n          </ListItemIcon>\n          <ListItemText>\n            Edit Shape\n          </ListItemText>\n        </ListItem>\n\n\n        <ListItem>\n          <Typography style={{width: \"50%\"}}>\n            Contraction\n          </Typography>\n          <Slider\n            style={{width: \"50%\"}}\n            disabled={\n             model.eStatus.includes(2) ?\n               ![...Array(model.e.length).keys()].every(ie=>(\n                 (model.eStatus[ie]===2 && model.edgeActive[ie]) || (model.eStatus[ie] !==2))) :\n                 true\n            }\n            defaultValue={model.Model.maxMaxContraction}\n            aria-labelledby={\"discrete-slider-custom\"}\n            step={model.Model.contractionInterval}\n            min={0}\n            max={model.Model.maxMaxContraction}\n            valueLabelDisplay={\"auto\"}\n            onChange={(e, val)=>{\n              for (let i=0; i<model.e.length; i++) {\n                if (model.eStatus[i] === 2) {\n                  model.maxContraction[i] = val;\n                }\n              }\n            }}\n            onPointerUp={()=>{model.forceUpdate();}}\n          />\n        </ListItem>\n\n        <ListItem>\n          <Typography style={{width: \"50%\"}}>\n            Length\n          </Typography>\n            <Slider\n              style={{width: \"50%\"}}\n              disabled={\n                model.eStatus.includes(2) ?\n                  ![...Array(model.e.length).keys()].every(ie=>(\n                    (model.eStatus[ie]===2 && !model.edgeActive[ie]) || (model.eStatus[ie] !==2))) :\n                  true\n              }\n              defaultValue={model.Model.defaultMinLength}\n              aria-labelledby={\"discrete-slider-custom\"}\n              step={model.Model.contractionInterval * model.Model.defaultMaxLength}\n              min={model.Model.defaultMinLength}\n              max={model.Model.defaultMaxLength}\n              valueLabelDisplay={\"auto\"}\n              // marks={marks}\n              onChange={\n                (e, val)=>{\n                  for (let i=0; i<model.e.length; i++) {\n                    if (model.eStatus[i] === 2 && model.edgeActive[i] === false) {\n                      model.lMax[i] = val;\n                    }\n                  }\n                  model.forceUpdate();\n                }\n              }\n              onPointerUp={()=>{model.forceUpdate()}}\n\n\n            />\n        </ListItem>\n\n        <ListItem>\n          <ListItemText style={{width: \"50%\"}}>\n            Fix Joints\n          </ListItemText>\n          <Grid container style={{width: \"50%\"}}  spacing={0} alignItems={\"center\"}>\n          <Grid item key={\"fix\"} style={{width: \"50%\" , textAlign: \"center\"}}>\n\n          <IconButton\n            size={\"small\"}\n            onClick={(e)=>{\n              for (let i=0; i<model.v.length; i++) {\n                if (model.vStatus[i] === 2) model.fixedVs[i] = true;\n              }\n              updateGUI();\n              model.forceUpdate();\n            }}>\n              <Lock/>\n          </IconButton>\n          </Grid>\n\n            <Grid item key={\"unfix\"} style={{width: \"50%\" , textAlign: \"center\"}}>\n          <IconButton\n            size={\"small\"}\n            onClick={(e)=>{\n              for (let i=0; i<model.v.length; i++) {\n                if (model.vStatus[i] === 2) model.fixedVs[i] = false;\n              }\n              updateGUI();\n              model.forceUpdate();\n            }}>\n              <LockOpen/>\n          </IconButton>\n          </Grid>\n          </Grid>\n\n        </ListItem>\n\n        <SettingActive model={model} updateGUI={updateGUI}/>\n\n\n        <Divider/>\n\n        <ListItem button selected={sharedData.editingScript}\n                  onClick={(e)=>{\n                    sharedData.editingScript = !sharedData.editingScript;\n                    model.editing = false;\n                    updateGUI();\n                  }}>\n          <ListItemIcon>\n            <ChevronLeft/>\n          </ListItemIcon>\n          <ListItemText>\n            Script & Channel\n          </ListItemText>\n        </ListItem>\n\n        <SettingChannel n={model.numChannels} model={model} updateGUI={updateGUI}/>\n\n        <ControlChannel n={model.numChannels} model={model} updateGUI={updateGUI}/>\n\n        <Divider/>\n\n        <ListItem>\n          <ListItemText>\n            Gravity\n          </ListItemText>\n          <Switch\n            i={0}\n            checked={model.Model.gravity}\n            onChange={(e)=>{\n              model.Model.gravity = !model.Model.gravity;\n              updateGUI();\n            }}\n          />\n        </ListItem>\n\n\n        <ListItem>\n          <ListItemText>\n            Simulate\n          </ListItemText>\n          <Switch\n            i={0}\n            checked={model.simulate}\n            onChange={(e)=>{\n              model.simulate = !model.simulate;\n              updateGUI();\n            }}\n          />\n        </ListItem>\n\n\n        <ListItem>\n          <Typography style={{width: \"50%\"}}>\n            Friction\n          </Typography>\n          <Slider\n            style={{width: \"50%\"}}\n            defaultValue={model.Model.frictionFactor}\n            aria-labelledby={\"discrete-slider-custom\"}\n            step={0.1}\n            min={0}\n            max={1}\n            valueLabelDisplay={\"auto\"}\n            // marks={marks}\n          />\n        </ListItem>\n\n        <Divider/>\n\n        <ListItem button\n                  onClick={(e)=>{\n                    model.controls.current.target = model.centroid();\n                    model.forceUpdate();\n                  }}>\n          <ListItemIcon>\n            <FilterCenterFocus/>\n          </ListItemIcon>\n          <ListItemText>\n            Look At Center\n          </ListItemText>\n        </ListItem>\n\n\n        <ListItem>\n          <ListItemText>\n            Channel Color\n          </ListItemText>\n          <Switch\n            i={1}\n            checked={sharedData.showChannel}\n            onChange={(e)=>{\n              sharedData.showChannel = !sharedData.showChannel;\n              updateGUI();\n            }}\n          />\n        </ListItem>\n\n        <ListItem>\n          <ListItemText>\n            Length Info\n          </ListItemText>\n          <Switch\n            i={2}\n            checked={sharedData.showInfo}\n            onChange={(e)=>{\n              sharedData.showInfo = !sharedData.showInfo;\n              updateGUI();\n            }}\n          />\n        </ListItem>\n\n      </List>\n    </div>,\n\n\n    <div key={\"editingGUI\"} className={classes.editingGUI}\n         style={model.editing ? {display: \"block\"} : {display: \"none\"}}\n         onPointerOver={(e)=>{sharedData.GUIHovered=true}}\n         onPointerOut={(e)=>{sharedData.GUIHovered=false}}\n    >\n        <List>\n          <ListItem>\n            <ListItemText>\n              Add Joint\n            </ListItemText>\n            <Switch\n              key={\"add_joint\"}\n              checked={sharedData.addingJoint}\n              onChange={(e,val)=>{\n                sharedData.addingJoint = val;\n                if (val) {\n                  sharedData.removingJoint = false;\n                  sharedData.movingJoint = false;\n                }\n                updateGUI();\n              }}\n            />\n          </ListItem>\n\n          <ListItem>\n            <ListItemText>\n              Move Joint\n            </ListItemText>\n            <Switch\n              key={\"add_joint\"}\n              checked={sharedData.movingJoint}\n              onChange={(e,val)=>{\n                sharedData.movingJoint = val;\n                if (val) {\n                  sharedData.removingJoint = false;\n                  sharedData.addingJoint = false;\n                }\n                model.simulate = true;\n                model.resetSelection();\n                updateGUI();\n              }}\n            />\n          </ListItem>\n\n          <ListItem>\n            <ListItemText>\n              Remove Joint\n            </ListItemText>\n            <Switch\n              key={\"remove_joint\"}\n              checked={sharedData.removingJoint}\n              onChange={(e,val)=>{\n                sharedData.removingJoint = val;\n                if (val) {\n                  sharedData.addingJoint = false;\n                  sharedData.movingJoint = false;\n                }\n                updateGUI();\n              }}\n            />\n          </ListItem>\n\n          <ListItem button\n                    onClick={(e)=>{\n                      const iJoints = [];\n                      for (let i=0; i<model.v.length; i++) {\n                        if (model.vStatus[i] === 2) iJoints.push(i);\n                      }\n                      model.addEdges(iJoints);\n                      model.precompute();\n                      model.forceUpdate();\n                      updateGUI();\n                    }}>\n            <ListItemIcon>\n              <SettingsEthernet />\n            </ListItemIcon>\n            <ListItemText>\n              Connect Joints\n            </ListItemText>\n          </ListItem>\n\n          <Divider/>\n\n          <ListItem>\n            <ListItemText>\n              X:\n            </ListItemText>\n            <Slider\n              key={\"sliderX\"}\n              defaultValue={0}\n              arial-labelledby={\"continuous-slider\"}\n              step={0.01}\n              min={-Math.PI}\n              max={Math.PI}\n              valueLabelDisplay={\"auto\"}\n              onMouseDown={(e)=>{\n                model.center();\n                model.Model.gravity = false;\n              }}\n              onMouseUp={(e)=>{\n                model.center();\n                model.Model.gravity = true;\n              }}\n              onChange={(e, val)=>{\n                model.rotateTo(val, model.euler.y, model.euler.z);\n                // model.resetV();\n              }}\n            />\n          </ListItem>\n\n\n          <ListItem>\n            <ListItemText>\n              Y:\n            </ListItemText>\n            <Slider\n              key={\"sliderY\"}\n              defaultValue={0}\n              arial-labelledby={\"continuous-slider\"}\n              step={0.01}\n              min={-Math.PI}\n              max={Math.PI}\n              valueLabelDisplay={\"auto\"}\n              onMouseDown={(e)=>{\n                model.center();\n                model.Model.gravity = false;\n              }}\n              onMouseUp={(e)=>{\n                model.center();\n                model.Model.gravity = true;\n              }}\n              onChange={(e, val)=>{\n                model.rotateTo(model.euler.x, val, model.euler.z);\n                // model.resetV();\n              }}\n            />\n          </ListItem>\n\n          <ListItem>\n            <ListItemText>\n              Z:\n            </ListItemText>\n            <Slider\n              key={\"sliderZ\"}\n              defaultValue={0}\n              arial-labelledby={\"continuous-slider\"}\n              step={0.01}\n              min={-Math.PI}\n              max={Math.PI}\n              valueLabelDisplay={\"auto\"}\n              onMouseDown={(e)=>{\n                model.center();\n                model.Model.gravity = false;\n              }}\n              onMouseUp={(e)=>{\n                model.center();\n                model.Model.gravity = true;\n              }}\n              onChange={(e, val)=>{\n                model.rotateTo(model.euler.x, model.euler.y, val);\n                // model.resetV();\n              }}\n            />\n          </ListItem>\n\n\n          <ListItem button\n                    onClick={(e)=>{\n                      model.numSteps = 0;\n                      model.simulate = false;\n                      model.v = model.v0;\n                      model.center();\n                      model.precompute();\n                      model.forceUpdate();\n                      updateGUI();\n                    }}>\n            <ListItemIcon>\n              <AddCircleOutlineRounded />\n            </ListItemIcon>\n            <ListItemText>\n              Center Model\n            </ListItemText>\n          </ListItem>\n\n\n          {/*<ListItem button*/}\n          {/*          onClick={(e)=>{*/}\n          {/*            model.recordV();*/}\n          {/*          }}>*/}\n          {/*  <ListItemIcon>*/}\n          {/*    <SettingsEthernet />*/}\n          {/*  </ListItemIcon>*/}\n          {/*  <ListItemText>*/}\n          {/*    Record V*/}\n          {/*  </ListItemText>*/}\n          {/*</ListItem>*/}\n\n          <ListItem button\n                    onClick={(e)=>{\n                      const iJointsSelected = [];\n                      for (let i=0; i<model.v.length; i++) {\n                        if (model.vStatus[i] === 2) iJointsSelected.push(i);\n                      }\n\n                      model.align(true, iJointsSelected);\n                      model.forceUpdate();\n                    }}>\n            <ListItemIcon>\n              <VerticalAlignCenter />\n            </ListItemIcon>\n            <ListItemText>\n              Align with X-axis\n            </ListItemText>\n          </ListItem>\n\n          {/*<ListItem button*/}\n          {/*          onClick={(e)=>{*/}\n          {/*            // model.resetV();*/}\n          {/*            model.forceUpdate();*/}\n          {/*          }}>*/}\n          {/*  <ListItemIcon>*/}\n          {/*    <SettingsEthernet />*/}\n          {/*  </ListItemIcon>*/}\n          {/*  <ListItemText>*/}\n          {/*    Reset*/}\n          {/*  </ListItemText>*/}\n          {/*</ListItem>*/}\n\n        </List>\n\n\n    </div>,\n\n    <div key={\"scriptGUI\"} className={classes.scriptGUI}\n         style={sharedData.editingScript ? {display: \"block\"} : {display: \"block\"}}\n         onPointerOver={(e)=>{sharedData.GUIHovered=true}}\n         onPointerOut={(e)=>{sharedData.GUIHovered=false}}\n    >\n      <Scripts model={model} sharedData={sharedData} classes={classes} updateGUI={updateGUI}/>\n    </div>,\n\n\n    <div key={\"editingScriptGUI\"} className={classes.editingScriptGUI}\n         style={sharedData.editingScript ? {display: \"block\"} : {display: \"none\"}}\n         onPointerOver={(e)=>{sharedData.GUIHovered=true}}\n         onPointerOut={(e)=>{sharedData.GUIHovered=false}}\n    >\n\n      <Grid key={'numChannels'} container item spacing={2} alignItems={\"center\"} style={{\n        padding:`${paddingBlocks}vh`, paddingTop:'0', paddingBottom:'0', width: `${widthSliders + 20}vh`\n      }}>\n        <Grid item style={{margin: `${marginSlider}vh`, width: \"10vh\", fontSize:\"small\"}}>\n          Channels\n        </Grid>\n        <Grid item style={{margin:`${marginSlider}vh` , width: `${widthSlider}vh`}}>\n\n          <Slider\n            key={'numChannels'}\n            defaultValue={model.Model.defaultNumChannels}\n            aria-labelledby={\"discrete-slider-custom\"}\n            step={1}\n            min={1}\n            max={5}\n            valueLabelDisplay={\"auto\"}\n            onChange={(e, val)=>{\n              model.numChannels = val;\n              model.precompute();\n              updateGUI();\n            }}\n          />\n        </Grid>\n      </Grid>\n\n      <Grid key={'numActions'} container item spacing={2} alignItems={\"center\"} style={{\n        padding:`${paddingBlocks}vh`, paddingTop:'0', paddingBottom:'0', width: `${widthSliders + 20}vh`\n      }}>\n        <Grid item style={{margin: `${marginSlider}vh`,  width: \"10vh\", fontSize:\"small\"}}>\n          Actions\n        </Grid>\n        <Grid item style={{margin:`${marginSlider}vh` , width: `${widthSlider}vh`}}>\n\n          <Slider\n            key={'numActions'}\n            defaultValue={model.Model.defaultNumActions}\n            aria-labelledby={\"discrete-slider-custom\"}\n            step={1}\n            min={1}\n            max={20}\n            valueLabelDisplay={\"auto\"}\n            onChange={(e, val)=>{\n              model.numActions = val;\n              model.precompute();\n              updateGUI();\n            }}\n          />\n        </Grid>\n      </Grid>\n\n    </div>\n\n\n  ]\n  )\n}\n\n\nexport default GUI;\n","import {Model} from './model.js'\nimport Viewer from './viewer.js'\nimport GUI from './gui';\nimport React, {useRef} from \"react\";\n\nlet model = new Model();\nwindow.model = model;\n\nconst sharedData = {\n  updateGUI: null,\n  GUIHovered: false,\n  unSelect: false,\n  addingJoint: false,\n  movingJoint: false,\n  removingJoint: false,\n  showChannel: false,\n  editingScript: false,\n  numActions: 20,\n  numChannels: 4,\n  infoPanel: null,\n  showInfo: false\n};\nmodel.sharedData = sharedData;\nwindow.sharedData = sharedData;\n\nsharedData.infoPanel = document.getElementById('infoPanel');\nif (!sharedData.infoPanel) {\n  sharedData.infoPanel = document.createElement('div');\n  document.body.appendChild(sharedData.infoPanel);\n}\nsharedData.infoPanel.id = 'infoPanel';\nsharedData.infoPanel.style.background = 'rgba(255, 255, 255, 0.9)';\nsharedData.infoPanel.style.position = 'absolute';\nsharedData.infoPanel.style.padding = '10px';\nsharedData.infoPanel.appendChild(sharedData.infoPanel.ownerDocument.createTextNode(\" \"));\n\n\nwindow.addEventListener('pointerdown', (e)=>{\n  sharedData.unSelect = true;\n}, false);\n\nwindow.addEventListener('pointermove', (e)=>{\n  sharedData.unSelect = false;\n}, false);\n\nwindow.addEventListener('pointerup', (e)=>{\n  if (sharedData.unSelect) {\n    if (!sharedData.GUIHovered) {\n      if (model.vStatus.every(b => b !== 1) && model.eStatus.every(b => b !== 1) && model.fStatus.every(b => b !== 1)) {\n        model.vStatus.fill(0);\n        model.eStatus.fill(0);\n        model.fStatus.fill(0);\n      }\n    }\n\n    if (sharedData.updateGUI) setTimeout(() => {\n      sharedData.updateGUI()\n    }, 10);\n  }\n\n}, false);\n\nwindow.addEventListener('keydown', (e)=>{\n    if (e.code === \"KeyA\" && (e.metaKey || e.ctrlKey)) {\n      model.eStatus.fill(2);\n      model.vStatus.fill(2);\n    }\n\n    if (e.code === \"KeyZ\" && (e.metaKey || e.ctrlKey) && (!e.shiftKey)) {\n      model.undo();\n      setTimeout(()=>{window.updateModel()}, 10);\n    }\n\n    if (e.code === \"KeyZ\" && (e.metaKey || e.ctrlKey) && (e.shiftKey)) {\n      model.redo();\n      setTimeout(()=>{window.updateModel()}, 10);\n    }\n\n  }\n  , false)\n\n\nfunction Main() {\n  return (\n    [\n      <Viewer key={'viewer'} model={model} sharedData={sharedData}/>,\n      <GUI id={'hehe'} key={'gui'} model={model} sharedData={sharedData}/>\n    ]\n  )\n\n}\n\nexport default Main;","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport Main from './main';\nimport GUI from './gui';\nimport reportWebVitals from './reportWebVitals';\n\nlet root = document.getElementById('root');\nReactDOM.render(\n  <React.StrictMode>\n    <Main />\n  </React.StrictMode>,\n  root\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}