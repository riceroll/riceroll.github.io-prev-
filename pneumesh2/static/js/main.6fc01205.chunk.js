(this.webpackJsonpreact3=this.webpackJsonpreact3||[]).push([[0],{54:function(e,t,n){},75:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(26),s=n.n(o),c=(n(75),n(14)),l=n(4),r=n(7),h=n(1),d=function(){function e(t,n,i,a,o){Object(l.a)(this,e),this.pos=t,this.fixed=n,this.pos0=i,this.vel=a,this.force=o,this.vs=[],this.es=[],this.fs=[],this.id=e.all.length,e.all.push(this)}return Object(r.a)(e,[{key:"facesOnTheOtherSide",value:function(){}}]),e}();d.all=[];var u=function e(t,n,i,a,o,s){Object(l.a)(this,e),this.vs=[],this.lMax=n,this.maxContraction=i,this.edgeChannel=a,this.edgeActive=o,this.l=s;var r,h=Object(c.a)(t);try{for(h.s();!(r=h.n()).done;){var u=r.value;this.vs.push(d.all[u])}}catch(v){h.e(v)}finally{h.f()}d.all[t[0]].vs.push(d.all[t[1]]),d.all[t[1]].vs.push(d.all[t[0]]),d.all[t[0]].es.push(this),d.all[t[1]].es.push(this),this.id=e.all.length,e.all.push(this)};u.all=[];var v=function(){function e(){Object(l.a)(this,e),this.viewer=null,this.Vertex=d,this.Edge=u,this.Model=e,this.controls=null,this.sharedData=null,this.reset(),this.loadData(),this.resetSelection(),this.recordV()}return Object(r.a)(e,[{key:"reset",value:function(){this.v=[],this.e=[],this.v0=[],this.fixedVs=[],this.lMax=[],this.edgeActive=[],this.edgeChannel=[],this.script=[],this.maxContraction=[],this.vel=[],this.f=[],this.l=[],this.vStatus=[],this.eStatus=[],this.fStatus=[],this.iAction=0,this.numSteps=0,this.timeStart=new Date,this.editing=!1,this.simulate=!0,this.gravity=!0,this.directional=!1,this.euler=new h.Euler(0,0,0),this.numChannels=e.defaultNumChannels,this.numActions=e.defaultNumActions,this.inflateChannel=new Array(this.numChannels).fill(!1),this.contractionPercent=new Array(this.numChannels).fill(1)}},{key:"loadDict",value:function(e){for(var t,n,i,a,o,s=[],c=Array.from(e.e),l=[],r=[],d=0;d<e.v.length;d++)s.push(new h.Vector3(e.v[d][0],e.v[d][1],e.v[d][2]));this.reset(),e.lMax&&(t=e.lMax),e.maxContraction&&(n=e.maxContraction),e.fixedVs&&(i=e.fixedVs),e.edgeChannel&&(a=e.edgeChannel),e.edgeActive&&(o=e.edgeActive),this.loadData(s,c,l,r,t,n,i,a,o),e.lMax||e.maxContraction||e.fixedVs||this.loadData(s,c,l,r)}},{key:"loadData",value:function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];e&&t?(this.v=e,this.e=t):(this.v.push(new h.Vector3(1,-1/Math.sqrt(3),.2)),this.v.push(new h.Vector3(0,2/Math.sqrt(3),.2)),this.v.push(new h.Vector3(-1,-1/Math.sqrt(3),.2)),this.v.push(new h.Vector3(0,0,4/Math.sqrt(6)+.2)),this.e.push([0,1]),this.e.push([1,2]),this.e.push([2,0]),this.e.push([0,3]),this.e.push([1,3]),this.e.push([2,3])),s&&(this.fixedVs=s),a&&(this.lMax=a),o&&(this.maxContraction=o),l&&(this.edgeActive=l),c&&(this.edgeChannel=c),r&&(this.script=r),this.precompute(),this.initCheck(),this.resetSelection(),this.recordV()}},{key:"saveData",value:function(){var e,t={v:[]},n=Object(c.a)(this.v);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.v.push([i.x,i.y,i.z])}}catch(a){n.e(a)}finally{n.f()}return t.e=this.e,t.lMax=this.lMax,t.maxContraction=this.maxContraction,t.fixedVs=this.fixedVs,t.edgeChannel=this.edgeChannel,t.edgeActive=this.edgeActive,t}},{key:"resetSelection",value:function(){this.vStatus=new Array(this.v.length).fill(0),this.eStatus=new Array(this.e.length).fill(0),this.fStatus=new Array(this.f.length).fill(0)}},{key:"recordV",value:function(){this.v0=[];var e,t=-this.bbox()[5],n=Object(c.a)(this.v);try{for(n.s();!(e=n.n()).done;){var i=e.value.clone();i.z+=t,this.v0.push(i)}}catch(a){n.e(a)}finally{n.f()}}},{key:"resetV",value:function(){this.iAction=0,this.numSteps=0;for(var e=0;e<this.v.length;e++)this.v[e].copy(this.v0[e]);this.numSteps=0}},{key:"precompute",value:function(){var t=this,n=function(e,t){for(var n=0;n<Math.min(e.length,t.length);n++)t[n]=e[n];return t};this.l=[];for(var i=0;i<this.e.length;i++){var a=this.e[i];this.l.push(this.v[a[0]].distanceTo(this.v[a[1]]))}if(this.vel.length!==this.v.length){this.vel=[];for(var o=0;o<this.v.length;o++)this.vel.push(new h.Vector3)}if(this.maxContraction.length!==this.e.length){var s=new Array(this.e.length).fill(e.maxMaxContraction);this.maxContraction=n(this.maxContraction,s)}if(this.fixedVs.length!==this.v.length){var c=new Array(this.v.length).fill(!1);this.fixedVs=n(this.fixedVs,c)}if(this.lMax.length!==this.e.length){var l=new Array(this.e.length).fill(e.defaultMaxLength);this.lMax=n(this.lMax,l)}if(this.edgeActive.length!==this.e.length){var r=new Array(this.e.length).fill(!0);this.edgeActive=n(this.edgeActive,r)}if(this.edgeChannel.length!==this.e.length){var d=new Array(this.e.length).fill(0);this.edgeChannel=n(this.edgeChannel,d)}if(this.script.length!==this.numChannels||this.script.length&&this.script[0].length!==this.numActions){var u=Array(this.numChannels).fill(!1).map((function(e){return Array(t.numActions).fill(!1)}));0===this.script.length&&(this.script=u);for(var v=0;v<Math.min(this.script.length,u.length);v++)for(var f=0;f<Math.min(this.script[0].length,u[0].length);f++)u[v][f]=this.script[v][f];this.script=u}}},{key:"initCheck",value:function(){for(var t=1e5,n=0;n<this.e.length;n++)this.edgeActive[n]&&this.l[n]<t&&(t=this.l[n]);console.log("Minimum max length among active beams is ".concat(t,"."));for(var i=0;i<this.v.length;i++)this.v[i].divideScalar(t),this.v[i].multiplyScalar(e.defaultMaxLength);for(var a=0;a<this.e.length;a++)this.edgeActive[a],this.lMax[a]!==this.Model.defaultMaxLength&&(console.log("An active beam is having wrong max length ".concat(this.lMax[a],".")),this.lMax[a]=this.Model.defaultMaxLength)}},{key:"update",value:function(){this.f=[];for(var t=0;t<this.v.length;t++)this.f.push(new h.Vector3);for(var n=0;n<this.e.length;n++){var i=this.e[n],a=this.v[i[0]],o=this.v[i[1]].clone().sub(a),s=this.lMax[n];if(this.edgeActive[n]){var c=this.edgeChannel[n],l=s,r=l*(1-this.maxContraction[n]);s=l-this.contractionPercent[c]*(l-r)}var d=(o.length()-s)*e.k;d=o.normalize().multiplyScalar(d),this.f[i[0]].add(d),this.f[i[1]].add(d.negate())}for(var u=0;u<this.v.length;u++)this.gravity&&this.f[u].add(new h.Vector3(0,0,-e.gravityFactor*e.gravity))}},{key:"runScript",value:function(){if(0===this.script.length)return 0;if(this.numSteps>(this.iAction+1)%this.numActions*e.numStepsAction){this.iAction=Math.floor(this.numSteps/e.numStepsAction)%this.numActions;for(var t=0;t<this.numChannels;t++)this.inflateChannel[t]=this.script[t][this.iAction]}}},{key:"step",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=0;i<t;i++){if(this.precompute(),!this.simulate)return;n&&this.runScript(),this.update(),this.editing;for(var a=0;a<this.inflateChannel.length;a++)this.inflateChannel[a]?(this.contractionPercent[a]-=e.contractionPercentRate,this.contractionPercent[a]<0&&(this.contractionPercent[a]=0)):(this.contractionPercent[a]+=e.contractionPercentRate,this.contractionPercent[a]>1&&(this.contractionPercent[a]=1));for(var o=0;o<this.v.length;o++)if(!this.fixedVs[o]&&(!this.sharedData.movingJoint||2===this.vStatus[o])){for(this.vel[o].add(this.f[o].clone().multiplyScalar(e.h)),this.v[o].z<=0&&(this.directional?(this.vel[o].x<0&&(this.vel[o].x*=1-e.frictionFactor),this.vel[o].y<0&&(this.vel[o].y*=1-e.frictionFactor)):(this.vel[o].x*=1-e.frictionFactor,this.vel[o].y*=1-e.frictionFactor)),this.vel[o].multiplyScalar(e.dampingRatio);this.vel[o].length()>5;)this.vel[o].multiplyScalar(.9);this.v[o].add(this.vel[o].clone().multiplyScalar(e.h))}for(var s=0;s<this.v.length;s++)this.v[s].z<0&&(this.v[s].z=0,this.vel[s].z=-this.vel[s].z);this.numSteps+=1}return this.v}},{key:"addJoint",value:function(t){var n=new h.Vector3;n.copy(this.v[t]);var i=new h.Vector3(e.defaultMinLength,0,0);n=n.add(i),this.v.push(n);var a=[t,this.v.length-1];this.e.push(a)}},{key:"addEdges",value:function(e){for(var t=0;t<e.length;t++)for(var n=t+1;n<e.length;n++){var i,a=!0,o=Object(c.a)(this.e);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(s.includes(e[t])&&s.includes(e[n])){a=!1;break}}}catch(l){o.e(l)}finally{o.f()}a&&this.e.push([e[t],e[n]])}}},{key:"removeJoint",value:function(t){if(![0,1,2,3].includes(t)){this.updateDataStructure();var n,i=[],a=d.all[t],o=Object(c.a)(a.es);try{for(o.s();!(n=o.n()).done;){var s=n.value;i.push(s)}}catch(l){o.e(l)}finally{o.f()}d.all=d.all.filter((function(e){return e!==a})),u.all=u.all.filter((function(e){return!i.includes(e)})),e.reindexObjects(d),e.reindexObjects(u),this.updateFromDataStructure(),this.forceUpdate()}}},{key:"removeEdge",value:function(e){}},{key:"updateDataStructure",value:function(){d.all=[];for(var e=0;e<this.v.length;e++)new d(this.v[e],this.fixedVs[e],this.v0[e],this.vel[e],this.f[e]);u.all=[];for(var t=0;t<this.e.length;t++)new u(this.e[t],this.lMax[t],this.maxContraction[t],this.edgeChannel[t],this.edgeActive[t],this.l[t])}},{key:"updateFromDataStructure",value:function(){this.v=[],this.fixedVs=[],this.v0=[],this.vel=[],this.f=[];var e,t=Object(c.a)(d.all);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.v.push(n.pos),this.fixedVs.push(n.fixed),this.v0.push(n.pos0),this.vel.push(n.vel),this.f.push(n.f)}}catch(l){t.e(l)}finally{t.f()}this.e=[],this.lMax=[],this.maxContraction=[],this.edgeChannel=[],this.edgeActive=[],this.l=[];var i,a=Object(c.a)(u.all);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=[o.vs[0].id,o.vs[1].id];this.e.push(s),this.lMax.push(o.lMax),this.maxContraction.push(o.maxContraction),this.edgeChannel.push(o.edgeChannel),this.edgeActive.push(o.edgeActive),this.l.push(o.l)}}catch(l){a.e(l)}finally{a.f()}this.vStatus=new Array(this.v.length).fill(0),this.eStatus=new Array(this.e.length).fill(0)}},{key:"centroid",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new h.Vector3(0,0,0),i=t?this.v0:this.v,a=Object(c.a)(i);try{for(a.s();!(e=a.n()).done;){var o=e.value;n.add(o)}}catch(s){a.e(s)}finally{a.f()}return n.divideScalar(this.v.length),n}},{key:"center",value:function(){for(var e=this.centroid(!0),t=this.centroid(!1),n=0;n<this.v.length;n++)this.v[n].sub(t),this.v[n].add(e)}},{key:"stepsPerSecond",value:function(){var e=new Date;return this.numSteps/((e.getTime()-this.timeStart.getTime())/1e3)}},{key:"bbox",value:function(){var e,t,n,i,a,o;e=t=n=-1/0,i=a=o=1/0;var s,l=Object(c.a)(this.v);try{for(l.s();!(s=l.n()).done;){var r=s.value;r.x>e&&(e=r.x),r.y>t&&(t=r.y),r.z>n&&(n=r.z),r.x<i&&(i=r.x),r.y<a&&(a=r.y),r.z<o&&(o=r.z)}}catch(h){l.e(h)}finally{l.f()}return[e,t,n,i,a,o]}},{key:"infoJoints",value:function(){return"joints: "+this.v.length}},{key:"infoBeams",value:function(){return"actuators: "+this.e.length}},{key:"fixJoints",value:function(e){for(var t=0;t<e.length;t++){e[t];alert("not implemented")}}},{key:"unfixAll",value:function(){this.fixedVs=[],this.fixedVs=new Array(this.v.length).fill(!1)}},{key:"rotate",value:function(e,t,n){this.resetV();var i=this.centroid(),a=new h.Euler;a.setFromVector3(this.euler.toVector3().negate(),"ZYX"),this.euler=new h.Euler(e,t,n);for(var o=0;o<this.v.length;o++)this.v[o].sub(i),this.v[o].applyEuler(a),this.v[o].applyEuler(this.euler),this.v[o].add(i);this.recordV()}}]),e}();v.k=2e5,v.h=.001,v.dampingRatio=.992,v.contractionInterval=.075,v.contractionSteps=4,v.maxMaxContraction=Math.round(v.contractionInterval*v.contractionSteps*100)/100,v.contractionPercentRate=5e-4,v.gravityFactor=9.8,v.gravity=1,v.defaultMinLength=1.2,v.defaultMaxLength=v.defaultMinLength/(1-v.maxMaxContraction),v.frictionFactor=.8,v.numStepsAction=2/v.h,v.defaultNumActions=1,v.defaultNumChannels=4,v.reindexObjects=function(e){var t,n=0,i=Object(c.a)(e.all);try{for(i.s();!(t=i.n()).done;){t.value.id=n,n+=1}}catch(a){i.e(a)}finally{i.f()}};var f=n(10),j=(n.p,n(54),n(17)),p=n(56),g=n(126),m=n(104),b=n(2);Object(j.d)({OrbitControls:p.a});var x=new h.Color(.6,.6,.6),O=[new h.Color(.3,.3,.6),new h.Color(.6,.6,.3),new h.Color(.3,.6,.3),new h.Color(.3,.6,.6),new h.Color(.6,.3,.6)],y=(new h.Color(1,1,1),new h.Color(.05,.05,.05)),C=new h.Color(.3,.1,.1),w=new h.Color(.5,.2,.2),S=new h.Color(.2,.8,.8),M=new h.Color(.15,.15,.15),P=.02;function k(e){var t=e.v,n=e.d,a=e.c,o=e.model,s=e.handleClick,c=e.handlePointerOver,l=e.handlePointerOut,r=e.setOControls,d=e.translating,u=Object(i.useRef)(),v=Object(i.useRef)(),p=Object(i.useRef)(),m=Object(i.useState)(!1),x=Object(f.a)(m,2),O=x[0],y=x[1],C=new h.Vector3;return Object(j.e)((function(e){if(null!==u.current&&(u.current.position.copy(t),v.current.color.copy(a),d)){var n=p.current;O?(t.copy(n.worldPosition.clone().add(n.position)),u.current.position.copy(t)):p.current.position.copy(t)}})),Object(i.useEffect)((function(){var e=function(e){r(!e.value),y(e.value);var t=e.target;!1===e.value?(t.object.position.multiplyScalar(0),o.simulate=!0):(o.simulate=!1,C.copy(t.worldPosition))},n=p.current;if(n.position.copy(t),n)return n.addEventListener("dragging-changed",e),function(){n.removeEventListener("dragging-changed",e)}})),Object(b.jsx)(g.a,{ref:p,enabled:d,showX:d,showY:d,showZ:d,mode:"translate",space:"local",children:Object(b.jsxs)("mesh",{ref:u,position:t,castShadow:!0,scale:[n,n,n],onClick:s,onPointerOver:c,onPointerOut:l,children:[Object(b.jsx)("sphereBufferGeometry",{args:[1,20,20]}),Object(b.jsx)("meshStandardMaterial",{ref:v,color:a})]})})}function A(e){var t=e.v,n=e.iv,a=e.model,o=e.setOControls,s=e.sharedData,c=(a.vStatus[n],a.vStatus[n],Object(i.useState)(!1)),l=Object(f.a)(c,2),r=l[0],d=l[1],u=new h.Color;Object(j.e)((function(e){var t=2===a.vStatus[n],i=1===a.vStatus[n],o=a.fixedVs[n];u.copy(t?C:i?w:o?S:x),s.movingJoint&&2===a.vStatus[n]&&!r&&d(!0),s.movingJoint&&2===a.vStatus[n]||!r||d(!1)}));return Object(b.jsx)(k,{v:t,d:.04,model:a,handleClick:function(e){s.removingJoint?(a.removeJoint(n),a.precompute(),a.recordV(),a.forceUpdate()):s.addingJoint?(a.addJoint(n),a.precompute(),a.recordV(),a.forceUpdate()):s.movingJoint?(a.vStatus.fill(0),a.vStatus[n]=2):a.vStatus[n]=2,s.updateGUI(),e.stopPropagation()},handlePointerOver:function(e){2!==a.vStatus[n]&&(a.vStatus[n]=1),e.stopPropagation()},handlePointerOut:function(e){2!==a.vStatus[n]&&(a.vStatus[n]=0),e.stopPropagation()},setOControls:o,translating:r,c:u},"ball")}function I(e){var t=e.v0,n=e.v1,a=e.d,o=e.c,s=e.handleClick,c=e.handlePointerOver,l=e.handlePointerOut,r=Object(i.useRef)(),d=Object(i.useRef)(),u=function(e,t){var n=e.clone().add(t).divideScalar(2),i=t.clone().sub(e),a=new h.Vector3(0,1,0),o=i.length();i.normalize();var s=(new h.Quaternion).setFromUnitVectors(a,i);return[n,o,(new h.Euler).setFromQuaternion(s)]},v=u(t,n),p=Object(f.a)(v,3),g=p[0],m=p[1],x=p[2];return Object(j.e)((function(e){if(null!==r.current){var i=u(t,n),a=Object(f.a)(i,3),s=a[0],c=a[1],l=a[2];r.current.position.copy(s),r.current.rotation.copy(l),r.current.scale[1]=c,d.current.color.copy(o)}})),Object(b.jsxs)("mesh",{ref:r,position:[g.x,g.y,g.z],rotation:x,castShadow:!0,scale:[a,m,a],onClick:s,onPointerOver:c,onPointerOut:l,children:[Object(b.jsx)("cylinderBufferGeometry",{args:[1,1,1,20]}),Object(b.jsx)("meshLambertMaterial",{ref:d,color:o})]})}function V(e){var t=e.v0,n=e.v1,i=e.ie,a=e.model,o=e.sharedData,s=n.clone().sub(t);s.length();s.normalize();var c=s.clone().multiplyScalar(.527),l=s.clone().multiplyScalar(.33),r=s.clone().multiplyScalar(.02),d=l.clone().add(t),u=d.clone().add(c),v=n.clone().sub(l),f=v.clone().sub(c),p=t.clone(),g=t.clone().add(l),m=n.clone(),S=n.clone().sub(l),k=v.clone().sub(s.clone().multiplyScalar(a.lMax[i]*(a.Model.maxMaxContraction-a.maxContraction[i]))),A=k.clone().add(r),V=new h.Color,U=new h.Color,D=new h.Color,G=new h.Color,J=function(){if(o.showChannel){var e=2===a.eStatus[i],t=1===a.eStatus[i],n=O[a.edgeChannel[i]];V.copy(e?C:t?w:n),U.copy(e?C:t?w:n),D.copy(e?C:t?w:n),G.copy(e?C:t?w:n)}else{var s=2===a.eStatus[i],c=1===a.eStatus[i];V.copy(s?C:c?w:y),U.copy(s?C:c?w:x),D.copy(s?C:c?w:x),G.copy(s?C:c?w:M)}};J(),Object(j.e)((function(e){var o=n.clone().sub(t);o.length();o.normalize();var s=o.clone().multiplyScalar(.527),c=o.clone().multiplyScalar(.33),l=o.clone().multiplyScalar(.02);d.copy(c.clone().add(t)),u.copy(d.clone().add(s)),v.copy(n.clone().sub(c)),f.copy(v.clone().sub(s)),p.copy(t.clone()),g.copy(t.clone().add(c)),m.copy(n.clone()),S.copy(n.clone().sub(c)),k.copy(v.clone().sub(o.clone().multiplyScalar(a.lMax[i]*(a.Model.maxMaxContraction-a.maxContraction[i])))),A.copy(k.clone().add(l)),J()}));var L=function(e){a.eStatus[i]=2,e.stopPropagation()},z=function(e){for(2!==a.eStatus[i]&&(a.eStatus[i]=1),e.stopPropagation(),o.showInfo&&(o.infoPanel.style.display="block"),o.infoPanel.style.left=String(e.clientX)+"px",o.infoPanel.style.top=String(e.clientY)+"px";o.infoPanel.firstChild;)o.infoPanel.removeChild(o.infoPanel.firstChild);o.infoPanel.appendChild(o.infoPanel.ownerDocument.createTextNode("L: "+String(Math.round(1e3*a.l[i])/1e3/1.2*93)+"mm")),o.infoPanel.appendChild(o.infoPanel.ownerDocument.createElement("br")),o.infoPanel.appendChild(o.infoPanel.ownerDocument.createTextNode("S: "+String(Math.round(1e3*a.l[i])/1e3/1.2*62)+"mm"))},E=function(e){2!==a.eStatus[i]&&(a.eStatus[i]=0),e.stopPropagation(),o.infoPanel.style.display="none"},F=[Object(b.jsx)(I,{v0:d,v1:u,d:.05,c:V,handleClick:L,handlePointerOver:z,handlePointerOut:E},"out"),Object(b.jsx)(I,{v0:v,v1:f,d:.04,c:U,handleClick:L,handlePointerOver:z,handlePointerOut:E},"in"),Object(b.jsx)(I,{v0:p,v1:g,d:P,c:D,handleClick:L,handlePointerOver:z,handlePointerOut:E},"joint0"),Object(b.jsx)(I,{v0:S,v1:m,d:P,c:D,handleClick:L,handlePointerOver:z,handlePointerOut:E},"joint1")];return a.maxContraction[i]!==a.Model.maxMaxContraction&&F.push(Object(b.jsx)(I,{v0:k,v1:A,d:.05,c:y},"constraint")),a.edgeActive[i]?F:[Object(b.jsx)(I,{v0:t,v1:n,d:P,c:G,handleClick:L,handlePointerOver:z,handlePointerOut:E},"beam")]}function U(e){var t=e.model,n=e.sharedData,i=e.setOControls,o=a.a.useState(new h.Clock),s=Object(f.a)(o,1)[0];Object(j.e)((function(e){var n=1e3/30-s.getDelta();setTimeout((function(){e.ready=!0,e.invalidate()}),Math.max(0,n)),e.ready=!1;t.Model.h;t.step(Math.floor(2.4/t.Model.h/30))}),0);var l,r=[],d=[],u=Object(c.a)(t.v.entries());try{for(u.s();!(l=u.n()).done;){var v=Object(f.a)(l.value,2),p=v[0],g=v[1];r.push(Object(b.jsx)(A,{v:g,iv:p,model:t,setOControls:i,sharedData:n},"J"+String(p)))}}catch(M){u.e(M)}finally{u.f()}var m,x=Object(c.a)(t.e.entries());try{for(x.s();!(m=x.n()).done;){var O=Object(f.a)(m.value,2),y=O[0],C=O[1],w=t.v[C[0]],S=t.v[C[1]];d.push(Object(b.jsx)(V,{v0:w,v1:S,ie:y,model:t,sharedData:n,selected:C.selected,hovered:C.hovered},"B"+String(y)))}}catch(M){x.e(M)}finally{x.f()}return[].concat(r,d)}function D(){var e=new h.DirectionalLight(new h.Color(1,1,1),1.2);e.position.set(0,0,5),e.castShadow=!0;return e.shadow.mapSize.width=5120,e.shadow.mapSize.height=5120,e.shadow.camera.top=-30,e.shadow.camera.right=30,e.shadow.camera.left=-30,e.shadow.camera.bottom=30,e.shadow.camera.near=.1,e.shadow.camera.far=500,Object(b.jsx)("primitive",{object:e})}window.fps=30;var G=function(e){var t=e.oControls,n=Object(j.f)(),i=n.camera,a=n.gl.domElement;return Object(j.e)((function(){return t.current.update()})),Object(b.jsx)("orbitControls",{ref:t,args:[i,a]})};var J=function(e){var t=e.model,n=e.sharedData,a=Object(i.useRef)();t.controls=a;var o=Object(i.useReducer)((function(e){return e+1}),0),s=Object(f.a)(o,2)[1];return t.forceUpdate=s,Object(b.jsxs)(j.a,{shadowMap:!0,concurrent:!0,onCreated:function(e){var t=e.gl,n=(e.camera,.92);t.setClearColor(new h.Color(n,n,n)),t.setPixelRatio(window.devicePixelRatio),t.shadowMap.enabled=!0,t.shadowMap.type=h.PCFSoftShadowMap},camera:{fov:45,position:[0,-20,1],up:[0,0,1]},gl:{antialias:!0},children:[Object(b.jsx)(G,{oControls:a}),Object(b.jsx)("ambientLight",{color:new h.Color(1,1,1),intensity:.5}),Object(b.jsx)(D,{}),Object(b.jsxs)("mesh",{position:[0,0,0],receiveShadow:!0,visible:!0,children:[Object(b.jsx)("planeGeometry",{args:[1e4,1e4]}),Object(b.jsx)("shadowMaterial",{opacity:.3})]}),Object(b.jsx)("gridHelper",{args:[100,100],"rotation-x":-Math.PI/2,"position-z":0,visible:!0}),Object(b.jsx)(U,{model:t,sharedData:n,setOControls:function(e){a.current.enabled=e}}),Object(b.jsx)(m.a,{})]})},L=n(16),z=n(105),E=n(107),F=n(108),R=n(127),N=n(111),T=n(124),B=n(114),H=n(115),q=n(118),X=n(51),Y=n(125),K=n(109),Z=n(110),_=n(112),Q=n(113),W=n(116),$=n(117),ee=n(119),te=n(120),ne=n(121),ie=n(122),ae=n(123),oe="rgba(200, 200, 200, 0.6)",se=["rgb(100, 100, 200)","rgb(200, 200, 100)","rgb(100, 200, 100)","rgb(100, 200, 200)","rgb(200, 100, 200)"],ce=.5,le=.1,re=Object(z.a)((function(e){return{mainGUI:{position:"absolute",right:"1.5vh",top:"1.5vh",width:"28vh",height:"auto",background:oe,"& .MuiList-root":{"& .MuiListItem-root":{minHeight:"6vh"}}},editingGUI:{position:"absolute",right:"30vh",top:"1.5vh",width:"30vh",background:oe},scriptGUI:{position:"absolute",left:"2vh",bottom:"2vh",background:oe},editingScriptGUI:{position:"absolute",right:"30vh",top:"40vh",width:"40vh",background:oe}}}));function he(e){var t=e.model,n=e.updateGUI,i=[];Object(L.a)(Array(t.e.length).keys()).every((function(e){return 2!==t.eStatus[e]||2===t.eStatus[e]&&!0===t.edgeActive[e]})),Object(L.a)(Array(t.e.length).keys()).every((function(e){return 2!==t.eStatus[e]||2===t.eStatus[e]&&!1===t.edgeActive[e]}));return i.push(Object(b.jsx)(E.a,{item:!0,style:{width:"50%",textAlign:"center"},children:Object(b.jsx)(F.a,{size:"small",onClick:function(){for(var e=0;e<t.e.length;e++)2===t.eStatus[e]&&(t.edgeActive[e]=!0,t.lMax[e]=t.Model.defaultMaxLength);n(),setTimeout(t.forceUpdate,50)},children:Object(b.jsx)(K.a,{})})},"active")),i.push(Object(b.jsx)(E.a,{item:!0,style:{width:"50%",textAlign:"center"},children:Object(b.jsx)(F.a,{size:"small",onClick:function(){for(var e=0;e<t.e.length;e++)2===t.eStatus[e]&&(t.edgeActive[e]=!1);n(),setTimeout(t.forceUpdate,50)},children:Object(b.jsx)(Z.a,{})})},"passive")),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{style:{width:"50%"},children:"Active / Passive"}),Object(b.jsx)(E.a,{container:!0,style:{width:"50%"},children:i})]})}function de(e){for(var t=e.n,n=e.model,i=e.updateGUI,a=[],o=function(e){var o=!Object(L.a)(Array(n.e.length).keys()).every((function(t){return 2!==n.eStatus[t]||2===n.eStatus[t]&&n.edgeChannel[t]!==e}));a.push(Object(b.jsx)(E.a,{item:!0,style:{width:"".concat(1/t*100,"%"),textAlign:"center"},children:Object(b.jsx)(F.a,{size:"small",onClick:function(){for(var t=0;t<n.e.length;t++)2===n.eStatus[t]&&(n.edgeChannel[t]=e);i()},children:o?Object(b.jsx)(_.a,{}):Object(b.jsx)(Q.a,{})})},e))},s=0;s<t;s++)o(s);return Object(b.jsx)(R.a,{children:Object(b.jsx)(E.a,{container:!0,styles:{width:"50%"},children:a})})}function ue(e){for(var t=e.n,n=e.model,i=e.updateGUI,a=[],o=function(e){a.push(Object(b.jsx)(E.a,{item:!0,style:{width:"".concat(1/t*100,"%"),textAlign:"center"},children:Object(b.jsx)(T.a,{size:"small",checked:n.inflateChannel[e],onClick:function(t){console.log(t.target.checked),n.inflateChannel[e]=t.target.checked,i()}})},e))},s=0;s<t;s++)o(s);return Object(b.jsx)(R.a,{children:Object(b.jsx)(E.a,{container:!0,styles:{width:"100%"},alignItems:"center",children:a})})}function ve(e){var t=e.model,n=(e.sharedData,e.updateGUI,e.classes);t.precompute();for(var a=6*t.numActions+1,o=function(e){var t=e.model,a=e.iChannel,o=e.iAction,s=Object(i.useState)(!1),c=Object(f.a)(s,2),l=c[0],r=c[1],h=t.script[a][o],d=Object(i.useState)(o===t.iAction),u=Object(f.a)(d,2);u[0],u[1];return Object(b.jsx)(E.a,{item:!0,className:n.scriptBlock,style:{background:se[a],width:"".concat(5,"vh"),height:"".concat(5,"vh"),padding:"".concat(1,"vh"),margin:"".concat(.5,"vh"),border:"2px ".concat(l?"solid":"none"," ").concat("rgba(250, 250, 250, 0.9)"),opacity:"".concat(h?1:l?.4:.1)},onPointerOver:function(){r(!0)},onPointerOut:function(){r(!1)},onClick:function(){t.script[a][o]=!h}},o)},s=function(e){for(var t=e.model,n=e.iChannel,i=[],a=0;a<t.numActions;a++){i.push(Object(b.jsx)(o,{model:t,isOn:!0,iChannel:n,iAction:a},a))}return Object(b.jsx)(E.a,{container:!0,item:!0,spacing:0,children:i})},c=[],l=0;l<t.numChannels;l++)c.push(Object(b.jsx)(s,{iChannel:l,model:t},l));return[Object(b.jsx)(E.a,{container:!0,item:!0,spacing:0,style:{padding:"".concat(ce,"vh"),width:"".concat(a,"vh")},children:c},"buttons")]}var fe=function(e){var t=e.model,n=(e.options,e.sharedData),a=Object(i.useReducer)((function(e){return e+1}),0),o=Object(f.a)(a,2)[1];n.updateGUI=o,window.updateGUI=o;var s=re();return[Object(b.jsx)("div",{className:s.mainGUI,onPointerOver:function(e){n.GUIHovered=!0},onPointerOut:function(e){n.GUIHovered=!1},children:Object(b.jsxs)(B.a,{children:[Object(b.jsxs)(R.a,{button:!0,selected:!1,onClick:function(e){var n=document.createElement("input");document.body.appendChild(n),n.type="file",n.id="inputFile",n.style="display:none",document.getElementById("inputFile").click(),document.getElementById("inputFile").onchange=function(){var e=new FileReader;e.onload=function(e){var n=e.target.result;window.inputFileString=n;var i=JSON.parse(n);window.data=i,t.loadDict(i),t.simulate=!1,t.gravity=!0,t.forceUpdate(),o()},e.readAsText(document.getElementById("inputFile").files[0]),document.body.removeChild(n)}},children:[Object(b.jsx)(H.a,{children:Object(b.jsx)(W.a,{})}),Object(b.jsx)(N.a,{children:"Load"})]}),Object(b.jsxs)(R.a,{button:!0,onClick:function(e){var n=t.saveData(),i=JSON.stringify(n),a=document.createElement("a");document.body.appendChild(a),a.download="download.json",a.style.display="none",a.href="data:text/plain;charset=utf-8,"+encodeURIComponent(i),a.click(),document.body.removeChild(a)},children:[Object(b.jsx)(H.a,{children:Object(b.jsx)($.a,{})}),Object(b.jsx)(N.a,{children:"Download"})]}),Object(b.jsx)(q.a,{}),Object(b.jsxs)(R.a,{button:!0,selected:t.editing,onClick:function(e){t.editing=!t.editing,t.Model.gravity=!t.editing,t.simulate=!0,t.gravity=!t.editing,n.movingJoint=!1,n.removingJoint=!1,n.addingJoint=!1,o(),t.editing&&t.resetV(),t.forceUpdate()},children:[Object(b.jsx)(H.a,{children:Object(b.jsx)(ee.a,{})}),Object(b.jsx)(N.a,{children:"Edit Shape"})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(X.a,{style:{width:"50%"},children:"Contraction"}),Object(b.jsx)(Y.a,{style:{width:"50%"},disabled:!t.eStatus.includes(2)||!Object(L.a)(Array(t.e.length).keys()).every((function(e){return 2===t.eStatus[e]&&t.edgeActive[e]||2!==t.eStatus[e]})),defaultValue:t.Model.maxMaxContraction,"aria-labelledby":"discrete-slider-custom",step:t.Model.contractionInterval,min:0,max:t.Model.maxMaxContraction,valueLabelDisplay:"auto",onChange:function(e,n){for(var i=0;i<t.e.length;i++)2===t.eStatus[i]&&(t.maxContraction[i]=n)},onPointerUp:function(){t.forceUpdate()}})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(X.a,{style:{width:"50%"},children:"Length"}),Object(b.jsx)(Y.a,{style:{width:"50%"},disabled:!t.eStatus.includes(2)||!Object(L.a)(Array(t.e.length).keys()).every((function(e){return 2===t.eStatus[e]&&!t.edgeActive[e]||2!==t.eStatus[e]})),defaultValue:t.Model.defaultMinLength,"aria-labelledby":"discrete-slider-custom",step:t.Model.contractionInterval*t.Model.defaultMaxLength,min:t.Model.defaultMinLength,max:t.Model.defaultMaxLength,valueLabelDisplay:"auto",onChange:function(e,n){for(var i=0;i<t.e.length;i++)2===t.eStatus[i]&&!1===t.edgeActive[i]&&(t.lMax[i]=n)},onPointerUp:function(){t.forceUpdate()}})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{style:{width:"50%"},children:"Fix Joints"}),Object(b.jsxs)(E.a,{container:!0,style:{width:"50%"},spacing:0,alignItems:"center",children:[Object(b.jsx)(E.a,{item:!0,style:{width:"50%",textAlign:"center"},children:Object(b.jsx)(F.a,{size:"small",onClick:function(e){for(var n=0;n<t.v.length;n++)2===t.vStatus[n]&&(t.fixedVs[n]=!0);o(),t.forceUpdate()},children:Object(b.jsx)(te.a,{})})},"fix"),Object(b.jsx)(E.a,{item:!0,style:{width:"50%",textAlign:"center"},children:Object(b.jsx)(F.a,{size:"small",onClick:function(e){for(var n=0;n<t.v.length;n++)2===t.vStatus[n]&&(t.fixedVs[n]=!1);o(),t.forceUpdate()},children:Object(b.jsx)(ne.a,{})})},"unfix")]})]}),Object(b.jsx)(he,{model:t,updateGUI:o}),Object(b.jsx)(q.a,{}),Object(b.jsxs)(R.a,{button:!0,selected:n.editingScript,onClick:function(e){n.editingScript=!n.editingScript,o()},children:[Object(b.jsx)(H.a,{children:Object(b.jsx)(ee.a,{})}),Object(b.jsx)(N.a,{children:"Script & Channel"})]}),Object(b.jsx)(de,{n:t.numChannels,model:t,updateGUI:o}),Object(b.jsx)(ue,{n:t.numChannels,model:t,updateGUI:o}),Object(b.jsx)(q.a,{}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"Gravity"}),Object(b.jsx)(T.a,{i:0,checked:t.gravity,onChange:function(e){t.gravity=!t.gravity,o()}})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"Simulate"}),Object(b.jsx)(T.a,{i:0,checked:t.simulate,onChange:function(e){t.simulate=!t.simulate,o()}})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(X.a,{style:{width:"50%"},children:"Friction"}),Object(b.jsx)(Y.a,{style:{width:"50%"},defaultValue:t.Model.frictionFactor,"aria-labelledby":"discrete-slider-custom",step:.1,min:0,max:1,valueLabelDisplay:"auto"})]}),Object(b.jsx)(q.a,{}),Object(b.jsxs)(R.a,{button:!0,onClick:function(e){t.controls.current.target=t.centroid(),t.forceUpdate()},children:[Object(b.jsx)(H.a,{children:Object(b.jsx)(ie.a,{})}),Object(b.jsx)(N.a,{children:"Look At Center"})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"Channel Color"}),Object(b.jsx)(T.a,{i:1,checked:n.showChannel,onChange:function(e){n.showChannel=!n.showChannel,o()}})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"Length Info"}),Object(b.jsx)(T.a,{i:2,checked:n.showInfo,onChange:function(e){n.showInfo=!n.showInfo,o()}})]})]})},"mainGUI"),Object(b.jsx)("div",{className:s.editingGUI,style:t.editing?{display:"block"}:{display:"none"},onPointerOver:function(e){n.GUIHovered=!0},onPointerOut:function(e){n.GUIHovered=!1},children:Object(b.jsxs)(B.a,{children:[Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"Add Joint"}),Object(b.jsx)(T.a,{checked:n.addingJoint,onChange:function(e,t){n.addingJoint=t,t&&(n.removingJoint=!1,n.movingJoint=!1),o()}},"add_joint")]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"Move Joint"}),Object(b.jsx)(T.a,{checked:n.movingJoint,onChange:function(e,i){n.movingJoint=i,i&&(n.removingJoint=!1,n.addingJoint=!1),t.simulate=!0,t.resetSelection(),o()}},"add_joint")]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"Remove Joint"}),Object(b.jsx)(T.a,{checked:n.removingJoint,onChange:function(e,t){n.removingJoint=t,t&&(n.addingJoint=!1,n.movingJoint=!1),o()}},"remove_joint")]}),Object(b.jsxs)(R.a,{button:!0,onClick:function(e){for(var n=[],i=0;i<t.v.length;i++)2===t.vStatus[i]&&n.push(i);t.addEdges(n),t.precompute(),t.forceUpdate(),o()},children:[Object(b.jsx)(H.a,{children:Object(b.jsx)(ae.a,{})}),Object(b.jsx)(N.a,{children:"Connect Joints"})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"X:"}),Object(b.jsx)(Y.a,{defaultValue:0,"arial-labelledby":"continuous-slider",step:.01,min:-Math.PI,max:Math.PI,valueLabelDisplay:"auto",onChange:function(e,n){t.rotate(n,t.euler.y,t.euler.z),t.resetV()}})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"Y:"}),Object(b.jsx)(Y.a,{defaultValue:0,"arial-labelledby":"continuous-slider",step:.01,min:-Math.PI,max:Math.PI,valueLabelDisplay:"auto",onChange:function(e,n){t.rotate(t.euler.x,n,t.euler.z),t.resetV()}})]}),Object(b.jsxs)(R.a,{children:[Object(b.jsx)(N.a,{children:"Z:"}),Object(b.jsx)(Y.a,{defaultValue:0,"arial-labelledby":"continuous-slider",step:.01,min:-Math.PI,max:Math.PI,valueLabelDisplay:"auto",onChange:function(e,n){t.rotate(t.euler.x,t.euler.y,n),t.resetV()}})]})]})},"editingGUI"),Object(b.jsx)("div",{className:s.scriptGUI,style:(n.editingScript,{display:"block"}),onPointerOver:function(e){n.GUIHovered=!0},onPointerOut:function(e){n.GUIHovered=!1},children:Object(b.jsx)(ve,{model:t,sharedData:n,classes:s,updateGUI:o})},"scriptGUI"),Object(b.jsxs)("div",{className:s.editingScriptGUI,style:n.editingScript?{display:"block"}:{display:"none"},onPointerOver:function(e){n.GUIHovered=!0},onPointerOut:function(e){n.GUIHovered=!1},children:[Object(b.jsxs)(E.a,{container:!0,item:!0,spacing:2,alignItems:"center",style:{padding:"".concat(ce,"vh"),paddingTop:"0",paddingBottom:"0",width:"".concat(50.2,"vh")},children:[Object(b.jsx)(E.a,{item:!0,style:{margin:"".concat(le,"vh"),width:"10vh",fontSize:"small"},children:"Channels"}),Object(b.jsx)(E.a,{item:!0,style:{margin:"".concat(le,"vh"),width:"".concat(30,"vh")},children:Object(b.jsx)(Y.a,{defaultValue:t.Model.defaultNumChannels,"aria-labelledby":"discrete-slider-custom",step:1,min:1,max:5,valueLabelDisplay:"auto",onChange:function(e,n){t.numChannels=n,t.precompute(),o()}},"numChannels")})]},"numChannels"),Object(b.jsxs)(E.a,{container:!0,item:!0,spacing:2,alignItems:"center",style:{padding:"".concat(ce,"vh"),paddingTop:"0",paddingBottom:"0",width:"".concat(50.2,"vh")},children:[Object(b.jsx)(E.a,{item:!0,style:{margin:"".concat(le,"vh"),width:"10vh",fontSize:"small"},children:"Actions"}),Object(b.jsx)(E.a,{item:!0,style:{margin:"".concat(le,"vh"),width:"".concat(30,"vh")},children:Object(b.jsx)(Y.a,{defaultValue:t.Model.defaultNumActions,"aria-labelledby":"discrete-slider-custom",step:1,min:1,max:20,valueLabelDisplay:"auto",onChange:function(e,n){t.numActions=n,t.precompute(),o()}},"numActions")})]},"numActions")]},"editingScriptGUI")]};var je=function(){var e=new v;window.model=e;var t={updateGUI:null,GUIHovered:!1,unSelect:!1,addingJoint:!1,movingJoint:!1,removingJoint:!1,showChannel:!1,editingScript:!1,numActions:20,numChannels:4,infoPanel:null,showInfo:!1};return e.sharedData=t,window.sharedData=t,t.infoPanel=document.getElementById("infoPanel"),t.infoPanel||(t.infoPanel=document.createElement("div"),document.body.appendChild(t.infoPanel)),t.infoPanel.id="infoPanel",t.infoPanel.style.background="rgba(255, 255, 255, 0.9)",t.infoPanel.style.position="absolute",t.infoPanel.style.padding="10px",t.infoPanel.appendChild(t.infoPanel.ownerDocument.createTextNode(" ")),window.addEventListener("pointerdown",(function(e){t.unSelect=!0}),!1),window.addEventListener("pointermove",(function(e){t.unSelect=!1}),!1),window.addEventListener("pointerup",(function(n){t.unSelect&&(t.GUIHovered||e.vStatus.every((function(e){return 1!==e}))&&e.eStatus.every((function(e){return 1!==e}))&&e.fStatus.every((function(e){return 1!==e}))&&(e.vStatus.fill(0),e.eStatus.fill(0),e.fStatus.fill(0)),t.updateGUI&&setTimeout((function(){t.updateGUI()}),10))}),!1),window.addEventListener("keydown",(function(t){"KeyA"===t.code&&(t.metaKey||t.ctrlKey)&&(e.eStatus.fill(2),e.vStatus.fill(2))}),!1),[Object(b.jsx)(J,{model:e,sharedData:t},"viewer"),Object(b.jsx)(fe,{id:"hehe",model:e,sharedData:t},"gui")]},pe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,129)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,o=t.getLCP,s=t.getTTFB;n(e),i(e),a(e),o(e),s(e)}))},ge=document.getElementById("root");s.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(je,{})}),ge),pe()}},[[84,1,2]]]);
//# sourceMappingURL=main.6fc01205.chunk.js.map